<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>
    SQLAlchemy Documentation
</title>
	
    <link rel="stylesheet" href="style.css"></link>
    <link rel="stylesheet" href="docs.css"></link>
    <link href="syntaxhighlight.css" rel="stylesheet" type="text/css"></link>
    <script src="scripts.js"></script>



</head>
<body>








<div id="topanchor"><a name="top">&nbsp;</a></div>


<h1>SQLAlchemy 0.5 Documentation</h1>

<div id="pagecontrol"><a href="index.html">Multiple Pages</a> | <a href="documentation.html">One Page</a></div>

<div class="versionheader">
  Version: <span class="versionnum">0.5.0rc4</span>
  Last Updated: 11/14/08 16:38:11
</div>







	<div class="topnav">

	<a name="table_of_contents"></a>
	<h3>Table of Contents</h3>
	&nbsp;&nbsp;
	<a href="#full_index" class="totoc">(view full table)</a>
	
    <ul>
        
        <li><a style="" href="#overview">Overview / Installation</a></li>

        
        <li><a style="" href="#datamapping">Object Relational Tutorial</a></li>

        
        <li><a style="" href="#sql">SQL Expression Language Tutorial</a></li>

        
        <li><a style="" href="#advdatamapping">Mapper Configuration</a></li>

        
        <li><a style="" href="#unitofwork">Using the Session</a></li>

        
        <li><a style="" href="#dbengine">Database Engines</a></li>

        
        <li><a style="" href="#metadata">Database Meta Data</a></li>

        
        <li><a style="" href="#types">The Types System</a></li>

        
        <li><a style="" href="#pooling">Connection Pooling</a></li>

        
        <li><a style="" href="#plugins">Plugins</a></li>

        
        <li><a style="" href="docstrings.html">API Documentation</a></li>

        
        <li><a style="" href="#copyright">Appendix:  Copyright</a></li>

    </ul>


	<a name="full_index"></a>
	<h3>Table of Contents: Full</h3>
	&nbsp;&nbsp;
	<a href="#table_of_contents" class="totoc">(view brief table)</a>

	
    <ul>
        
        <li><a style="" href="#overview">Overview / Installation</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#overview_overview">Overview</a></li>

        
        <li><a style="" href="#overview_tutorials">Tutorials</a></li>

        
        <li><a style="" href="#overview_reference">Reference Documentation</a></li>

        
        <li><a style="" href="#overview_sqlalchemy">Installing SQLAlchemy</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#overview_sqlalchemy_dbms">Installing a Database API</a></li>

        
        <li><a style="" href="#overview_sqlalchemy_checking">Checking the Installed SQLAlchemy Version</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#overview_migration">0.4 to 0.5 Migration</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#datamapping">Object Relational Tutorial</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#datamapping_version">Version Check</a></li>

        
        <li><a style="" href="#datamapping_connecting">Connecting</a></li>

        
        <li><a style="" href="#datamapping_tables">Define and Create a Table</a></li>

        
        <li><a style="" href="#datamapping_mapping">Define a Python Class to be Mapped</a></li>

        
        <li><a style="" href="#datamapping_setting">Setting up the Mapping</a></li>

        
        <li><a style="" href="#datamapping_declarative">Creating Table, Class and Mapper All at Once Declaratively</a></li>

        
        <li><a style="" href="#datamapping_creating">Creating a Session</a></li>

        
        <li><a style="" href="#datamapping_adding">Adding new Objects</a></li>

        
        <li><a style="" href="#datamapping_rolling">Rolling Back</a></li>

        
        <li><a style="" href="#datamapping_querying">Querying</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#datamapping_querying_common">Common Filter Operators</a></li>

        
        <li><a style="" href="#datamapping_querying_scalars">Returning Lists and Scalars</a></li>

        
        <li><a style="" href="#datamapping_querying_using">Using Literal SQL</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#datamapping_relation">Building a Relation</a></li>

        
        <li><a style="" href="#datamapping_related_objects">Working with Related Objects</a></li>

        
        <li><a style="" href="#datamapping_joins">Querying with Joins</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#datamapping_joins_aliases">Using Aliases</a></li>

        
        <li><a style="" href="#datamapping_joins_subqueries">Using Subqueries</a></li>

        
        <li><a style="" href="#datamapping_joins_using">Using EXISTS</a></li>

        
        <li><a style="" href="#datamapping_joins_relationop">Common Relation Operators</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#datamapping_deleting">Deleting</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#datamapping_deleting_cascade">Configuring delete/delete-orphan Cascade</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#datamapping_manytomany">Building a Many To Many Relation</a></li>

        
        <li><a style="" href="#datamapping_further">Further Reference</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#sql">SQL Expression Language Tutorial</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#sql_version">Version Check</a></li>

        
        <li><a style="" href="#sql_connecting">Connecting</a></li>

        
        <li><a style="" href="#sql_tables">Define and Create Tables</a></li>

        
        <li><a style="" href="#sql_insert">Insert Expressions</a></li>

        
        <li><a style="" href="#sql_executing">Executing</a></li>

        
        <li><a style="" href="#sql_execmany">Executing Multiple Statements</a></li>

        
        <li><a style="" href="#sql_connectionless">Connectionless / Implicit Execution</a></li>

        
        <li><a style="" href="#sql_selecting">Selecting</a></li>

        
        <li><a style="" href="#sql_operators">Operators</a></li>

        
        <li><a style="" href="#sql_conjunctions">Conjunctions</a></li>

        
        <li><a style="" href="#sql_text">Using Text</a></li>

        
        <li><a style="" href="#sql_aliases">Using Aliases</a></li>

        
        <li><a style="" href="#sql_joins">Using Joins</a></li>

        
        <li><a style="" href="#sql_transform">Intro to Generative Selects and Transformations</a></li>

        
        <li><a style="" href="#sql_everythingelse">Everything Else</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#sql_everythingelse_bindparams">Bind Parameter Objects</a></li>

        
        <li><a style="" href="#sql_everythingelse_functions">Functions</a></li>

        
        <li><a style="" href="#sql_everythingelse_unions">Unions and Other Set Operations</a></li>

        
        <li><a style="" href="#sql_everythingelse_scalar">Scalar Selects</a></li>

        
        <li><a style="" href="#sql_everythingelse_correlated">Correlated Subqueries</a></li>

        
        <li><a style="" href="#sql_everythingelse_ordering">Ordering, Grouping, Limiting, Offset...ing...</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#sql_update">Updates</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#sql_update_correlated">Correlated Updates</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#sql_delete">Deletes</a></li>

        
        <li><a style="" href="#sql_reference">Further Reference</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping">Mapper Configuration</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_mapper">Mapper Configuration</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_mapper_columns">Customizing Column Properties</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_deferred">Deferred Column Loading</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_expressions">SQL Expressions as Mapped Attributes</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_attributes">Changing Attribute Behavior</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_mapper_attributes_validators">Simple Validators</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_attributes_overriding">Using Descriptors</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_mapper_composite">Composite Column Types</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_orderby">Controlling Ordering</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_inheritance">Mapping Class Inheritance Hierarchies</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_mapper_inheritance_joined">Joined Table Inheritance</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_mapper_inheritance_joined_querying">Polymorphic Querying Strategies</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_inheritance_joined_optimizing">Optimizing Joined Table Loads</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_mapper_inheritance_single">Single Table Inheritance</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_inheritance_concrete">Concrete Table Inheritance</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_inheritance_relations">Using Relations with Inheritance</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_mapper_joins">Mapping a Class against Multiple Tables</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_selects">Mapping a Class against Arbitrary Selects</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_multiple">Multiple Mappers for One Class</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_reconstructor">Constructors and Object Initialization</a></li>

        
        <li><a style="" href="#advdatamapping_mapper_extending">Extending Mapper</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation">Relation Configuration</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_patterns">Basic Relational Patterns</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_patterns_onetomany">One To Many</a></li>

        
        <li><a style="" href="#advdatamapping_relation_patterns_manytoone">Many To One</a></li>

        
        <li><a style="" href="#advdatamapping_relation_patterns_onetoone">One To One</a></li>

        
        <li><a style="" href="#advdatamapping_relation_patterns_manytomany">Many To Many</a></li>

        
        <li><a style="" href="#advdatamapping_relation_patterns_association">Association Object</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_selfreferential">Adjacency List Relationships</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_selfreferential_query">Self-Referential Query Strategies</a></li>

        
        <li><a style="" href="#advdatamapping_relation_selfreferential_eagerloading">Configuring Eager Loading</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_customjoin">Specifying Alternate Join Conditions to relation()</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_customjoin_fks">Specifying Foreign Keys</a></li>

        
        <li><a style="" href="#advdatamapping_relation_customjoin_properties">Building Query-Enabled Properties</a></li>

        
        <li><a style="" href="#advdatamapping_relation_customjoin_multiplejoin">Multiple Relations against the Same Parent/Child</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_collections">Alternate Collection Implementations</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_collections_custom">Custom Collection Implementations</a></li>

        
        <li><a style="" href="#advdatamapping_relation_collections_decorators">Annotating Custom Collections via Decorators</a></li>

        
        <li><a style="" href="#advdatamapping_relation_collections_dictcollections">Dictionary-Based Collections</a></li>

        
        <li><a style="" href="#advdatamapping_relation_collections_adv_collections">Instrumentation and Custom Types</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_strategies">Configuring Loader Strategies: Lazy Loading, Eager Loading</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_strategies_containseager">Routing Explicit Joins/Statements into Eagerly Loaded Collections</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_largecollections">Working with Large Collections</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#advdatamapping_relation_largecollections_dynamic">Dynamic Relation Loaders</a></li>

        
        <li><a style="" href="#advdatamapping_relation_largecollections_noload">Setting Noload</a></li>

        
        <li><a style="" href="#advdatamapping_relation_largecollections_passivedelete">Using Passive Deletes</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#advdatamapping_relation_mutablepks">Mutable Primary Keys / Update Cascades</a></li>

    </ul>

	        </li>
    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork">Using the Session</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_what">What does the Session do ?</a></li>

        
        <li><a style="" href="#unitofwork_getting">Getting a Session</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_getting_sessionmaker">Using a sessionmaker() Configuration</a></li>

        
        <li><a style="" href="#unitofwork_getting_binding">Binding Session to an Engine</a></li>

        
        <li><a style="" href="#unitofwork_getting_connection">Binding Session to a Connection</a></li>

        
        <li><a style="" href="#unitofwork_getting_createsession">Using create_session()</a></li>

        
        <li><a style="" href="#unitofwork_getting_configuration">Configurational Arguments</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork_using">Using the Session</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_using_states">Quickie Intro to Object States</a></li>

        
        <li><a style="" href="#unitofwork_using_faq">Frequently Asked Questions</a></li>

        
        <li><a style="" href="#unitofwork_using_querying">Querying</a></li>

        
        <li><a style="" href="#unitofwork_using_adding">Adding New or Existing Items</a></li>

        
        <li><a style="" href="#unitofwork_using_merging">Merging</a></li>

        
        <li><a style="" href="#unitofwork_using_deleting">Deleting</a></li>

        
        <li><a style="" href="#unitofwork_using_flushing">Flushing</a></li>

        
        <li><a style="" href="#unitofwork_using_committing">Committing</a></li>

        
        <li><a style="" href="#unitofwork_using_rolling">Rolling Back</a></li>

        
        <li><a style="" href="#unitofwork_using_expunging">Expunging</a></li>

        
        <li><a style="" href="#unitofwork_using_closing">Closing</a></li>

        
        <li><a style="" href="#unitofwork_using_refreshing">Refreshing / Expiring</a></li>

        
        <li><a style="" href="#unitofwork_using_attributes">Session Attributes</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork_cascades">Cascades</a></li>

        
        <li><a style="" href="#unitofwork_managing">Managing Transactions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_managing_savepoint">Using SAVEPOINT</a></li>

        
        <li><a style="" href="#unitofwork_managing_twophase">Enabling Two-Phase Commit</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork_flushsql">Embedding SQL Insert/Update Expressions into a Flush</a></li>

        
        <li><a style="" href="#unitofwork_sql">Using SQL Expressions with Sessions</a></li>

        
        <li><a style="" href="#unitofwork_joining">Joining a Session into an External Transaction</a></li>

        
        <li><a style="" href="#unitofwork_contextual">Contextual/Thread-local Sessions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_contextual_creating">Creating a Thread-local Context</a></li>

        
        <li><a style="" href="#unitofwork_contextual_lifespan">Lifespan of a Contextual Session</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork_partitioning">Partitioning Strategies</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#unitofwork_partitioning_vertical">Vertical Partitioning</a></li>

        
        <li><a style="" href="#unitofwork_partitioning_horizontal">Horizontal Partitioning</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#unitofwork_extending">Extending Session</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#dbengine">Database Engines</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#dbengine_supported">Supported Databases</a></li>

        
        <li><a style="" href="#dbengine_establishing">create_engine() URL Arguments</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#dbengine_establishing_custom">Custom DBAPI connect() arguments</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#dbengine_options">Database Engine Options</a></li>

        
        <li><a style="" href="#dbengine_connections">More On Connections</a></li>

        
        <li><a style="" href="#dbengine_transactions">Using Transactions with Connection</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#dbengine_transactions_understanding">Understanding Autocommit</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#dbengine_implicit">Connectionless Execution, Implicit Execution</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#dbengine_implicit_strategies">Using the Threadlocal Execution Strategy</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#dbengine_logging">Configuring Logging</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#metadata">Database Meta Data</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#metadata_tables">Describing Databases with MetaData</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#metadata_tables_binding">Binding MetaData to an Engine or Connection</a></li>

        
        <li><a style="" href="#metadata_tables_reflecting">Reflecting Tables</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#metadata_tables_reflecting_overriding">Overriding Reflected Columns</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#metadata_tables_schema">Specifying the Schema Name</a></li>

        
        <li><a style="" href="#metadata_tables_onupdate">ON UPDATE and ON DELETE</a></li>

        
        <li><a style="" href="#metadata_tables_options">Other Options</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#metadata_creating">Creating and Dropping Database Tables</a></li>

        
        <li><a style="" href="#metadata_defaults">Column Insert/Update Defaults</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#metadata_defaults_preexecute_functions">Pre-Executed Python Functions</a></li>

        
        <li><a style="" href="#metadata_defaults_sqlexpression">Pre-executed and Inline SQL Expressions</a></li>

        
        <li><a style="" href="#metadata_defaults_passive">DDL-Level Defaults</a></li>

        
        <li><a style="" href="#metadata_defaults_triggered">Triggered Columns</a></li>

        
        <li><a style="" href="#metadata_defaults_sequences">Defining Sequences</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#metadata_constraints">Defining Constraints and Indexes</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#metadata_constraints_unique">UNIQUE Constraint</a></li>

        
        <li><a style="" href="#metadata_constraints_check">CHECK Constraint</a></li>

        
        <li><a style="" href="#metadata_constraints_indexes">Indexes</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#metadata_adapting">Adapting Tables to Alternate Metadata</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#types">The Types System</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#types_standard">Built-in Types</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#types_standard_string">String</a></li>

        
        <li><a style="" href="#types_standard_unicode">Unicode</a></li>

        
        <li><a style="" href="#types_standard_text">Text / UnicodeText</a></li>

        
        <li><a style="" href="#types_standard_numeric">Numeric</a></li>

        
        <li><a style="" href="#types_standard_float">Float</a></li>

        
        <li><a style="" href="#types_standard_datetime/date/time">DateTime/Date/Time</a></li>

        
        <li><a style="" href="#types_standard_interval">Interval</a></li>

        
        <li><a style="" href="#types_standard_binary">Binary</a></li>

        
        <li><a style="" href="#types_standard_boolean">Boolean</a></li>

        
        <li><a style="" href="#types_standard_pickletype">PickleType</a></li>

        
        <li><a style="" href="#types_standard_sqlspecific">SQL-Specific Types</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#types_dialect">Dialect Specific Types</a></li>

        
        <li><a style="" href="#types_custom">Creating your Own Types</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#pooling">Connection Pooling</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#pooling_establishing">Establishing a Transparent Connection Pool</a></li>

        
        <li><a style="" href="#pooling_configuration">Connection Pool Configuration</a></li>

        
        <li><a style="" href="#pooling_custom">Custom Pool Construction</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#plugins">Plugins</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#plugins_declarative">declarative</a></li>

        
        <li><a style="" href="#plugins_associationproxy">associationproxy</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#plugins_associationproxy_simplifying">Simplifying Relations</a></li>

        
        <li><a style="" href="#plugins_associationproxy_simplifying">Simplifying Association Object Relations</a></li>

        
        <li><a style="" href="#plugins_associationproxy_building">Building Complex Views</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="#plugins_orderinglist">orderinglist</a></li>

        
        <li><a style="" href="#plugins_serializer">serializer</a></li>

        
        <li><a style="" href="#plugins_sqlsoup">SqlSoup</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="docstrings.html">API Documentation</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine">module sqlalchemy.engine</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.engine_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.engine_modfunc_create_engine">create_engine()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.engine_modfunc_engine_from_config">engine_from_config()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_BufferedColumnResultProxy">class BufferedColumnResultProxy(ResultProxy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_BufferedColumnRow">class BufferedColumnRow(RowProxy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_BufferedRowResultProxy">class BufferedRowResultProxy(ResultProxy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Compiled">class Compiled(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connectable">class Connectable(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connection">class Connection(Connectable)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_DefaultRunner">class DefaultRunner(SchemaVisitor)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Dialect">class Dialect(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Engine">class Engine(Connectable)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ExecutionContext">class ExecutionContext(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_NestedTransaction">class NestedTransaction(Transaction)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ResultProxy">class ResultProxy(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_RootTransaction">class RootTransaction(Transaction)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_RowProxy">class RowProxy(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_SchemaIterator">class SchemaIterator(SchemaVisitor)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Transaction">class Transaction(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_TwoPhaseTransaction">class TwoPhaseTransaction(Transaction)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default">module sqlalchemy.engine.default</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default_DefaultDialect">class DefaultDialect(Dialect)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_default.html#docstrings_sqlalchemy.engine.default_DefaultExecutionContext">class DefaultExecutionContext(ExecutionContext)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies">module sqlalchemy.engine.strategies</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_DefaultEngineStrategy">class DefaultEngineStrategy(EngineStrategy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_EngineStrategy">class EngineStrategy(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_MockEngineStrategy">class MockEngineStrategy(EngineStrategy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_PlainEngineStrategy">class PlainEngineStrategy(DefaultEngineStrategy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_ThreadLocalEngineStrategy">class ThreadLocalEngineStrategy(DefaultEngineStrategy)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_strategies.html#docstrings_sqlalchemy.engine.strategies_attrgetter">class attrgetter(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal">module sqlalchemy.engine.threadlocal</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLConnection">class TLConnection(Connection)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLEngine">class TLEngine(Engine)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLSession">class TLSession(object)</a></li>

        
        <li><a style="" href="sqlalchemy_engine_threadlocal.html#docstrings_sqlalchemy.engine.threadlocal_TLTransaction">class TLTransaction(Transaction)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine_url.html#docstrings_sqlalchemy.engine.url">module sqlalchemy.engine.url</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.engine.url_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.engine.url_modfunc_make_url">make_url()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_engine_url.html#docstrings_sqlalchemy.engine.url_URL">class URL(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc">module sqlalchemy.exc</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_ArgumentError">class ArgumentError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_CircularDependencyError">class CircularDependencyError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_CompileError">class CompileError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_ConcurrentModificationError">class ConcurrentModificationError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_DBAPIError">class DBAPIError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_DataError">class DataError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_DatabaseError">class DatabaseError(DBAPIError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_DisconnectionError">class DisconnectionError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_FlushError">class FlushError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_IdentifierError">class IdentifierError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_IntegrityError">class IntegrityError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_InterfaceError">class InterfaceError(DBAPIError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_InternalError">class InternalError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_InvalidRequestError">class InvalidRequestError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NoReferenceError">class NoReferenceError(InvalidRequestError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NoReferencedColumnError">class NoReferencedColumnError(NoReferenceError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NoReferencedTableError">class NoReferencedTableError(NoReferenceError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NoSuchColumnError">class NoSuchColumnError(KeyError,InvalidRequestError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NoSuchTableError">class NoSuchTableError(InvalidRequestError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_NotSupportedError">class NotSupportedError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_OperationalError">class OperationalError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_ProgrammingError">class ProgrammingError(DatabaseError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_SADeprecationWarning">class SADeprecationWarning(DeprecationWarning)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_SAPendingDeprecationWarning">class SAPendingDeprecationWarning(PendingDeprecationWarning)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_SAWarning">class SAWarning(RuntimeWarning)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_SQLAlchemyError">class SQLAlchemyError(Exception)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_TimeoutError">class TimeoutError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_exc.html#docstrings_sqlalchemy.exc_UnboundExecutionError">class UnboundExecutionError(InvalidRequestError)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_interfaces.html#docstrings_sqlalchemy.interfaces">module sqlalchemy.interfaces</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_interfaces.html#docstrings_sqlalchemy.interfaces_ConnectionProxy">class ConnectionProxy(object)</a></li>

        
        <li><a style="" href="sqlalchemy_interfaces.html#docstrings_sqlalchemy.interfaces_PoolListener">class PoolListener(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool">module sqlalchemy.pool</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.pool_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.pool_modfunc_as_interface">as_interface()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.pool_modfunc_clear_managers">clear_managers()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.pool_modfunc_manage">manage()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_AssertionPool">class AssertionPool(Pool)</a></li>

        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_NullPool">class NullPool(Pool)</a></li>

        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_Pool">class Pool(object)</a></li>

        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_QueuePool">class QueuePool(Pool)</a></li>

        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_SingletonThreadPool">class SingletonThreadPool(Pool)</a></li>

        
        <li><a style="" href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_StaticPool">class StaticPool(Pool)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema">module sqlalchemy.schema</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_CheckConstraint">class CheckConstraint(Constraint)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Column">class Column(SchemaItem,_ColumnClause)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ColumnDefault">class ColumnDefault(DefaultGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Constraint">class Constraint(SchemaItem)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_DDL">class DDL(object)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_DefaultClause">class DefaultClause(FetchedValue)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_DefaultGenerator">class DefaultGenerator(SchemaItem)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_FetchedValue">class FetchedValue(object)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ForeignKey">class ForeignKey(SchemaItem)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ForeignKeyConstraint">class ForeignKeyConstraint(Constraint)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Index">class Index(SchemaItem)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_MetaData">class MetaData(SchemaItem)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_PrimaryKeyConstraint">class PrimaryKeyConstraint(Constraint)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_SchemaItem">class SchemaItem(Visitable)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_SchemaVisitor">class SchemaVisitor(ClauseVisitor)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Sequence">class Sequence(DefaultGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_Table">class Table(SchemaItem,TableClause)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_ThreadLocalMetaData">class ThreadLocalMetaData(MetaData)</a></li>

        
        <li><a style="" href="sqlalchemy_schema.html#docstrings_sqlalchemy.schema_UniqueConstraint">class UniqueConstraint(Constraint)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler">module sqlalchemy.sql.compiler</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler_DDLBase">class DDLBase(SchemaIterator)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler_DefaultCompiler">class DefaultCompiler(Compiled)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler_IdentifierPreparer">class IdentifierPreparer(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler_SchemaDropper">class SchemaDropper(DDLBase)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_compiler.html#docstrings_sqlalchemy.sql.compiler_SchemaGenerator">class SchemaGenerator(DDLBase)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression">module sqlalchemy.sql.expression</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_alias">alias()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_and_">and_()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_asc">asc()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_between">between()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_bindparam">bindparam()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_case">case()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_cast">cast()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_collate">collate()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_column">column()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_delete">delete()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_desc">desc()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_distinct">distinct()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_except_">except_()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_except_all">except_all()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_exists">exists()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_extract">extract()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_insert">insert()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_intersect">intersect()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_intersect_all">intersect_all()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_join">join()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_label">label()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_literal">literal()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_literal_column">literal_column()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_not_">not_()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_null">null()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_or_">or_()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_outerjoin">outerjoin()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_outparam">outparam()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_select">select()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_subquery">subquery()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_table">table()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_text">text()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_union">union()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_union_all">union_all()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.expression_modfunc_update">update()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Alias">class Alias(FromClause)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_ClauseElement">class ClauseElement(Visitable)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_ColumnCollection">class ColumnCollection(OrderedProperties)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_ColumnElement">class ColumnElement(ClauseElement,_CompareMixin)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_CompoundSelect">class CompoundSelect(_SelectBaseMixin,FromClause)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Delete">class Delete(_UpdateBase)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_FromClause">class FromClause(Selectable)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Insert">class Insert(_ValuesBase)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Join">class Join(FromClause)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Select">class Select(_SelectBaseMixin,FromClause)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Selectable">class Selectable(ClauseElement)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_TableClause">class TableClause(_Immutable,FromClause)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Update">class Update(_ValuesBase)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression__CompareMixin">class _CompareMixin(ColumnOperators)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_Operators">class Operators(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression_ColumnOperators">class ColumnOperators(Operators)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression__SelectBaseMixin">class _SelectBaseMixin(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression__Immutable">class _Immutable(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression__ValuesBase">class _ValuesBase(_UpdateBase)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression__UpdateBase">class _UpdateBase(ClauseElement)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors">module sqlalchemy.sql.visitors</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_cloned_traverse">cloned_traverse()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_iterate">iterate()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_iterate_depthfirst">iterate_depthfirst()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_replacement_traverse">replacement_traverse()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_traverse">traverse()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.sql.visitors_modfunc_traverse_using">traverse_using()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors_ClauseVisitor">class ClauseVisitor(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors_CloningVisitor">class CloningVisitor(ClauseVisitor)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors_ReplacingCloningVisitor">class ReplacingCloningVisitor(CloningVisitor)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors_Visitable">class Visitable(object)</a></li>

        
        <li><a style="" href="sqlalchemy_sql_visitors.html#docstrings_sqlalchemy.sql.visitors_VisitableType">class VisitableType(type)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types">module sqlalchemy.types</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_AbstractType">class AbstractType(object)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_BLOB">class BLOB(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_BOOLEAN">class BOOLEAN(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Binary">class Binary(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Boolean">class Boolean(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_CHAR">class CHAR(String)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_CLOB">class CLOB(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Concatenable">class Concatenable(object)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DATE">class DATE(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DATETIME">class DATETIME(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DECIMAL">class DECIMAL(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Date">class Date(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_DateTime">class DateTime(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_FLOAT">class FLOAT(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Float">class Float(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_INT">class INT(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Integer">class Integer(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Interval">class Interval(TypeDecorator)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_MutableType">class MutableType(object)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_NCHAR">class NCHAR(Unicode)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_NUMERIC">class NUMERIC(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Numeric">class Numeric(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_PickleType">class PickleType(MutableType,TypeDecorator)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_SMALLINT">class SMALLINT(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_SmallInteger">class SmallInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_String">class String(Concatenable,TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TIME">class TIME(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TIMESTAMP">class TIMESTAMP(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Text">class Text(String)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Time">class Time(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TypeDecorator">class TypeDecorator(AbstractType)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_TypeEngine">class TypeEngine(AbstractType)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_Unicode">class Unicode(String)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_UnicodeText">class UnicodeText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_types.html#docstrings_sqlalchemy.types_VARCHAR">class VARCHAR(String)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util">module sqlalchemy.util</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_accepts_a_list_as_starargs">accepts_a_list_as_starargs()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_as_interface">as_interface()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_asbool">asbool()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_assert_arg_type">assert_arg_type()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_class_hierarchy">class_hierarchy()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_coerce_kw_type">coerce_kw_type()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_decode_slice">decode_slice()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_decorator">decorator()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_deprecated">deprecated()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_dictlike_iteritems">dictlike_iteritems()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_duck_type_collection">duck_type_collection()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_flatten_iterator">flatten_iterator()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_format_argspec_init">format_argspec_init()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_format_argspec_plus">format_argspec_plus()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_function_named">function_named()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_get_cls_kwargs">get_cls_kwargs()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_get_func_kwargs">get_func_kwargs()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_getargspec_init">getargspec_init()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_iterate_attributes">iterate_attributes()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_monkeypatch_proxied_specials">monkeypatch_proxied_specials()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_pending_deprecation">pending_deprecation()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_reset_memoized">reset_memoized()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_set_creation_order">set_creation_order()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_to_list">to_list()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_to_set">to_set()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_unbound_method_to_callable">unbound_method_to_callable()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_unique_list">unique_list()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_unique_symbols">unique_symbols()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_update_wrapper">update_wrapper()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_warn">warn()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_warn_deprecated">warn_deprecated()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_warn_exception">warn_exception()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.util_modfunc_warn_pending_deprecation">warn_pending_deprecation()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_IdentitySet">class IdentitySet(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_OrderedDict">class OrderedDict(dict)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_OrderedIdentitySet">class OrderedIdentitySet(IdentitySet)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_OrderedProperties">class OrderedProperties(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_OrderedSet">class OrderedSet(set)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_PopulateDict">class PopulateDict(dict)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_ScopedRegistry">class ScopedRegistry(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_UniqueAppender">class UniqueAppender(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_WeakCompositeKey">class WeakCompositeKey(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_WeakIdentityMapping">class WeakIdentityMapping()</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_defaultdict">class defaultdict(dict)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_memoized_instancemethod">class memoized_instancemethod(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_memoized_property">class memoized_property(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_symbol">class symbol(object)</a></li>

        
        <li><a style="" href="sqlalchemy_util.html#docstrings_sqlalchemy.util_symbol">class symbol(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm">module sqlalchemy.orm</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_backref">backref()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_class_mapper">class_mapper()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_clear_mappers">clear_mappers()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_column_property">column_property()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_comparable_property">comparable_property()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_compile_mappers">compile_mappers()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_composite">composite()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_contains_alias">contains_alias()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_contains_eager">contains_eager()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_create_session">create_session()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_defer">defer()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_deferred">deferred()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_dynamic_loader">dynamic_loader()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_eagerload">eagerload()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_eagerload_all">eagerload_all()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_extension">extension()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_lazyload">lazyload()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_mapper">mapper()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_noload">noload()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_object_mapper">object_mapper()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_object_session">object_session()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_polymorphic_union">polymorphic_union()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_reconstructor">reconstructor()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_relation">relation()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_scoped_session">scoped_session()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_sessionmaker">sessionmaker()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_synonym">synonym()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_undefer">undefer()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_undefer_group">undefer_group()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm_modfunc_validates">validates()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_AliasedClass">class AliasedClass(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_InstrumentationManager">class InstrumentationManager(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_MapperExtension">class MapperExtension(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_PropComparator">class PropComparator(ColumnOperators)</a></li>

        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_Query">class Query(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_Validator">class Validator(AttributeExtension)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes">module sqlalchemy.orm.attributes</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_collect_management_factories_for">collect_management_factories_for()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_del_attribute">del_attribute()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_find_native_user_instrumentation_hook">find_native_user_instrumentation_hook()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_get_attribute">get_attribute()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_get_history">get_history()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_has_parent">has_parent()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_identity_equal">identity_equal()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_init_collection">init_collection()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_is_instrumented">is_instrumented()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_proxied_attribute_factory">proxied_attribute_factory()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_register_attribute">register_attribute()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_register_class">register_class()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_set_attribute">set_attribute()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_unregister_attribute">unregister_attribute()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.attributes_modfunc_unregister_class">unregister_class()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_AttributeImpl">class AttributeImpl(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_ClassManager">class ClassManager(dict)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_CollectionAttributeImpl">class CollectionAttributeImpl(AttributeImpl)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_Events">class Events(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_GenericBackrefExtension">class GenericBackrefExtension(AttributeExtension)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_History">class History(tuple)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_InstanceState">class InstanceState(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_InstrumentationRegistry">class InstrumentationRegistry(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_InstrumentedAttribute">class InstrumentedAttribute(QueryableAttribute)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_MutableScalarAttributeImpl">class MutableScalarAttributeImpl(ScalarAttributeImpl)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_PendingCollection">class PendingCollection(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_QueryableAttribute">class QueryableAttribute(PropComparator)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_ScalarAttributeImpl">class ScalarAttributeImpl(AttributeImpl)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_ScalarObjectAttributeImpl">class ScalarObjectAttributeImpl(ScalarAttributeImpl)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_attrgetter">class attrgetter(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_attributes.html#docstrings_sqlalchemy.orm.attributes_itemgetter">class itemgetter(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections">module sqlalchemy.orm.collections</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.collections_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.collections_modfunc_attribute_mapped_collection">attribute_mapped_collection()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.collections_modfunc_collection_adapter">collection_adapter()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.collections_modfunc_column_mapped_collection">column_mapped_collection()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.orm.collections_modfunc_mapped_collection">mapped_collection()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections_collection">class collection(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections_MappedCollection">class MappedCollection(dict)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections_CollectionAdapter">class CollectionAdapter(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces">module sqlalchemy.orm.interfaces</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.interfaces_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.interfaces_modfunc_build_path">build_path()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_AttributeExtension">class AttributeExtension(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_ExtensionOption">class ExtensionOption(MapperOption)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_InstrumentationManager">class InstrumentationManager(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_LoaderStrategy">class LoaderStrategy(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_MapperExtension">class MapperExtension(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_MapperOption">class MapperOption(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_MapperProperty">class MapperProperty(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_PropComparator">class PropComparator(ColumnOperators)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_PropertyOption">class PropertyOption(MapperOption)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_SessionExtension">class SessionExtension(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_StrategizedOption">class StrategizedOption(PropertyOption)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_interfaces.html#docstrings_sqlalchemy.orm.interfaces_StrategizedProperty">class StrategizedProperty(MapperProperty)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper">module sqlalchemy.orm.mapper</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.mapper_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.orm.mapper_modfunc_class_mapper">class_mapper()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_mapper.html#docstrings_sqlalchemy.orm.mapper_Mapper">class Mapper(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties">module sqlalchemy.orm.properties</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_BackRef">class BackRef(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_ColumnProperty">class ColumnProperty(StrategizedProperty)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_ComparableProperty">class ComparableProperty(MapperProperty)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_CompositeProperty">class CompositeProperty(ColumnProperty)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_PropertyLoader">class PropertyLoader(StrategizedProperty)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_properties.html#docstrings_sqlalchemy.orm.properties_SynonymProperty">class SynonymProperty(MapperProperty)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query">module sqlalchemy.orm.query</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_Query">class Query(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session">module sqlalchemy.orm.session</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_Session">class Session(object)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_SessionExtension">class SessionExtension(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_orm_shard.html#docstrings_sqlalchemy.orm.shard">module sqlalchemy.orm.shard</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_orm_shard.html#docstrings_sqlalchemy.orm.shard_ShardedQuery">class ShardedQuery(Query)</a></li>

        
        <li><a style="" href="sqlalchemy_orm_shard.html#docstrings_sqlalchemy.orm.shard_ShardedSession">class ShardedSession(Session)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_declarative.html#docstrings_sqlalchemy.ext.declarative">module sqlalchemy.ext.declarative</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.declarative_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.declarative_modfunc_comparable_using">comparable_using()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.declarative_modfunc_declarative_base">declarative_base()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.declarative_modfunc_instrument_declarative">instrument_declarative()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.declarative_modfunc_synonym_for">synonym_for()</a></li>

    </ul>

	        </li>
    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_associationproxy.html#docstrings_sqlalchemy.ext.associationproxy">module sqlalchemy.ext.associationproxy</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.associationproxy_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.associationproxy_modfunc_association_proxy">association_proxy()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_associationproxy.html#docstrings_sqlalchemy.ext.associationproxy_AssociationProxy">class AssociationProxy(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_orderinglist.html#docstrings_sqlalchemy.ext.orderinglist">module sqlalchemy.ext.orderinglist</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.orderinglist_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.orderinglist_modfunc_ordering_list">ordering_list()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_orderinglist.html#docstrings_sqlalchemy.ext.orderinglist_OrderingList">class OrderingList(list)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_serializer.html#docstrings_sqlalchemy.ext.serializer">module sqlalchemy.ext.serializer</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.serializer_modfunc">Module Functions</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="#docstrings_sqlalchemy.ext.serializer_modfunc_Deserializer">Deserializer()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.serializer_modfunc_Serializer">Serializer()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.serializer_modfunc_dumps">dumps()</a></li>

        
        <li><a style="" href="#docstrings_sqlalchemy.ext.serializer_modfunc_loads">loads()</a></li>

    </ul>

	        </li>
    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_ext_sqlsoup.html#docstrings_sqlalchemy.ext.sqlsoup">module sqlalchemy.ext.sqlsoup</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_ext_sqlsoup.html#docstrings_sqlalchemy.ext.sqlsoup_PKNotFoundError">class PKNotFoundError(SQLAlchemyError)</a></li>

        
        <li><a style="" href="sqlalchemy_ext_sqlsoup.html#docstrings_sqlalchemy.ext.sqlsoup_SqlSoup">class SqlSoup()</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access">module sqlalchemy.databases.access</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcBinary">class AcBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcBoolean">class AcBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcChar">class AcChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcDate">class AcDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcDateTime">class AcDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcFloat">class AcFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcInteger">class AcInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcNumeric">class AcNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcSmallInteger">class AcSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcString">class AcString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcText">class AcText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcTimeStamp">class AcTimeStamp(TIMESTAMP)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcTinyInteger">class AcTinyInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AcUnicode">class AcUnicode(Unicode)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessCompiler">class AccessCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessDefaultRunner">class AccessDefaultRunner(DefaultRunner)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessDialect">class AccessDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessExecutionContext">class AccessExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessIdentifierPreparer">class AccessIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessSchemaDropper">class AccessSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_access.html#docstrings_sqlalchemy.databases.access_AccessSchemaGenerator">class AccessSchemaGenerator(SchemaGenerator)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird">module sqlalchemy.databases.firebird</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBBinary">class FBBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBBoolean">class FBBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBChar">class FBChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBCompiler">class FBCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDate">class FBDate(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDateTime">class FBDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDefaultRunner">class FBDefaultRunner(DefaultRunner)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBDialect">class FBDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBExecutionContext">class FBExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBFloat">class FBFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBIdentifierPreparer">class FBIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBInteger">class FBInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBNumeric">class FBNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSchemaDropper">class FBSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSchemaGenerator">class FBSchemaGenerator(SchemaGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBSmallInteger">class FBSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBString">class FBString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBText">class FBText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_firebird.html#docstrings_sqlalchemy.databases.firebird_FBTime">class FBTime(Time)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix">module sqlalchemy.databases.informix</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoBinary">class InfoBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoBoolean">class InfoBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoChar">class InfoChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoCompiler">class InfoCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoDate">class InfoDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoDateTime">class InfoDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoDialect">class InfoDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoExecutionContext">class InfoExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoIdentifierPreparer">class InfoIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoInteger">class InfoInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoNumeric">class InfoNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoSchemaDropper">class InfoSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoSchemaGenerator">class InfoSchemaGenerator(SchemaGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoSmallInteger">class InfoSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoString">class InfoString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoText">class InfoText(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_InfoTime">class InfoTime(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_SingletonThreadPool">class SingletonThreadPool(Pool)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_informix.html#docstrings_sqlalchemy.databases.informix_informix_cursor">class informix_cursor(object)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb">module sqlalchemy.databases.maxdb</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxBlob">class MaxBlob(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxBoolean">class MaxBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxChar">class MaxChar(_StringType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxDate">class MaxDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxFloat">class MaxFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxInteger">class MaxInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxNumeric">class MaxNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxSmallInteger">class MaxSmallInteger(MaxInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxString">class MaxString(_StringType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxText">class MaxText(_StringType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxTime">class MaxTime(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxTimestamp">class MaxTimestamp(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_maxdb.html#docstrings_sqlalchemy.databases.maxdb_MaxUnicode">class MaxUnicode(_StringType)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql">module sqlalchemy.databases.mssql</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_AdoMSNVarchar">class AdoMSNVarchar(MSNVarchar)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_Decimal">class Decimal(object)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSBigInteger">class MSBigInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSBinary">class MSBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSBoolean">class MSBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSChar">class MSChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDate">class MSDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDateTime">class MSDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDateTime_adodbapi">class MSDateTime_adodbapi(MSDateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDateTime_pyodbc">class MSDateTime_pyodbc(MSDateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSDate_pyodbc">class MSDate_pyodbc(MSDate)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSFloat">class MSFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSInteger">class MSInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSMoney">class MSMoney(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNChar">class MSNChar(NCHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNVarchar">class MSNVarchar(Unicode)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSNumeric">class MSNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLCompiler">class MSSQLCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDefaultRunner">class MSSQLDefaultRunner(DefaultRunner)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect">class MSSQLDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_adodbapi">class MSSQLDialect_adodbapi(MSSQLDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_pymssql">class MSSQLDialect_pymssql(MSSQLDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLDialect_pyodbc">class MSSQLDialect_pyodbc(MSSQLDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLExecutionContext">class MSSQLExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLExecutionContext_pyodbc">class MSSQLExecutionContext_pyodbc(MSSQLExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLIdentifierPreparer">class MSSQLIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLSchemaDropper">class MSSQLSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSQLSchemaGenerator">class MSSQLSchemaGenerator(SchemaGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSmallDate">class MSSmallDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSmallInteger">class MSSmallInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSSmallMoney">class MSSmallMoney(MSMoney)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSString">class MSString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSText">class MSText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSTime">class MSTime(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSTimeStamp">class MSTimeStamp(TIMESTAMP)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSTinyInteger">class MSTinyInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSUniqueIdentifier">class MSUniqueIdentifier(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mssql.html#docstrings_sqlalchemy.databases.mssql_MSVariant">class MSVariant(TypeEngine)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql">module sqlalchemy.databases.mysql</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBigInteger">class MSBigInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBinary">class MSBinary(_BinaryType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBit">class MSBit(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBlob">class MSBlob(_BinaryType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSBoolean">class MSBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSChar">class MSChar(_StringType,CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDate">class MSDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDateTime">class MSDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDecimal">class MSDecimal(MSNumeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSDouble">class MSDouble(Float,_NumericType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSEnum">class MSEnum(MSString)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSFloat">class MSFloat(Float,_NumericType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSInteger">class MSInteger(Integer,_NumericType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSLongBlob">class MSLongBlob(MSBlob)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSLongText">class MSLongText(MSText)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSMediumBlob">class MSMediumBlob(MSBlob)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSMediumInteger">class MSMediumInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSMediumText">class MSMediumText(MSText)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSNChar">class MSNChar(_StringType,CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSNVarChar">class MSNVarChar(_StringType,String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSNumeric">class MSNumeric(Numeric,_NumericType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSSet">class MSSet(MSString)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSSmallInteger">class MSSmallInteger(SmallInteger,MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSString">class MSString(_StringType,String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSText">class MSText(_StringType,Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTime">class MSTime(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTimeStamp">class MSTimeStamp(TIMESTAMP)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTinyBlob">class MSTinyBlob(MSBlob)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTinyInteger">class MSTinyInteger(MSInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSTinyText">class MSTinyText(MSText)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSVarBinary">class MSVarBinary(_BinaryType)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_mysql.html#docstrings_sqlalchemy.databases.mysql_MSYear">class MSYear(TypeEngine)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle">module sqlalchemy.databases.oracle</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleBinary">class OracleBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleBoolean">class OracleBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleChar">class OracleChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleCompiler">class OracleCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDate">class OracleDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDateTime">class OracleDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDefaultRunner">class OracleDefaultRunner(DefaultRunner)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleDialect">class OracleDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleExecutionContext">class OracleExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleIdentifierPreparer">class OracleIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleInteger">class OracleInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleNumeric">class OracleNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleRaw">class OracleRaw(OracleBinary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSchemaDropper">class OracleSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSchemaGenerator">class OracleSchemaGenerator(SchemaGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleSmallInteger">class OracleSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleString">class OracleString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleText">class OracleText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_oracle.html#docstrings_sqlalchemy.databases.oracle_OracleTimestamp">class OracleTimestamp(TIMESTAMP)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres">module sqlalchemy.databases.postgres</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGArray">class PGArray(MutableType,Concatenable,TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBigInteger">class PGBigInteger(PGInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBinary">class PGBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGBoolean">class PGBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGChar">class PGChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGCidr">class PGCidr(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGCompiler">class PGCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDate">class PGDate(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDateTime">class PGDateTime(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDefaultRunner">class PGDefaultRunner(DefaultRunner)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGDialect">class PGDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGExecutionContext">class PGExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGFloat">class PGFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGIdentifierPreparer">class PGIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInet">class PGInet(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInteger">class PGInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGInterval">class PGInterval(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGMacAddr">class PGMacAddr(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGNumeric">class PGNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSchemaDropper">class PGSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSchemaGenerator">class PGSchemaGenerator(SchemaGenerator)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGSmallInteger">class PGSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGString">class PGString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGText">class PGText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_postgres.html#docstrings_sqlalchemy.databases.postgres_PGTime">class PGTime(Time)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite">module sqlalchemy.databases.sqlite</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_DateTimeMixin">class DateTimeMixin(object)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_DefaultClause">class DefaultClause(FetchedValue)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_NoneType">class NoneType(object)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLBinary">class SLBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLBoolean">class SLBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLChar">class SLChar(SLUnicodeMixin,CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLDate">class SLDate(DateTimeMixin,Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLDateTime">class SLDateTime(DateTimeMixin,DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLFloat">class SLFloat(Float)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLInteger">class SLInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLNumeric">class SLNumeric(Numeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLSmallInteger">class SLSmallInteger(SmallInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLString">class SLString(SLUnicodeMixin,String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLText">class SLText(SLUnicodeMixin,Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLTime">class SLTime(DateTimeMixin,Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SLUnicodeMixin">class SLUnicodeMixin(object)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteCompiler">class SQLiteCompiler(DefaultCompiler)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteDialect">class SQLiteDialect(DefaultDialect)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteExecutionContext">class SQLiteExecutionContext(DefaultExecutionContext)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteIdentifierPreparer">class SQLiteIdentifierPreparer(IdentifierPreparer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteSchemaDropper">class SQLiteSchemaDropper(SchemaDropper)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sqlite.html#docstrings_sqlalchemy.databases.sqlite_SQLiteSchemaGenerator">class SQLiteSchemaGenerator(SchemaGenerator)</a></li>

    </ul>

	        </li>
        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase">module sqlalchemy.databases.sybase</a></li>

	        <li>
                
    <ul>
        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseBigInteger">class SybaseBigInteger(SybaseInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseBinary">class SybaseBinary(Binary)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseBoolean">class SybaseBoolean(Boolean)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseChar">class SybaseChar(CHAR)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseDateTime_mxodbc">class SybaseDateTime_mxodbc(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseDateTime_pyodbc">class SybaseDateTime_pyodbc(DateTime)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseDate_mxodbc">class SybaseDate_mxodbc(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseDate_pyodbc">class SybaseDate_pyodbc(Date)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseFloat">class SybaseFloat(FLOAT,SybaseNumeric)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseInteger">class SybaseInteger(Integer)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseMoney">class SybaseMoney(TypeEngine)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseSmallInteger">class SybaseSmallInteger(SybaseInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseSmallMoney">class SybaseSmallMoney(SybaseMoney)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseString">class SybaseString(String)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseText">class SybaseText(Text)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseTimeStamp">class SybaseTimeStamp(TIMESTAMP)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseTime_mxodbc">class SybaseTime_mxodbc(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseTime_pyodbc">class SybaseTime_pyodbc(Time)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseTinyInteger">class SybaseTinyInteger(SybaseInteger)</a></li>

        
        <li><a style="" href="sqlalchemy_databases_sybase.html#docstrings_sqlalchemy.databases.sybase_SybaseUniqueIdentifier">class SybaseUniqueIdentifier(TypeEngine)</a></li>

    </ul>

	        </li>
    </ul>

	        </li>
        
        <li><a style="" href="#copyright">Appendix:  Copyright</a></li>

    </ul>


	</div>




    
    
    <A name="overview"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">


            
            Next: <a href="#datamapping">Object Relational Tutorial</a>
    </div>

        <h2>Overview / Installation</h2>
    </div>


        








    
    <A name="overview"></a>
    
    <div class="sectionL1">

    
    



    
    <A name="overview_overview"></a>
    
    <div class="sectionL2">

    <h3>Overview</h3>
    
    

<p>The SQLAlchemy SQL Toolkit and Object Relational Mapper is a comprehensive set of tools for working with databases and Python.  It has several distinct areas of functionality which can be used individually or combined together.  Its major API components, all public-facing, are illustrated below:
</p>

    

    <div class="sliding_code">
        <pre>
           +-----------------------------------------------------------+
           |             Object Relational Mapper (ORM)                |
           |                <a href="#datamapping">[tutorial]</a>    <a href="#advdatamapping">[docs]</a>                       |
           +-----------------------------------------------------------+
           +---------+ +------------------------------------+ +--------+
           |         | |       SQL Expression Language      | |        |
           |         | |        <a href="#sql">[tutorial]</a>  <a href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression">[docs]</a>          | |        |
           |         | +------------------------------------+ |        |
           |         +-----------------------+ +--------------+        |
           |        Dialect/Execution        | |    Schema Management  |
           |              <a href="#dbengine">[docs]</a>             | |        <a href="#metadata">[docs]</a>         |
           +---------------------------------+ +-----------------------+
           +----------------------+ +----------------------------------+
           |  Connection Pooling  | |              Types               |
           |        <a href="#pooling">[docs]</a>        | |              <a href="#types">[docs]</a>              |
           +----------------------+ +----------------------------------+
</pre>
    </div>
<p>Above, the two most significant front-facing portions of SQLAlchemy are the <strong>Object Relational Mapper</strong> and the <strong>SQL Expression Language</strong>.  These are two separate toolkits, one building off the other.  SQL Expressions can be used independently of the ORM.  When using the ORM, the SQL Expression language is used to establish object-relational configurations as well as in querying.
</p>



            <a href="#overview" class="totoc">back to section top</a>
    </div>



    
    <A name="overview_tutorials"></a>
    
    <div class="sectionL2">

    <h3>Tutorials</h3>
    
    

<ul>
 <li>
     <a href="#datamapping">Object Relational Tutorial</a> - This describes the richest feature of SQLAlchemy, its object relational mapper.  If you want to work with higher-level SQL which is constructed automatically for you, as well as management of Python objects, proceed to this tutorial.
 </li>

 <li>
     <a href="#sql">SQL Expression Tutorial</a> - The core of SQLAlchemy is its SQL expression language.  The SQL Expression Language is a toolkit all its own, independent of the ORM package, which can be used to construct manipulable SQL expressions which can be programmatically constructed, modified, and executed, returning cursor-like result sets.  It's a lot more lightweight than the ORM and is appropriate for higher scaling SQL operations.  It's also heavily present within the ORM's public facing API, so advanced ORM users will want to master this language as well.
 </li>
</ul>



            <a href="#overview" class="totoc">back to section top</a>
    </div>



    
    <A name="overview_reference"></a>
    
    <div class="sectionL2">

    <h3>Reference Documentation</h3>
    
    

<ul>
 <li>
     <a href="#advdatamapping">Datamapping</a> - A comprehensive walkthrough of major ORM patterns and techniques.
 </li>

 <li>
     <a href="#unitofwork">Session</a> - A detailed description of SQLAlchemy's Session object
 </li>

 <li>
     <a href="#dbengine">Engines</a> - Describes SQLAlchemy's database-connection facilities, including connection documentation and working with connections and transactions. 
 </li>

 <li>
     <a href="#pooling">Connection Pools</a> - Further detail about SQLAlchemy's connection pool library.
 </li>

 <li>
     <a href="#metadata">Metadata</a> - All about schema management using <code>MetaData</code> and <code>Table</code> objects; reading database schemas into your application, creating and dropping tables, constraints, defaults, sequences, indexes.
 </li>

 <li>
     <a href="#types">Types</a> - Datatypes included with SQLAlchemy, their functions, as well as how to create your own types.
 </li>

 <li>
     <a href="#plugins">Plugins</a> - Included addons for SQLAlchemy
 </li>
</ul>



            <a href="#overview" class="totoc">back to section top</a>
    </div>



    
    <A name="overview_sqlalchemy"></a>
    
    <div class="sectionL2">

    <h3>Installing SQLAlchemy</h3>
    
    

<p>Installing SQLAlchemy from scratch is most easily achieved with <a href='http://peak.telecommunity.com/DevCenter/setuptools'>setuptools</a>.  (<a href='http://peak.telecommunity.com/DevCenter/EasyInstall#installation-instructions'>setuptools installation</a>). Just run this from the command-line:
</p>
<pre><code># easy_install SQLAlchemy
</code></pre><p>This command will download the latest version of SQLAlchemy from the <a href='http://pypi.python.org/pypi/SQLAlchemy'>Python Cheese Shop</a> and install it to your system.
</p>
<p>Otherwise, you can install from the distribution using the <code>setup.py</code> script:
</p>
<pre><code># python setup.py install
</code></pre>

    
    <A name="overview_sqlalchemy_dbms"></a>
    
    <div class="sectionL3">

    <h3>Installing a Database API</h3>
    
    

<p>SQLAlchemy is designed to operate with a <a href='http://www.python.org/doc/peps/pep-0249/'>DB-API</a> implementation built for a particular database, and includes support for the most popular databases:
</p>
<ul>
 <li>
     Postgres:  <a href='http://www.initd.org/tracker/psycopg/wiki/PsycopgTwo'>psycopg2</a>
 </li>

 <li>
     SQLite:  <a href='http://initd.org/tracker/pysqlite'>pysqlite</a>, <a href='http://docs.python.org/lib/module-sqlite3.html'>sqlite3</a> (included with Python 2.5 or greater)
 </li>

 <li>
     MySQL:   <a href='http://sourceforge.net/projects/mysql-python'>MySQLdb</a>
 </li>

 <li>
     Oracle:  <a href='http://www.cxtools.net/default.aspx?nav=home'>cx_Oracle</a>
 </li>

 <li>
     MS-SQL, MSAccess:  <a href='http://pyodbc.sourceforge.net/'>pyodbc</a> (recommended), <a href='http://adodbapi.sourceforge.net/'>adodbapi</a>  or <a href='http://pymssql.sourceforge.net/'>pymssql</a>
 </li>

 <li>
     Firebird:  <a href='http://kinterbasdb.sourceforge.net/'>kinterbasdb</a>
 </li>

 <li>
     Informix:  <a href='http://informixdb.sourceforge.net/'>informixdb</a>
 </li>

 <li>
     DB2/Informix IDS: <a href='http://code.google.com/p/ibm-db/'>ibm-db</a>
 </li>

 <li>
     Sybase:   TODO
 </li>

 <li>
     MAXDB:    TODO
 </li>
</ul>



            <a href="#overview" class="totoc">back to section top</a>
    </div>



    
    <A name="overview_sqlalchemy_checking"></a>
    
    <div class="sectionL3">

    <h3>Checking the Installed SQLAlchemy Version</h3>
    
    

<p>This documentation covers SQLAlchemy version 0.5.  If you're working on a system that already has SQLAlchemy installed, check the version from your Python prompt like this:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">__version__ </span><span class="python_operator">
</span><span class="python_number">0.5.0</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#overview" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="overview_migration"></a>
    
    <div class="sectionL2">

    <h3>0.4 to 0.5 Migration</h3>
    
    

<p>Notes on what's changed from 0.4 to 0.5 is available on the SQLAlchemy wiki at <a href='http://www.sqlalchemy.org/trac/wiki/05Migration'>05Migration</a>.
</p>




            <a href="#overview" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="datamapping"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#overview">Overview / Installation</a>

               |   
            Next: <a href="#sql">SQL Expression Language Tutorial</a>
    </div>

        <h2>Object Relational Tutorial</h2>
    </div>


        








    
    <A name="datamapping"></a>
    
    <div class="sectionL1">

    
    

<p>In this tutorial we will cover a basic SQLAlchemy object-relational mapping scenario, where we store and retrieve Python objects from a database representation.  The tutorial is in doctest format, meaning each <code>&gt;&gt;&gt;</code> line represents something you can type at a Python command prompt, and the following text represents the expected return value.
</p>


    
    <A name="datamapping_version"></a>
    
    <div class="sectionL2">

    <h3>Version Check</h3>
    
    

<p>A quick check to verify that we are on at least <strong>version 0.5</strong> of SQLAlchemy:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">__version__ </span><span class="python_operator">
</span><span class="python_number">0.5.0</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_connecting"></a>
    
    <div class="sectionL2">

    <h3>Connecting</h3>
    
    

<p>For this tutorial we will use an in-memory-only SQLite database.  To connect we use <code>create_engine()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">create_engine</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>echo</code> flag is a shortcut to setting up SQLAlchemy logging, which is accomplished via Python's standard <code>logging</code> module.  With it enabled, we'll see all the generated SQL produced.  If you are working through this tutorial and want less output generated, set it to <code>False</code>.   This tutorial will format the SQL behind a popup window so it doesn't get in our way; just click the "SQL" links to see what's being generated.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_tables"></a>
    
    <div class="sectionL2">

    <h3>Define and Create a Table</h3>
    
    

<p>Next we want to tell SQLAlchemy about our tables.  We will start with just a single table called <code>users</code>, which will store records for the end-users using our application (lets assume it's a website).  We define our tables within a catalog called <code>MetaData</code>, using the <code>Table</code> construct, which is used in a manner similar to SQL's CREATE TABLE syntax:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">Table</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_operator">, </span><span class="python_name">MetaData</span><span class="python_operator">, </span><span class="python_name">ForeignKey    </span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'fullname'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>All about how to define <code>Table</code> objects, as well as how to load their definition from an existing database (known as <strong>reflection</strong>), is described in <a href="#metadata">Database Meta Data</a>.
</p>
<p>Next, we can issue CREATE TABLE statements derived from our table metadata, by calling <code>create_all()</code> and passing it the <code>engine</code> instance which points to our database.  This will check for the presence of a table first before creating, so it's safe to call multiple times:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_1', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_1_div" class="codepop" style="display:none;">PRAGMA table_info(&quot;users&quot;)<br/>
{}<br/>
CREATE TABLE users (<br/>
    id INTEGER NOT NULL, <br/>
    name VARCHAR, <br/>
    fullname VARCHAR, <br/>
    password VARCHAR, <br/>
    PRIMARY KEY (id)<br/>
)<br/>
{}<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Users familiar with the syntax of CREATE TABLE may notice that the VARCHAR columns were generated without a length; on SQLite, this is a valid datatype, but on most databases it's not allowed.  So if running this tutorial on a database such as Postgres or MySQL, and you wish to use SQLAlchemy to generate the tables, a "length" may be provided to the <code>String</code> type as below:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The length field on <code>String</code>, as well as similar precision/scale fields available on <code>Integer</code>, <code>Numeric</code>, etc. are not referenced by SQLAlchemy other than when creating tables.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_mapping"></a>
    
    <div class="sectionL2">

    <h3>Define a Python Class to be Mapped</h3>
    
    

<p>While the <code>Table</code> object defines information about our database, it does not say anything about the definition or behavior of the business objects used by our application;  SQLAlchemy views this as a separate concern.  To correspond to our <code>users</code> table, let's create a rudimentary <code>User</code> class.  It only need subclass Python's built-in <code>object</code> class (i.e. it's a new style class):
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">= </span><span class="python_name">fullname</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...        </span><span class="python_keyword">return </span><span class="python_literal">"&lt;User('%s','%s', '%s')&gt;" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The class has an <code>__init__()</code> and a <code>__repr__()</code> method for convenience.  These methods are both entirely optional, and can be of any form.  SQLAlchemy never calls <code>__init__()</code> directly.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_setting"></a>
    
    <div class="sectionL2">

    <h3>Setting up the Mapping</h3>
    
    

<p>With our <code>users_table</code> and <code>User</code> class, we now want to map the two together.  That's where the SQLAlchemy ORM package comes in.  We'll use the <code>mapper</code> function to create a <strong>mapping</strong> between <code>users_table</code> and <code>User</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">mapper</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">) </span><span class="python_operator">
&lt;</span><span class="python_name">Mapper at </span><span class="python_number">0x</span><span class="python_operator">...; </span><span class="python_name">User</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>The <code>mapper()</code> function creates a new <code>Mapper</code> object and stores it away for future reference, associated with our class.  Let's now create and inspect a <code>User</code> object:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'edspassword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_literal">'ed'</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_operator">
</span><span class="python_literal">'edspassword'</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">'None'</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>id</code> attribute, which while not defined by our <code>__init__()</code> method, exists due to the <code>id</code> column present within the <code>users_table</code> object.  By default, the <code>mapper</code> creates class attributes for all columns present within the <code>Table</code>.  These class attributes exist as Python descriptors, and define <strong>instrumentation</strong> for the mapped class.  The functionality of this instrumentation is very rich and includes the ability to track modifications and automatically load new data from the database when needed.
</p>
<p>Since we have not yet told SQLAlchemy to persist <code>Ed Jones</code> within the database, its id is <code>None</code>.  When we persist the object later, this attribute will be populated with a newly generated value.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_declarative"></a>
    
    <div class="sectionL2">

    <h3>Creating Table, Class and Mapper All at Once Declaratively</h3>
    
    

<p>The preceding approach to configuration involving a <code>Table</code>, user-defined class, and <code>mapper()</code> call illustrate classical SQLAlchemy usage, which values the highest separation of concerns possible.  A large number of applications don't require this degree of separation, and for those SQLAlchemy offers an alternate "shorthand" configurational style called <strong>declarative</strong>.  For many applications, this is the only style of configuration needed.  Our above example using this style is as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">declarative </span><span class="python_keyword">import </span><span class="python_name">declarative_base</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">Base </span><span class="python_operator">= </span><span class="python_name">declarative_base</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'users'</span><span class="python_operator">
...
...     </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">fullname </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">= </span><span class="python_name">fullname</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_name">password</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...        </span><span class="python_keyword">return </span><span class="python_literal">"&lt;User('%s','%s', '%s')&gt;" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">password</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the <code>declarative_base()</code> function defines a new class which we name <code>Base</code>, from which all of our ORM-enabled classes will derive.  Note that we define <code>Column</code> objects with no "name" field, since it's inferred from the given attribute name.
</p>
<p>The underlying <code>Table</code> object created by our <code>declarative_base()</code> version of <code>User</code> is accessible via the <code>__table__</code> attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">__table__</span><span class="python_operator">
</span></pre>
    </div>
<p>and the owning <code>MetaData</code> object is available as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">Base</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">
</span></pre>
    </div>
<p>Yet another "declarative" method is available for SQLAlchemy as a third party library called <a href='http://elixir.ematia.de/'>Elixir</a>.  This is a full-featured configurational product which also includes many higher level mapping configurations built in.  Like declarative, once classes and mappings are defined, ORM usage is the same as with a classical SQLAlchemy configuration.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_creating"></a>
    
    <div class="sectionL2">

    <h3>Creating a Session</h3>
    
    

<p>We're now ready to start talking to the database.  The ORM's "handle" to the database is the <code>Session</code>.  When we first set up the application, at the same level as our <code>create_engine()</code> statement, we define a <code>Session</code> class which will serve as a factory for new <code>Session</code> objects:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">sessionmaker</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>In the case where your application does not yet have an <code>Engine</code> when you define your module-level objects, just set it up like this:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Later, when you create your engine with <code>create_engine()</code>, connect it to the <code>Session</code> using <code>configure()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">configure</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)  </span><span class="python_comment"># once engine is available</span><span class="python_operator">
</span></pre>
    </div>
<p>This custom-made <code>Session</code> class will create new <code>Session</code> objects which are bound to our database.  Other transactional characteristics may be defined when calling <code>sessionmaker()</code> as well; these are described in a later chapter.  Then, whenever you need to have a conversation with the database, you instantiate a <code>Session</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The above <code>Session</code> is associated with our SQLite <code>engine</code>, but it hasn't opened any connections yet.  When it's first used, it retrieves a connection from a pool of connections maintained by the <code>engine</code>, and holds onto it until we commit all changes and/or close the session object.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_adding"></a>
    
    <div class="sectionL2">

    <h3>Adding new Objects</h3>
    
    

<p>To persist our <code>User</code> object, we <code>add()</code> it to our <code>Session</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'edspassword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">ed_user</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>At this point, the instance is <strong>pending</strong>; no SQL has yet been issued.  The <code>Session</code> will issue the SQL to persist <code>Ed Jones</code> as soon as is needed, using a process known as a <strong>flush</strong>.  If we query the database for <code>Ed Jones</code>, all pending information will first be flushed, and the query is issued afterwards.
</p>
<p>For example, below we create a new <code>Query</code> object which loads instances of <code>User</code>.  We "filter by" the <code>name</code> attribute of <code>ed</code>, and indicate that we'd like only the first result in the full list of rows.  A <code>User</code> instance is returned which is equivalent to that which we've added:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_2', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">our_user </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">first</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_2_div" class="codepop" style="display:none;">BEGIN<br/>
INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['ed', 'Ed Jones', 'edspassword']<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name = ?<br/>
 LIMIT 1 OFFSET 0<br/>
['ed']</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">our_user</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'edspassword'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>In fact, the <code>Session</code> has identified that the row returned is the <strong>same</strong> row as one already represented within its internal map of objects, so we actually got back the identical instance as that which we just added:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user </span><span class="python_keyword">is </span><span class="python_name">our_user</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span></pre>
    </div>
<p>The ORM concept at work here is known as an <strong>identity map</strong> and ensures that all operations upon a particular row within a <code>Session</code> operate upon the same set of data.  Once an object with a particular primary key is present in the <code>Session</code>, all SQL queries on that <code>Session</code> will always return the same Python object for that particular primary key; it also will raise an error if an attempt is made to place a second, already-persisted object with the same primary key within the session.
</p>
<p>We can add more <code>User</code> objects at once using <code>add_all()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add_all</span><span class="python_enclosure">([</span>
<span class="python_operator">...     </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">, </span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'mary'</span><span class="python_operator">, </span><span class="python_literal">'Mary Contrary'</span><span class="python_operator">, </span><span class="python_literal">'xxg527'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)])</span><span class="python_operator">
</span></pre>
    </div>
<p>Also, Ed has already decided his password isn't too secure, so lets change it:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">password </span><span class="python_operator">= </span><span class="python_literal">'f8s7ccs'</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Session</code> is paying attention.  It knows, for example, that <code>Ed Jones</code> has been modified:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">dirty</span><span class="python_operator">
</span><span class="python_name">IdentitySet</span><span class="python_enclosure">([</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>and that three new <code>User</code> objects are pending:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">new  </span><span class="python_operator">
</span><span class="python_name">IdentitySet</span><span class="python_enclosure">([</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, </span>
<span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'mary'</span><span class="python_operator">,</span><span class="python_literal">'Mary Contrary'</span><span class="python_operator">, </span><span class="python_literal">'xxg527'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, </span>
<span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">,</span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>We tell the <code>Session</code> that we'd like to issue all remaining changes to the database and commit the transaction, which has been in progress throughout.  We do this via <code>commit()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_3', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_3_div" class="codepop" style="display:none;">UPDATE users SET password=? WHERE users.id = ?<br/>
['f8s7ccs', 1]<br/>
INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['wendy', 'Wendy Williams', 'foobar']<br/>
INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['mary', 'Mary Contrary', 'xxg527']<br/>
INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['fred', 'Fred Flinstone', 'blah']<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p><code>commit()</code> flushes whatever remaining changes remain to the database, and commits the transaction.  The connection resources referenced by the session are now returned to the connection pool.  Subsequent operations with this session will occur in a <strong>new</strong> transaction, which will again re-acquire connection resources when first needed.
</p>
<p>If we look at Ed's <code>id</code> attribute, which earlier was <code>None</code>, it now has a value:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_4', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator"> </span></pre><div id="popbox_4_div" class="codepop" style="display:none;">BEGIN<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.id = ?<br/>
[1]</div><pre><span class="python_number">1</span><span class="python_operator">
</span></pre>
    </div>
<p>After the <code>Session</code> inserts new rows in the database, all newly generated identifiers and database-generated defaults become available on the instance, either immediately or via load-on-first-access.  In this case, the entire row was re-loaded on access because a new transaction was begun after we issued <code>commit()</code>.  SQLAlchemy by default refreshes data from a previous transaction the first time it's accessed within a new transaction, so that the most recent state is available.  The level of reloading is configurable as is described in the chapter on Sessions.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_rolling"></a>
    
    <div class="sectionL2">

    <h3>Rolling Back</h3>
    
    

<p>Since the <code>Session</code> works within a transaction, we can roll back changes made too.   Let's make two changes that we'll revert; <code>ed_user</code>'s user name gets set to <code>Edwardo</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_literal">'Edwardo'</span><span class="python_operator">
</span></pre>
    </div>
<p>and we'll add another erroneous user, <code>fake_user</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">fake_user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fakeuser'</span><span class="python_operator">, </span><span class="python_literal">'Invalid'</span><span class="python_operator">, </span><span class="python_literal">'12345'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">fake_user</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Querying the session, we can see that they're flushed into the current transaction:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_5', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'Edwardo'</span><span class="python_operator">, </span><span class="python_literal">'fakeuser'</span><span class="python_enclosure">]))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_5_div" class="codepop" style="display:none;">UPDATE users SET name=? WHERE users.id = ?<br/>
['Edwardo', 1]<br/>
INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['fakeuser', 'Invalid', '12345']<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name IN (?, ?)<br/>
['Edwardo', 'fakeuser']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'Edwardo'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fakeuser'</span><span class="python_operator">,</span><span class="python_literal">'Invalid'</span><span class="python_operator">, </span><span class="python_literal">'12345'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>Rolling back, we can see that <code>ed_user</code>'s name is back to <code>ed</code>, and <code>fake_user</code> has been kicked out of the session:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_6', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_6_div" class="codepop" style="display:none;">ROLLBACK</div><pre><span class="python_literal"><a href="javascript:togglePopbox('popbox_7', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">ed_user</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_7_div" class="codepop" style="display:none;">BEGIN<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.id = ?<br/>
[1]</div><pre><span class="python_literal">u'ed'</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">fake_user </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">
</span><span class="python_name">False</span><span class="python_operator">
</span></pre>
    </div>
<p>issuing a SELECT illustrates the changes made to the database:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_8', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'fakeuser'</span><span class="python_enclosure">]))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_8_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name IN (?, ?)<br/>
['ed', 'fakeuser']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_querying"></a>
    
    <div class="sectionL2">

    <h3>Querying</h3>
    
    

<p>A <code>Query</code> is created using the <code>query()</code> function on <code>Session</code>.  This function takes a variable number of arguments, which can be any combination of classes and class-instrumented descriptors.  Below, we indicate a <code>Query</code> which loads <code>User</code> instances.  When evaluated in an iterative context, the list of <code>User</code> objects present is returned:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_9', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">instance </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">instance</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">instance</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator"> </span></pre><div id="popbox_9_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, <br/>
users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users ORDER BY users.id<br/>
[]</div><pre><span class="python_name">ed Ed Jones</span><span class="python_operator">
</span><span class="python_name">wendy Wendy Williams</span><span class="python_operator">
</span><span class="python_name">mary Mary Contrary</span><span class="python_operator">
</span><span class="python_name">fred Fred Flinstone</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Query</code> also accepts ORM-instrumented descriptors as arguments.  Any time multiple class entities or column-based entities are expressed as arguments to the <code>query()</code> function, the return result is expressed as tuples:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_10', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">fullname </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">)</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator"></span></pre><div id="popbox_10_div" class="codepop" style="display:none;">SELECT users.name AS users_name, users.fullname AS users_fullname<br/>
FROM users<br/>
[]</div><pre><span class="python_name">ed Ed Jones</span><span class="python_operator">
</span><span class="python_name">wendy Wendy Williams</span><span class="python_operator">
</span><span class="python_name">mary Mary Contrary</span><span class="python_operator">
</span><span class="python_name">fred Fred Flinstone</span><span class="python_operator">
</span></pre>
    </div>
<p>The tuples returned by <code>Query</code> are <em>named</em> tuples, and can be treated much like an ordinary Python object.  The names are the same as the attribute's name for an attribute, and the class name for a class:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_11', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">:
...    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_11_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users<br/>
[]</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">ed</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">wendy</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'mary'</span><span class="python_operator">,</span><span class="python_literal">'Mary Contrary'</span><span class="python_operator">, </span><span class="python_literal">'xxg527'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">mary</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">,</span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">fred</span><span class="python_operator">
</span></pre>
    </div>
<p>You can control the names using the <code>label()</code> construct for scalar attributes and <code>aliased()</code> for class constructs:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">aliased</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user_alias </span><span class="python_operator">= </span><span class="python_name">aliased</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user_alias'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_12', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">user_alias</span><span class="python_operator">, </span><span class="python_name">user_alias</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'name_label'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">:
...    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">user_alias</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_operator">.</span><span class="python_name">name_label</span><span class="python_operator"></span></pre><div id="popbox_12_div" class="codepop" style="display:none;">SELECT users_1.id AS users_1_id, users_1.name AS users_1_name, users_1.fullname AS users_1_fullname, users_1.password AS users_1_password, users_1.name AS name_label <br/>
FROM users AS users_1<br/>
[]<br/>
&lt;User('ed','Ed Jones', 'f8s7ccs')&gt; ed<br/>
&lt;User('wendy','Wendy Williams', 'foobar')&gt; wendy<br/>
&lt;User('mary','Mary Contrary', 'xxg527')&gt; mary<br/>
&lt;User('fred','Fred Flinstone', 'blah')&gt; fred</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Basic operations with <code>Query</code> include issuing LIMIT and OFFSET, most conveniently using Python array slices and typically in conjunction with ORDER BY:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_13', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">u </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)[</span><span class="python_number">1</span><span class="python_operator">:</span><span class="python_number">3</span><span class="python_enclosure">]</span><span class="python_operator">: 
...    </span><span class="python_keyword">print </span><span class="python_name">u</span><span class="python_operator"></span></pre><div id="popbox_13_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users ORDER BY users.id <br/>
LIMIT 2 OFFSET 1<br/>
[]</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'mary'</span><span class="python_operator">,</span><span class="python_literal">'Mary Contrary'</span><span class="python_operator">, </span><span class="python_literal">'xxg527'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>and filtering results, which is accomplished either with <code>filter_by()</code>, which uses keyword arguments:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_14', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">'Ed Jones'</span><span class="python_enclosure">)</span><span class="python_operator">: 
...    </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_14_div" class="codepop" style="display:none;">SELECT users.name AS users_name FROM users <br/>
WHERE users.fullname = ?<br/>
['Ed Jones']</div><pre><span class="python_name">ed</span><span class="python_operator">
</span></pre>
    </div>
<p>...or <code>filter()</code>, which uses more flexible SQL expression language constructs.  These allow you to use regular Python operators with the class-level attributes on your mapped class:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_15', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">==</span><span class="python_literal">'Ed Jones'</span><span class="python_enclosure">)</span><span class="python_operator">: 
...    </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_15_div" class="codepop" style="display:none;">SELECT users.name AS users_name FROM users <br/>
WHERE users.fullname = ?<br/>
['Ed Jones']</div><pre><span class="python_name">ed</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Query</code> object is fully <em>generative</em>, meaning that most method calls return a new <code>Query</code> object upon which further criteria may be added.  For example, to query for users named "ed" with a full name of "Ed Jones", you can call <code>filter()</code> twice, which joins criteria using <code>AND</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_16', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">user </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">==</span><span class="python_literal">'Ed Jones'</span><span class="python_enclosure">)</span><span class="python_operator">: 
...    </span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator"></span></pre><div id="popbox_16_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name = ? AND users.fullname = ?<br/>
['ed', 'Ed Jones']</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>


    
    <A name="datamapping_querying_common"></a>
    
    <div class="sectionL3">

    <h3>Common Filter Operators</h3>
    
    

<p>Here's a rundown of some of the most common operators used in <code>filter()</code>:
</p>
<ul>
 <li><p>equals
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>not equals
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">!= </span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>LIKE
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%ed%'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>IN
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_literal">'wendy'</span><span class="python_operator">, </span><span class="python_literal">'jack'</span><span class="python_enclosure">]))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>IS NULL
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>AND
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">and_</span><span class="python_operator">
</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">== </span><span class="python_literal">'Ed Jones'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># or call filter()/filter_by() multiple times
</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">== </span><span class="python_literal">'Ed Jones'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>OR
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">or_</span><span class="python_operator">
</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_literal">'wendy'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>match
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">match</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The contents of the match parameter are database backend specific.
</p>

 </li>
</ul>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_querying_scalars"></a>
    
    <div class="sectionL3">

    <h3>Returning Lists and Scalars</h3>
    
    

<p>The <code>all()</code>, <code>one()</code>, and <code>first()</code> methods of <code>Query</code> immediately issue SQL and return a non-iterator value.  <code>all()</code> returns a list:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%ed'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_17', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_17_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name LIKE ? ORDER BY users.id<br/>
['%ed']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">,</span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p><code>first()</code> applies a limit of one and returns the first result as a scalar:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_18', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">first</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_18_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name LIKE ? ORDER BY users.id <br/>
 LIMIT 1 OFFSET 0<br/>
['%ed']</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p><code>one()</code>, applies a limit of <em>two</em>, and if not exactly one row returned, raises an error:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_19', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">try</span><span class="python_operator">:  
...     </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">() </span><span class="python_operator">
... </span><span class="python_keyword">except </span><span class="python_name">Exception</span><span class="python_operator">, </span><span class="python_name">e</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">e</span><span class="python_operator"></span></pre><div id="popbox_19_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name LIKE ? ORDER BY users.id <br/>
 LIMIT 2 OFFSET 0<br/>
['%ed']</div><pre><span class="python_name">Multiple rows were found </span><span class="python_keyword">for </span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_20', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">try</span><span class="python_operator">:
...     </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">== </span><span class="python_number">99</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">() </span><span class="python_operator">
... </span><span class="python_keyword">except </span><span class="python_name">Exception</span><span class="python_operator">, </span><span class="python_name">e</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">e</span><span class="python_operator"></span></pre><div id="popbox_20_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name LIKE ? AND users.id = ? ORDER BY users.id <br/>
 LIMIT 2 OFFSET 0<br/>
['%ed', 99]</div><pre><span class="python_name">No row was found </span><span class="python_keyword">for </span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_querying_using"></a>
    
    <div class="sectionL3">

    <h3>Using Literal SQL</h3>
    
    

<p>Literal strings can be used flexibly with <code>Query</code>.  Most methods accept strings in addition to SQLAlchemy clause constructs.  For example, <code>filter()</code> and <code>order_by()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_21', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">user </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_literal">"id&lt;224"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_literal">"id"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_21_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE id&lt;224 ORDER BY id<br/>
[]</div><pre><span class="python_name">ed</span><span class="python_operator">
</span><span class="python_name">wendy</span><span class="python_operator">
</span><span class="python_name">mary</span><span class="python_operator">
</span><span class="python_name">fred</span><span class="python_operator">
</span></pre>
    </div>
<p>Bind parameters can be specified with string-based SQL, using a colon.  To specify the values, use the <code>params()</code> method:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_22', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_literal">"id&lt;:value and name=:name"</span><span class="python_enclosure">)</span><span class="python_operator">.\
...     </span><span class="python_name">params</span><span class="python_enclosure">(</span><span class="python_name">value</span><span class="python_operator">=</span><span class="python_number">224</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_22_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE id&lt;? and name=? ORDER BY users.id <br/>
LIMIT 2 OFFSET 0<br/>
[224, 'fred']</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">,</span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>To use an entirely string-based statement, using <code>from_statement()</code>; just ensure that the columns clause of the statement contains the column names normally used by the mapper (below illustrated using an asterisk):
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_23', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">from_statement</span><span class="python_enclosure">(</span><span class="python_literal">"SELECT * FROM users where name=:name"</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">params</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_23_div" class="codepop" style="display:none;">SELECT * FROM users where name=?<br/>
['ed']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_relation"></a>
    
    <div class="sectionL2">

    <h3>Building a Relation</h3>
    
    

<p>Now let's consider a second table to be dealt with.  Users in our system also can store any number of email addresses associated with their username.  This implies a basic one to many association from the <code>users_table</code> to a new table which stores email addresses, which we will call <code>addresses</code>.  Using declarative, we define this table along with its mapped class, <code>Address</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">ForeignKey</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">relation</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'addresses'</span><span class="python_operator">
...     </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">email_address </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.id'</span><span class="python_enclosure">))</span><span class="python_operator">
...
...     </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">id</span><span class="python_enclosure">))</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= </span><span class="python_name">email_address</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_keyword">return </span><span class="python_literal">"&lt;Address('%s')&gt;" </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">
</span></pre>
    </div>
<p>The above class introduces a <strong>foreign key</strong> constraint which references the <code>users</code> table.  This defines for SQLAlchemy the relationship between the two tables at the database level.  The relationship between the <code>User</code> and <code>Address</code> classes is defined separately using the <code>relation()</code> function, which defines an attribute <code>user</code> to be placed on the <code>Address</code> class, as well as an <code>addresses</code> collection to be placed on the <code>User</code> class.  Such a relation is known as a <strong>bidirectional</strong> relationship.   Because of the placement of the foreign key, from <code>Address</code> to <code>User</code> it is <strong>many to one</strong>, and from <code>User</code> to <code>Address</code> it is <strong>one to many</strong>.  SQLAlchemy is automatically aware of many-to-one/one-to-many based on foreign keys.
</p>
<p>The <code>relation()</code> function is extremely flexible, and could just have easily been defined on the <code>User</code> class:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    ....
    </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">"user"</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>We are also free to not define a backref, and to define the <code>relation()</code> only on one class and not the other.   It is also possible to define two separate <code>relation()</code>s for either direction, which is generally safe for many-to-one and one-to-many relations, but not for many-to-many relations.
</p>
<p>When using the <code>declarative</code> extension, <code>relation()</code> gives us the option to use strings for most arguments that concern the target class, in the case that the target class has not yet been defined.  This <strong>only</strong> works in conjunction with <code>declarative</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    ....
    </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_literal">"Address"</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_literal">"Address.id"</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">"user"</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>When <code>declarative</code> is not in use, you typically define your <code>mapper()</code> well after the target classes and <code>Table</code> objects have been defined, so string expressions are not needed.
</p>
<p>We'll need to create the <code>addresses</code> table in the database, so we will issue another CREATE from our metadata, which will skip over tables which have already been created:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_24', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_24_div" class="codepop" style="display:none;">PRAGMA table_info(&quot;users&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;addresses&quot;)<br/>
{}<br/>
CREATE TABLE addresses (<br/>
    id INTEGER NOT NULL, <br/>
    email_address VARCHAR NOT NULL, <br/>
    user_id INTEGER, <br/>
    PRIMARY KEY (id), <br/>
     FOREIGN KEY(user_id) REFERENCES users (id)<br/>
)<br/>
{}<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_related_objects"></a>
    
    <div class="sectionL2">

    <h3>Working with Related Objects</h3>
    
    

<p>Now when we create a <code>User</code>, a blank <code>addresses</code> collection will be present.  By default, the collection is a Python list.  Other collection types, such as sets and dictionaries, are available as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">
</span><span class="python_enclosure">[]</span><span class="python_operator">
</span></pre>
    </div>
<p>We are free to add <code>Address</code> objects on our <code>User</code> object.  In this case we just assign a full list directly:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_enclosure">[</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">=</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">=</span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>When using a bidirectional relationship, elements added in one direction automatically become visible in the other direction.  This is the basic behavior of the <strong>backref</strong> keyword, which maintains the relationship purely in memory, without using any SQL:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
&lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>Let's add and commit <code>Jack Bean</code> to the database.  <code>jack</code> as well as the two <code>Address</code> members in his <code>addresses</code> collection are both added to the session at once, using a process known as <strong>cascading</strong>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">jack</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_25', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_25_div" class="codepop" style="display:none;">INSERT INTO users (name, fullname, password) VALUES (?, ?, ?)<br/>
['jack', 'Jack Bean', 'gjffdd']<br/>
INSERT INTO addresses (email_address, user_id) VALUES (?, ?)<br/>
['jack@google.com', 5]<br/>
INSERT INTO addresses (email_address, user_id) VALUES (?, ?)<br/>
['j25@yahoo.com', 5]<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Querying for Jack, we get just Jack back.  No SQL is yet issued for Jack's addresses:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_26', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_26_div" class="codepop" style="display:none;">BEGIN<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name = ? <br/>
 LIMIT 2 OFFSET 0<br/>
['jack']</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>Let's look at the <code>addresses</code> collection.  Watch the SQL:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_27', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator"></span></pre><div id="popbox_27_div" class="codepop" style="display:none;">SELECT addresses.id AS addresses_id, addresses.email_address AS addresses_email_address, addresses.user_id AS addresses_user_id <br/>
FROM addresses <br/>
WHERE ? = addresses.user_id ORDER BY addresses.id<br/>
[5]</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>When we accessed the <code>addresses</code> collection, SQL was suddenly issued.  This is an example of a <strong>lazy loading relation</strong>.  The <code>addresses</code> collection is now loaded and behaves just like an ordinary list.  <br></br>
</p>
<p>If you want to reduce the number of queries (dramatically, in many cases), we can apply an <strong>eager load</strong> to the query operation.   With the same query, we may apply an <strong>option</strong> to the query, indicating that we'd like <code>addresses</code> to load "eagerly".  SQLAlchemy then constructs an outer join between the <code>users</code> and <code>addresses</code> tables, and loads them at once, populating the <code>addresses</code> collection on each <code>User</code> object if it's not already populated:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">eagerload</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_28', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_28_div" class="codepop" style="display:none;">SELECT anon_1.users_id AS anon_1_users_id, anon_1.users_name AS anon_1_users_name, <br/>
anon_1.users_fullname AS anon_1_users_fullname, anon_1.users_password AS anon_1_users_password, <br/>
addresses_1.id AS addresses_1_id, addresses_1.email_address AS addresses_1_email_address, <br/>
addresses_1.user_id AS addresses_1_user_id <br/>
    FROM (SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, <br/>
    users.password AS users_password<br/>
    FROM users WHERE users.name = ? <br/>
     LIMIT 2 OFFSET 0) AS anon_1 LEFT OUTER JOIN addresses AS addresses_1 <br/>
     ON anon_1.users_id = addresses_1.user_id ORDER BY addresses_1.id<br/>
    ['jack']</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>SQLAlchemy has the ability to control exactly which attributes and how many levels deep should be joined together in a single SQL query.  More information on this feature is available in <a href="#advdatamapping_relation">Relation Configuration</a>.
</p>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_joins"></a>
    
    <div class="sectionL2">

    <h3>Querying with Joins</h3>
    
    

<p>While the eager load created a JOIN specifically to populate a collection, we can also work explicitly with joins in many ways.  For example, to construct a simple inner join between <code>User</code> and <code>Address</code>, we can just <code>filter()</code> their related columns together.  Below we load the <code>User</code> and <code>Address</code> entities at once using this method:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_29', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">u</span><span class="python_operator">, </span><span class="python_name">a </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.\
...         </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">:   
...     </span><span class="python_keyword">print </span><span class="python_name">u</span><span class="python_operator">, </span><span class="python_name">a</span><span class="python_operator"></span></pre><div id="popbox_29_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, <br/>
users.password AS users_password, addresses.id AS addresses_id, <br/>
addresses.email_address AS addresses_email_address, addresses.user_id AS addresses_user_id <br/>
FROM users, addresses <br/>
WHERE users.id = addresses.user_id AND addresses.email_address = ?<br/>
['jack@google.com']</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; &lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>Or we can make a real JOIN construct; one way to do so is to use the ORM <code>join()</code> function, and tell <code>Query</code> to "select from" this join:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">join</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_30', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_from</span><span class="python_enclosure">(</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_enclosure">))</span><span class="python_operator">.\
...         </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_30_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users JOIN addresses ON users.id = addresses.user_id <br/>
WHERE addresses.email_address = ?<br/>
['jack@google.com']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p><code>join()</code> knows how to join between <code>User</code> and <code>Address</code> because there's only one foreign key between them.  If there were no foreign keys, or several, <code>join()</code> would require a third argument indicating the ON clause of the join, in one of the following forms:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)  </span><span class="python_comment"># explicit condition</span><span class="python_operator">
</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">)            </span><span class="python_comment"># specify relation from left to right</span><span class="python_operator">
</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_literal">'addresses'</span><span class="python_enclosure">)               </span><span class="python_comment"># same, using a string</span><span class="python_operator">
</span></pre>
    </div>
<p>The functionality of <code>join()</code> is also available generatively from <code>Query</code> itself using <code>Query.join</code>.  This is most easily used with just the "ON" clause portion of the join, such as:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_31', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.\
...     </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_31_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users JOIN addresses ON users.id = addresses.user_id <br/>
WHERE addresses.email_address = ?<br/>
['jack@google.com']</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>To explicitly specify the target of the join, use tuples to form an argument list similar to the standalone join.  This becomes more important when using aliases and similar constructs:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">((</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Multiple joins can be created by passing a list of arguments:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Foo</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">Foo</span><span class="python_operator">.</span><span class="python_name">bars</span><span class="python_operator">, </span><span class="python_name">Bar</span><span class="python_operator">.</span><span class="python_name">bats</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">Bat</span><span class="python_operator">, </span><span class="python_literal">'widgets'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The above would produce SQL something like <code>foo JOIN bars ON &lt;onclause&gt; JOIN bats ON &lt;onclause&gt; JOIN widgets ON &lt;onclause&gt;</code>.
</p>


    
    <A name="datamapping_joins_aliases"></a>
    
    <div class="sectionL3">

    <h3>Using Aliases</h3>
    
    

<p>When querying across multiple tables, if the same table needs to be referenced more than once, SQL typically requires that the table be <em>aliased</em> with another name, so that it can be distinguished against other occurrences of that table.  The <code>Query</code> supports this most explicitly using the <code>aliased</code> construct.  Below we join to the <code>Address</code> entity twice, to locate a user who has two distinct email addresses at the same time:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">aliased</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">adalias1 </span><span class="python_operator">= </span><span class="python_name">aliased</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">adalias2 </span><span class="python_operator">= </span><span class="python_name">aliased</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_32', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">username</span><span class="python_operator">, </span><span class="python_name">email1</span><span class="python_operator">, </span><span class="python_name">email2 </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">adalias1</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">adalias2</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">.\
...     </span><span class="python_name">join</span><span class="python_enclosure">((</span><span class="python_name">adalias1</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">adalias2</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">))</span><span class="python_operator">.\
...     </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">adalias1</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">.\
...     </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">adalias2</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_name">username</span><span class="python_operator">, </span><span class="python_name">email1</span><span class="python_operator">, </span><span class="python_name">email2</span><span class="python_operator">      </span></pre><div id="popbox_32_div" class="codepop" style="display:none;">SELECT users.name AS users_name, addresses_1.email_address AS addresses_1_email_address, <br/>
addresses_2.email_address AS addresses_2_email_address <br/>
FROM users JOIN addresses AS addresses_1 ON users.id = addresses_1.user_id <br/>
JOIN addresses AS addresses_2 ON users.id = addresses_2.user_id <br/>
WHERE addresses_1.email_address = ? AND addresses_2.email_address = ?<br/>
['jack@google.com', 'j25@yahoo.com']</div><pre><span class="python_name">jack jack</span><span class="python_operator">@</span><span class="python_name">google</span><span class="python_operator">.</span><span class="python_name">com j25</span><span class="python_operator">@</span><span class="python_name">yahoo</span><span class="python_operator">.</span><span class="python_name">com</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_joins_subqueries"></a>
    
    <div class="sectionL3">

    <h3>Using Subqueries</h3>
    
    

<p>The <code>Query</code> is suitable for generating statements which can be used as subqueries.  Suppose we wanted to load <code>User</code> objects along with a count of how many <code>Address</code> records each user has.  The best way to generate SQL like this is to get the count of addresses grouped by user ids, and JOIN to the parent.  In this case we use a LEFT OUTER JOIN so that we get rows back for those users who don't have any addresses, e.g.:
</p>

    

    <div class="sliding_code">
        <pre>
SELECT users.*, adr_count.address_count FROM users LEFT OUTER JOIN
    (SELECT user_id, count(*) AS address_count FROM addresses GROUP BY user_id) AS adr_count
    ON users.id=adr_count.user_id
</pre>
    </div>
<p>Using the <code>Query</code>, we build a statement like this from the inside out.  The <code>statement</code> accessor returns a SQL expression representing the statement generated by a particular <code>Query</code> - this is an instance of a <code>select()</code> construct, which are described in <a href="#sql">SQL Expression Language Tutorial</a>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">func</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">stmt </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_literal">'*'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'address_count'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">group_by</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">subquery</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>func</code> keyword generates SQL functions, and the <code>subquery()</code> method on <code>Query</code> produces a SQL expression construct representing a SELECT statement embedded within an alias (it's actually shorthand for <code>query.statement.alias()</code>).
</p>
<p>Once we have our statement, it behaves like a <code>Table</code> construct, such as the one we created for <code>users</code> at the start of this tutorial.  The columns on the statement are accessible through an attribute called <code>c</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_33', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">u</span><span class="python_operator">, </span><span class="python_name">count </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">stmt</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_count</span><span class="python_enclosure">)</span><span class="python_operator">.\
...     </span><span class="python_name">outerjoin</span><span class="python_enclosure">((</span><span class="python_name">stmt</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">stmt</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">: 
...     </span><span class="python_keyword">print </span><span class="python_name">u</span><span class="python_operator">, </span><span class="python_name">count</span><span class="python_operator"></span></pre><div id="popbox_33_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, <br/>
users.fullname AS users_fullname, users.password AS users_password, <br/>
anon_1.address_count AS anon_1_address_count <br/>
FROM users LEFT OUTER JOIN (SELECT addresses.user_id AS user_id, count(?) AS address_count <br/>
FROM addresses GROUP BY addresses.user_id) AS anon_1 ON users.id = anon_1.user_id <br/>
ORDER BY users.id<br/>
['*']</div><pre><span class="python_operator">&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'ed'</span><span class="python_operator">,</span><span class="python_literal">'Ed Jones'</span><span class="python_operator">, </span><span class="python_literal">'f8s7ccs'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">None</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">None</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'mary'</span><span class="python_operator">,</span><span class="python_literal">'Mary Contrary'</span><span class="python_operator">, </span><span class="python_literal">'xxg527'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">None</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'fred'</span><span class="python_operator">,</span><span class="python_literal">'Fred Flinstone'</span><span class="python_operator">, </span><span class="python_literal">'blah'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_name">None</span><span class="python_operator">
&lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jack'</span><span class="python_operator">,</span><span class="python_literal">'Jack Bean'</span><span class="python_operator">, </span><span class="python_literal">'gjffdd'</span><span class="python_enclosure">)</span><span class="python_operator">&gt; </span><span class="python_number">2</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_joins_using"></a>
    
    <div class="sectionL3">

    <h3>Using EXISTS</h3>
    
    

<p>The EXISTS keyword in SQL is a boolean operator which returns True if the given expression contains any rows.  It may be used in many scenarios in place of joins, and is also useful for locating rows which do not have a corresponding row in a related table.
</p>
<p>There is an explicit EXISTS construct, which looks like this:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">exists</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">stmt </span><span class="python_operator">= </span><span class="python_name">exists</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">where</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_34', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">stmt</span><span class="python_enclosure">)</span><span class="python_operator">:   
...     </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_34_div" class="codepop" style="display:none;">SELECT users.name AS users_name <br/>
FROM users <br/>
WHERE EXISTS (SELECT * <br/>
FROM addresses <br/>
WHERE addresses.user_id = users.id)<br/>
[]</div><pre><span class="python_name">jack</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Query</code> features several operators which make usage of EXISTS automatically.  Above, the statement can be expressed along the <code>User.addresses</code> relation using <code>any()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_35', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">())</span><span class="python_operator">:   
...     </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_35_div" class="codepop" style="display:none;">SELECT users.name AS users_name <br/>
FROM users <br/>
WHERE EXISTS (SELECT 1 <br/>
FROM addresses <br/>
WHERE users.id = addresses.user_id)<br/>
[]</div><pre><span class="python_name">jack</span><span class="python_operator">
</span></pre>
    </div>
<p><code>any()</code> takes criterion as well, to limit the rows matched:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_36', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%google%'</span><span class="python_enclosure">)))</span><span class="python_operator">:   
...     </span><span class="python_keyword">print </span><span class="python_name">name</span><span class="python_operator"></span></pre><div id="popbox_36_div" class="codepop" style="display:none;">SELECT users.name AS users_name <br/>
FROM users <br/>
WHERE EXISTS (SELECT 1 <br/>
FROM addresses <br/>
WHERE users.id = addresses.user_id AND addresses.email_address LIKE ?)<br/>
['%google%']</div><pre><span class="python_name">jack</span><span class="python_operator">
</span></pre>
    </div>
<p><code>has()</code> is the same operator as <code>any()</code> for many-to-one relations (note the <code>~</code> operator here too, which means "NOT"):
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_37', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_operator">~</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">has</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_37_div" class="codepop" style="display:none;">SELECT addresses.id AS addresses_id, addresses.email_address AS addresses_email_address, <br/>
addresses.user_id AS addresses_user_id <br/>
FROM addresses <br/>
WHERE NOT (EXISTS (SELECT 1 <br/>
FROM users <br/>
WHERE users.id = addresses.user_id AND users.name = ?))<br/>
['jack']</div><pre><span class="python_enclosure">[]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_joins_relationop"></a>
    
    <div class="sectionL3">

    <h3>Common Relation Operators</h3>
    
    

<p>Here's all the operators which build on relations:
</p>
<ul>
 <li><p>equals (used for many-to-one)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">== </span><span class="python_name">someuser</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>not equals (used for many-to-one)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">!= </span><span class="python_name">someuser</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>IS NULL (used for many-to-one)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">== </span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>contains (used for one-to-many and many-to-many collections)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">contains</span><span class="python_enclosure">(</span><span class="python_name">someaddress</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>any (used for one-to-many and many-to-many collections)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">== </span><span class="python_literal">'bar'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># also takes keyword arguments:
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">email_address</span><span class="python_operator">=</span><span class="python_literal">'bar'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>has (used for many-to-one)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">has</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>with_parent (used for any relation)
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_parent</span><span class="python_enclosure">(</span><span class="python_name">someuser</span><span class="python_operator">, </span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>
</ul>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_deleting"></a>
    
    <div class="sectionL2">

    <h3>Deleting</h3>
    
    

<p>Let's try to delete <code>jack</code> and see how that goes.  We'll mark as deleted in the session, then we'll issue a <code>count</code> query to see that no rows remain:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">jack</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_38', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_38_div" class="codepop" style="display:none;">UPDATE addresses SET user_id=? WHERE addresses.id = ?<br/>
[None, 1]<br/>
UPDATE addresses SET user_id=? WHERE addresses.id = ?<br/>
[None, 2]<br/>
DELETE FROM users WHERE users.id = ?<br/>
[5]<br/>
SELECT count(1) AS count_1 <br/>
FROM users <br/>
WHERE users.name = ?<br/>
['jack']</div><pre><span class="python_number">0</span><span class="python_operator">
</span></pre>
    </div>
<p>So far, so good.  How about Jack's <code>Address</code> objects ?
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_39', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'jack@google.com'</span><span class="python_operator">, </span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">])</span>
<span class="python_operator">...  </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_39_div" class="codepop" style="display:none;">SELECT count(1) AS count_1<br/>
FROM addresses <br/>
WHERE addresses.email_address IN (?, ?)<br/>
['jack@google.com', 'j25@yahoo.com']</div><pre><span class="python_number">2</span><span class="python_operator">
</span></pre>
    </div>
<p>Uh oh, they're still there !  Analyzing the flush SQL, we can see that the <code>user_id</code> column of each address was set to NULL, but the rows weren't deleted.  SQLAlchemy doesn't assume that deletes cascade, you have to tell it to do so.
</p>


    
    <A name="datamapping_deleting_cascade"></a>
    
    <div class="sectionL3">

    <h3>Configuring delete/delete-orphan Cascade</h3>
    
    

<p>We will configure <strong>cascade</strong> options on the <code>User.addresses</code> relation to change the behavior.  While SQLAlchemy allows you to add new attributes and relations to mappings at any point in time, in this case the existing relation needs to be removed, so we need to tear down the mappings completely and start again.  This is not a typical operation and is here just for illustrative purposes.
</p>
<p>Removing all ORM state is as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()  </span><span class="python_comment"># roll back and close the transaction</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">clear_mappers</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">clear_mappers</span><span class="python_enclosure">() </span><span class="python_comment"># clear mappers</span><span class="python_operator">
</span></pre>
    </div>
<p>Below, we use <code>mapper()</code> to reconfigure an ORM mapping for <code>User</code> and <code>Address</code>, on our existing but currently un-mapped classes.  The <code>User.addresses</code> relation now has <code>delete, delete-orphan</code> cascade on it, which indicates that DELETE operations will cascade to attached <code>Address</code> objects as well as <code>Address</code> objects which are removed from their parent:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{    </span>
<span class="python_operator">...     </span><span class="python_literal">'addresses'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'user'</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete, delete-orphan"</span><span class="python_enclosure">)</span>
<span class="python_operator">... </span><span class="python_enclosure">})</span><span class="python_operator">
&lt;</span><span class="python_name">Mapper at </span><span class="python_number">0x</span><span class="python_operator">...; </span><span class="python_name">User</span><span class="python_operator">&gt;
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">__table__</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">) </span><span class="python_operator">
&lt;</span><span class="python_name">Mapper at </span><span class="python_number">0x</span><span class="python_operator">...; </span><span class="python_name">Address</span><span class="python_operator">&gt;
</span></pre>
    </div>
<p>Now when we load Jack (below using <code>get()</code>, which loads by primary key), removing an address from his <code>addresses</code> collection will result in that <code>Address</code> being deleted:
</p>

    

    <div class="code">
        <pre>
<span class="python_comment"># load Jack by primary key
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_40', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">    </span></pre><div id="popbox_40_div" class="codepop" style="display:none;">BEGIN<br/>
SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.id = ?<br/>
[5]</div><pre>

<span class="python_comment"># remove one Address (lazy load fires off)
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_41', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">del </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">  </span></pre><div id="popbox_41_div" class="codepop" style="display:none;">SELECT addresses.id AS addresses_id, addresses.email_address AS addresses_email_address, addresses.user_id AS addresses_user_id <br/>
FROM addresses <br/>
WHERE ? = addresses.user_id<br/>
[5]</div><pre>

<span class="python_comment"># only one address remains
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_42', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'jack@google.com'</span><span class="python_operator">, </span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">])</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_42_div" class="codepop" style="display:none;">DELETE FROM addresses WHERE addresses.id = ?<br/>
[2]<br/>
SELECT count(1) AS count_1<br/>
FROM addresses <br/>
WHERE addresses.email_address IN (?, ?)<br/>
['jack@google.com', 'j25@yahoo.com']</div><pre><span class="python_number">1</span><span class="python_operator">
</span></pre>
    </div>
<p>Deleting Jack will delete both Jack and his remaining <code>Address</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">jack</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_43', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_43_div" class="codepop" style="display:none;">DELETE FROM addresses WHERE addresses.id = ?<br/>
[1]<br/>
DELETE FROM users WHERE users.id = ?<br/>
[5]<br/>
SELECT count(1) AS count_1<br/>
FROM users <br/>
WHERE users.name = ?<br/>
['jack']</div><pre><span class="python_number">0</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_44', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span>
<span class="python_operator">...    </span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">in_</span><span class="python_enclosure">([</span><span class="python_literal">'jack@google.com'</span><span class="python_operator">, </span><span class="python_literal">'j25@yahoo.com'</span><span class="python_enclosure">])</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_44_div" class="codepop" style="display:none;">SELECT count(1) AS count_1<br/>
FROM addresses <br/>
WHERE addresses.email_address IN (?, ?)<br/>
['jack@google.com', 'j25@yahoo.com']</div><pre><span class="python_number">0</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="datamapping_manytomany"></a>
    
    <div class="sectionL2">

    <h3>Building a Many To Many Relation</h3>
    
    

<p>We're moving into the bonus round here, but lets show off a many-to-many relationship.  We'll sneak in some other features too, just to take a tour.  We'll make our application a blog application, where users can write <code>BlogPost</code>s, which have <code>Keywords</code> associated with them.
</p>
<p>The declarative setup is as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">Text</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># association table</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">post_keywords </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'post_keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'post_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'posts.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'keywords.id'</span><span class="python_enclosure">))</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">class </span><span class="python_name">BlogPost</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'posts'</span><span class="python_operator">
...
...     </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.id'</span><span class="python_enclosure">))</span><span class="python_operator">
...     </span><span class="python_name">headline </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">255</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">body </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Text</span><span class="python_enclosure">)</span><span class="python_operator">
...
...     </span><span class="python_comment"># many to many BlogPost&lt;-&gt;Keyword</span><span class="python_operator">
...     </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_literal">'Keyword'</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">post_keywords</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'posts'</span><span class="python_enclosure">)</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">headline</span><span class="python_operator">, </span><span class="python_name">body</span><span class="python_operator">, </span><span class="python_name">author</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">author </span><span class="python_operator">= </span><span class="python_name">author</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">headline </span><span class="python_operator">= </span><span class="python_name">headline</span><span class="python_operator">
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">body </span><span class="python_operator">= </span><span class="python_name">body</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_keyword">return </span><span class="python_literal">"BlogPost(%r, %r, %r)" </span><span class="python_operator">% </span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">headline</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">body</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">author</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'keywords'</span><span class="python_operator">
...
...     </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
...     </span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
...
...     </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
...         </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the many-to-many relation above is <code>BlogPost.keywords</code>.  The defining feature of a many to many relation is the <code>secondary</code> keyword argument which references a <code>Table</code> object representing the association table.  This table only contains columns which reference the two sides of the relation; if it has <em>any</em> other columns, such as its own primary key, or foreign keys to other tables, SQLAlchemy requires a different usage pattern called the "association object", described at <a href="#advdatamapping_relation_patterns_association">Association Object</a>.
</p>
<p>The many-to-many relation is also bi-directional using the <code>backref</code> keyword.  This is the one case where usage of <code>backref</code> is generally required, since if a separate <code>posts</code> relation were added to the <code>Keyword</code> entity, both relations would independently add and remove rows from the <code>post_keywords</code> table and produce conflicts.
</p>
<p>We would also like our <code>BlogPost</code> class to have an <code>author</code> field.  We will add this as another bidirectional relationship, except one issue we'll have is that a single user might have lots of blog posts.  When we access <code>User.posts</code>, we'd like to be able to filter results further so as not to load the entire collection.  For this we use a setting accepted by <code>relation()</code> called <code>lazy='dynamic'</code>, which configures an alternate <strong>loader strategy</strong> on the attribute.  To use it on the "reverse" side of a <code>relation()</code>, we use the <code>backref()</code> function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">backref</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># "dynamic" loading relation to User</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">BlogPost</span><span class="python_operator">.</span><span class="python_name">author </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'posts'</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_literal">'dynamic'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Create new tables:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_45', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_45_div" class="codepop" style="display:none;">PRAGMA table_info(&quot;users&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;addresses&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;posts&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;keywords&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;post_keywords&quot;)<br/>
{}<br/>
CREATE TABLE posts (<br/>
    id INTEGER NOT NULL, <br/>
    user_id INTEGER, <br/>
    headline VARCHAR(255) NOT NULL, <br/>
    body TEXT, <br/>
    PRIMARY KEY (id), <br/>
     FOREIGN KEY(user_id) REFERENCES users (id)<br/>
)<br/>
{}<br/>
COMMIT<br/>
CREATE TABLE keywords (<br/>
    id INTEGER NOT NULL, <br/>
    keyword VARCHAR(50) NOT NULL, <br/>
    PRIMARY KEY (id), <br/>
     UNIQUE (keyword)<br/>
)<br/>
{}<br/>
COMMIT<br/>
CREATE TABLE post_keywords (<br/>
    post_id INTEGER, <br/>
    keyword_id INTEGER, <br/>
     FOREIGN KEY(post_id) REFERENCES posts (id), <br/>
     FOREIGN KEY(keyword_id) REFERENCES keywords (id)<br/>
)<br/>
{}<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Usage is not too different from what we've been doing.  Let's give Wendy some blog posts:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_46', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">wendy </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'wendy'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_46_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, users.password AS users_password <br/>
FROM users <br/>
WHERE users.name = ? <br/>
 LIMIT 2 OFFSET 0<br/>
['wendy']</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">post </span><span class="python_operator">= </span><span class="python_name">BlogPost</span><span class="python_enclosure">(</span><span class="python_literal">"Wendy's Blog Post"</span><span class="python_operator">, </span><span class="python_literal">"This is a test"</span><span class="python_operator">, </span><span class="python_name">wendy</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">post</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>We're storing keywords uniquely in the database, but we know that we don't have any yet, so we can just create them:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">post</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">post</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'firstpost'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>We can now look up all blog posts with the keyword 'firstpost'.   We'll use the <code>any</code> operator to locate "blog posts where any of its keywords has the keyword string 'firstpost'":
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_47', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_operator">=</span><span class="python_literal">'firstpost'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_47_div" class="codepop" style="display:none;">INSERT INTO posts (user_id, headline, body) VALUES (?, ?, ?)<br/>
[2, &quot;Wendy's Blog Post&quot;, 'This is a test']<br/>
INSERT INTO keywords (keyword) VALUES (?)<br/>
['wendy']<br/>
INSERT INTO keywords (keyword) VALUES (?)<br/>
['firstpost']<br/>
INSERT INTO post_keywords (post_id, keyword_id) VALUES (?, ?)<br/>
[[1, 1], [1, 2]]<br/>
SELECT posts.id AS posts_id, posts.user_id AS posts_user_id, posts.headline AS posts_headline, posts.body AS posts_body <br/>
FROM posts <br/>
WHERE EXISTS (SELECT 1 <br/>
FROM post_keywords, keywords <br/>
WHERE posts.id = post_keywords.post_id AND keywords.id = post_keywords.keyword_id AND keywords.keyword = ?)<br/>
['firstpost']</div><pre><span class="python_enclosure">[</span><span class="python_name">BlogPost</span><span class="python_enclosure">(</span><span class="python_literal">"Wendy's Blog Post"</span><span class="python_operator">, </span><span class="python_literal">'This is a test'</span><span class="python_operator">, &lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>If we want to look up just Wendy's posts, we can tell the query to narrow down to her as a parent:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_48', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_operator">.</span><span class="python_name">author</span><span class="python_operator">==</span><span class="python_name">wendy</span><span class="python_enclosure">)</span><span class="python_operator">.\
... </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_operator">=</span><span class="python_literal">'firstpost'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_48_div" class="codepop" style="display:none;">SELECT posts.id AS posts_id, posts.user_id AS posts_user_id, posts.headline AS posts_headline, posts.body AS posts_body <br/>
FROM posts <br/>
WHERE ? = posts.user_id AND (EXISTS (SELECT 1 <br/>
FROM post_keywords, keywords <br/>
WHERE posts.id = post_keywords.post_id AND keywords.id = post_keywords.keyword_id AND keywords.keyword = ?))<br/>
[2, 'firstpost']</div><pre><span class="python_enclosure">[</span><span class="python_name">BlogPost</span><span class="python_enclosure">(</span><span class="python_literal">"Wendy's Blog Post"</span><span class="python_operator">, </span><span class="python_literal">'This is a test'</span><span class="python_operator">, &lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Or we can use Wendy's own <code>posts</code> relation, which is a "dynamic" relation, to query straight from there:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_49', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">wendy</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">BlogPost</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_operator">=</span><span class="python_literal">'firstpost'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_49_div" class="codepop" style="display:none;">SELECT posts.id AS posts_id, posts.user_id AS posts_user_id, posts.headline AS posts_headline, posts.body AS posts_body <br/>
FROM posts <br/>
WHERE ? = posts.user_id AND (EXISTS (SELECT 1 <br/>
FROM post_keywords, keywords <br/>
WHERE posts.id = post_keywords.post_id AND keywords.id = post_keywords.keyword_id AND keywords.keyword = ?))<br/>
[2, 'firstpost']</div><pre><span class="python_enclosure">[</span><span class="python_name">BlogPost</span><span class="python_enclosure">(</span><span class="python_literal">"Wendy's Blog Post"</span><span class="python_operator">, </span><span class="python_literal">'This is a test'</span><span class="python_operator">, &lt;</span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'wendy'</span><span class="python_operator">,</span><span class="python_literal">'Wendy Williams'</span><span class="python_operator">, </span><span class="python_literal">'foobar'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#datamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="datamapping_further"></a>
    
    <div class="sectionL2">

    <h3>Further Reference</h3>
    
    

<p>Generated Documentation for Query: <a href="sqlalchemy_orm_query.html#docstrings_sqlalchemy.orm.query_Query">class Query(object)</a>
</p>
<p>ORM Generated Docs: <a href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm">module sqlalchemy.orm</a>
</p>
<p>Further information on mapping setups are in <a href="#advdatamapping">Mapper Configuration</a>.
</p>
<p>Further information on working with Sessions: <a href="#unitofwork">Using the Session</a>.
</p>




            <a href="#datamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="sql"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#datamapping">Object Relational Tutorial</a>

               |   
            Next: <a href="#advdatamapping">Mapper Configuration</a>
    </div>

        <h2>SQL Expression Language Tutorial</h2>
    </div>


        








    
    <A name="sql"></a>
    
    <div class="sectionL1">

    
    

<p>This tutorial will cover SQLAlchemy SQL Expressions, which are Python constructs that represent SQL statements.  The tutorial is in doctest format, meaning each <code>&gt;&gt;&gt;</code> line represents something you can type at a Python command prompt, and the following text represents the expected return value.  The tutorial has no prerequisites.
</p>


    
    <A name="sql_version"></a>
    
    <div class="sectionL2">

    <h3>Version Check</h3>
    
    

<p>A quick check to verify that we are on at least <strong>version 0.5</strong> of SQLAlchemy:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">__version__ </span><span class="python_operator">
</span><span class="python_number">0.5.0</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_connecting"></a>
    
    <div class="sectionL2">

    <h3>Connecting</h3>
    
    

<p>For this tutorial we will use an in-memory-only SQLite database.   This is an easy way to test things without needing to have an actual database defined anywhere.  To connect we use <code>create_engine()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">create_engine</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>echo</code> flag is a shortcut to setting up SQLAlchemy logging, which is accomplished via Python's standard <code>logging</code> module.  With it enabled, we'll see all the generated SQL produced.  If you are working through this tutorial and want less output generated, set it to <code>False</code>.   This tutorial will format the SQL behind a popup window so it doesn't get in our way; just click the "SQL" links to see what's being generated.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_tables"></a>
    
    <div class="sectionL2">

    <h3>Define and Create Tables</h3>
    
    

<p>The SQL Expression Language constructs its expressions in most cases against table columns.  In SQLAlchemy, a column is most often represented by an object called <code>Column</code>, and in all cases a <code>Column</code> is associated with a <code>Table</code>.  A collection of <code>Table</code> objects and their associated child objects is referred to as <strong>database metadata</strong>.  In this tutorial we will explicitly lay out several <code>Table</code> objects, but note that SA can also "import" whole sets of <code>Table</code> objects automatically from an existing database (this process is called <strong>table reflection</strong>).
</p>
<p>We define our tables all within a catalog called <code>MetaData</code>, using the <code>Table</code> construct, which resembles regular SQL CREATE TABLE statements.  We'll make two tables, one of which represents "users" in an application, and another which represents zero or more "email addreses" for each row in the "users" table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">Table</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_operator">, </span><span class="python_name">MetaData</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'fullname'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
<span class="python_operator">...   </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...   </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">...   </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_operator">...  </span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>All about how to define <code>Table</code> objects, as well as how to create them from an existing database automatically, is described in <a href="#metadata">Database Meta Data</a>.
</p>
<p>Next, to tell the <code>MetaData</code> we'd actually like to create our selection of tables for real inside the SQLite database, we use <code>create_all()</code>, passing it the <code>engine</code> instance which points to our database.  This will check for the presence of each table first before creating, so it's safe to call multiple times:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_50', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_50_div" class="codepop" style="display:none;">PRAGMA table_info(&quot;users&quot;)<br/>
{}<br/>
PRAGMA table_info(&quot;addresses&quot;)<br/>
{}<br/>
CREATE TABLE users (<br/>
    id INTEGER NOT NULL, <br/>
    name VARCHAR, <br/>
    fullname VARCHAR, <br/>
    PRIMARY KEY (id)<br/>
)<br/>
{}<br/>
COMMIT<br/>
CREATE TABLE addresses (<br/>
    id INTEGER NOT NULL, <br/>
    user_id INTEGER, <br/>
    email_address VARCHAR NOT NULL, <br/>
    PRIMARY KEY (id), <br/>
     FOREIGN KEY(user_id) REFERENCES users (id)<br/>
)<br/>
{}<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>Users familiar with the syntax of CREATE TABLE may notice that the VARCHAR columns were generated without a length; on SQLite, this is a valid datatype, but on most databases it's not allowed.  So if running this tutorial on a database such as PostgreSQL or MySQL, and you wish to use SQLAlchemy to generate the tables, a "length" may be provided to the <code>String</code> type as below:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The length field on <code>String</code>, as well as similar fields available on <code>Integer</code>, <code>Numeric</code>, etc. are not referenced by SQLAlchemy other than when creating tables.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_insert"></a>
    
    <div class="sectionL2">

    <h3>Insert Expressions</h3>
    
    

<p>The first SQL expression we'll create is the <code>Insert</code> construct, which represents an INSERT statement.   This is typically created relative to its target table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ins </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>To see a sample of the SQL this construct produces, use the <code>str()</code> function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">ins</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">'INSERT INTO users (id, name, fullname) VALUES (:id, :name, :fullname)'</span><span class="python_operator">
</span></pre>
    </div>
<p>Notice above that the INSERT statement names every column in the <code>users</code> table.  This can be limited by using the <code>values</code> keyword, which establishes the VALUES clause of the INSERT explicitly:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ins </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_literal">'fullname'</span><span class="python_operator">:</span><span class="python_literal">'Jack Jones'</span><span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">ins</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">'INSERT INTO users (name, fullname) VALUES (:name, :fullname)'</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, while the <code>values</code> keyword limited the VALUES clause to just two columns, the actual data we placed in <code>values</code> didn't get rendered into the string; instead we got named bind parameters.  As it turns out, our data <em>is</em> stored within our <code>Insert</code> construct, but it typically only comes out when the statement is actually executed; since the data consists of literal values, SQLAlchemy automatically generates bind parameters for them.  We can peek at this data for now by looking at the compiled form of the statement:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ins</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">params </span><span class="python_operator">
</span><span class="python_enclosure">{</span><span class="python_literal">'fullname'</span><span class="python_operator">: </span><span class="python_literal">'Jack Jones'</span><span class="python_operator">, </span><span class="python_literal">'name'</span><span class="python_operator">: </span><span class="python_literal">'jack'</span><span class="python_enclosure">}</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_executing"></a>
    
    <div class="sectionL2">

    <h3>Executing</h3>
    
    

<p>The interesting part of an <code>Insert</code> is executing it.  In this tutorial, we will generally focus on the most explicit method of executing a SQL construct, and later touch upon some "shortcut" ways to do it.  The <code>engine</code> object we created is a repository for database connections capable of issuing SQL to the database.  To acquire a connection, we use the <code>connect()</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn </span><span class="python_operator">
&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">Connection object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>
<p>The <code>Connection</code> object represents an actively checked out DBAPI connection resource.  Lets feed it our <code>Insert</code> object and see what happens:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">ins</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre><div class="codepop">INSERT INTO users (name, fullname) VALUES (?, ?)<br/>
['jack', 'Jack Jones']<br/>
COMMIT</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p>So the INSERT statement was now issued to the database.  Although we got positional "qmark" bind parameters instead of "named" bind parameters in the output.  How come ?  Because when executed, the <code>Connection</code> used the SQLite <strong>dialect</strong> to help generate the statement; when we use the <code>str()</code> function, the statement isn't aware of this dialect, and falls back onto a default which uses named parameters. We can view this manually as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ins</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">ins</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">'INSERT INTO users (name, fullname) VALUES (?, ?)'</span><span class="python_operator">
</span></pre>
    </div>
<p>What about the <code>result</code> variable we got when we called <code>execute()</code> ?  As the SQLAlchemy <code>Connection</code> object references a DBAPI connection, the result, known as a <code>ResultProxy</code> object, is analogous to the DBAPI cursor object.  In the case of an INSERT, we can get important information from it, such as the primary key values which were generated from our statement:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">last_inserted_ids</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>The value of <code>1</code> was automatically generated by SQLite, but only because we did not specify the <code>id</code> column in our <code>Insert</code> statement; otherwise, our explicit value would have been used.   In either case, SQLAlchemy always knows how to get at a newly generated primary key value, even though the method of generating them is different across different databases; each databases' <code>Dialect</code> knows the specific steps needed to determine the correct value (or values; note that <code>last_inserted_ids()</code> returns a list so that it supports composite primary keys).
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_execmany"></a>
    
    <div class="sectionL2">

    <h3>Executing Multiple Statements</h3>
    
    

<p>Our insert example above was intentionally a little drawn out to show some various behaviors of expression language constructs.  In the usual case, an <code>Insert</code> statement is usually compiled against the parameters sent to the <code>execute()</code> method on <code>Connection</code>, so that there's no need to use the <code>values</code> keyword with <code>Insert</code>.  Lets create a generic <code>Insert</code> statement again and use it in the "normal" way:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">ins </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">ins</span><span class="python_operator">, </span><span class="python_name">id</span><span class="python_operator">=</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'wendy'</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">'Wendy Williams'</span><span class="python_enclosure">) </span><span class="python_operator">
</span></pre><div class="codepop">INSERT INTO users (id, name, fullname) VALUES (?, ?, ?)<br/>
[2, 'wendy', 'Wendy Williams']<br/>
COMMIT</div><pre>

<span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>
<p>Above, because we specified all three columns in the the <code>execute()</code> method, the compiled <code>Insert</code> included all three columns.  The <code>Insert</code> statement is compiled at execution time based on the parameters we specified; if we specified fewer parameters, the <code>Insert</code> would have fewer entries in its VALUES clause.
</p>
<p>To issue many inserts using DBAPI's <code>executemany()</code> method, we can send in a list of dictionaries each containing a distinct set of parameters to be inserted, as we do here to add some email addresses:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_enclosure">[ </span>
<span class="python_operator">...    </span><span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">'email_address' </span><span class="python_operator">: </span><span class="python_literal">'jack@yahoo.com'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">...    </span><span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">'email_address' </span><span class="python_operator">: </span><span class="python_literal">'jack@msn.com'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">...    </span><span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">'email_address' </span><span class="python_operator">: </span><span class="python_literal">'www@www.org'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">...    </span><span class="python_enclosure">{</span><span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">'email_address' </span><span class="python_operator">: </span><span class="python_literal">'wendy@aol.com'</span><span class="python_enclosure">}</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre><div class="codepop">INSERT INTO addresses (user_id, email_address) VALUES (?, ?)<br/>
[[1, 'jack@yahoo.com'], [1, 'jack@msn.com'], [2, 'www@www.org'], [2, 'wendy@aol.com']]<br/>
COMMIT</div><pre>

<span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>
<p>Above, we again relied upon SQLite's automatic generation of primary key identifiers for each <code>addresses</code> row.
</p>
<p>When executing multiple sets of parameters, each dictionary must have the <strong>same</strong> set of keys; i.e. you cant have fewer keys in some dictionaries than others.  This is because the <code>Insert</code> statement is compiled against the <strong>first</strong> dictionary in the list, and it's assumed that all subsequent argument dictionaries are compatible with that statement.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_connectionless"></a>
    
    <div class="sectionL2">

    <h3>Connectionless / Implicit Execution</h3>
    
    

<p>We're executing our <code>Insert</code> using a <code>Connection</code>.  There's two options that allow you to not have to deal with the connection part.  You can execute in the <strong>connectionless</strong> style, using the engine, which opens and closes a connection for you:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_51', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'fred'</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">"Fred Flintstone"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_51_div" class="codepop" style="display:none;">INSERT INTO users (name, fullname) VALUES (?, ?)<br/>
['fred', 'Fred Flintstone']<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>and you can save even more steps than that, if you connect the <code>Engine</code> to the <code>MetaData</code> object we created earlier.  When this is done, all SQL expressions which involve tables within the <code>MetaData</code> object will be automatically <strong>bound</strong> to the <code>Engine</code>.  In this case, we call it  <strong>implicit execution</strong>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_52', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">"mary"</span><span class="python_operator">, </span><span class="python_name">fullname</span><span class="python_operator">=</span><span class="python_literal">"Mary Contrary"</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_52_div" class="codepop" style="display:none;">INSERT INTO users (name, fullname) VALUES (?, ?)<br/>
['mary', 'Mary Contrary']<br/>
COMMIT</div><pre><span class="python_operator"></span></pre>
    </div>
<p>When the <code>MetaData</code> is bound, statements will also compile against the engine's dialect.  Since a lot of the examples here assume the default dialect, we'll detach the engine from the metadata which we just attached:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">None</span><span class="python_operator">
</span></pre>
    </div>
<p>Detailed examples of connectionless and implicit execution are available in the "Engines" chapter: <a href="#dbengine_implicit">Connectionless Execution, Implicit Execution</a>.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_selecting"></a>
    
    <div class="sectionL2">

    <h3>Selecting</h3>
    
    

<p>We began with inserts just so that our test database had some data in it.  The more interesting part of the data is selecting it !  We'll cover UPDATE and DELETE statements later.  The primary construct used to generate SELECT statements is the <code>select()</code> function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">select</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.id, users.name, users.fullname <br/>
FROM users<br/>
[]</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p>Above, we issued a basic <code>select()</code> call, placing the <code>users</code> table within the COLUMNS clause of the select, and then executing.  SQLAlchemy expanded the <code>users</code> table into the set of each of its columns, and also generated a FROM clause for us.  The result returned is again a <code>ResultProxy</code> object, which acts much like a DBAPI cursor, including methods such as <code>fetchone()</code> and <code>fetchall()</code>.  The easiest way to get rows from it is to just iterate:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, we see that printing each row produces a simple tuple-like result.  We have more options at accessing the data in each row.  One very common way is through dictionary access, using the string names of columns:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_53', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_53_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users<br/>
[]</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_literal">"name:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'name'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_literal">"; fullname:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'fullname'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">jack </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Jack Jones</span><span class="python_operator">
</span></pre>
    </div>
<p>Integer indexes work as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">row </span><span class="python_operator">= </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">fetchone</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_literal">"name:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_literal">"; fullname:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">wendy </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Wendy Williams</span><span class="python_operator">
</span></pre>
    </div>
<p>But another way, whose usefulness will become apparent later on, is to use the <code>Column</code> objects directly as keys:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_54', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_literal">"name:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_literal">"; fullname:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_54_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users<br/>
[]</div><pre><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">jack </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Jack Jones</span><span class="python_operator">
</span><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">wendy </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Wendy Williams</span><span class="python_operator">
</span><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">fred </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Fred Flintstone</span><span class="python_operator">
</span><span class="python_name">name</span><span class="python_operator">: </span><span class="python_name">mary </span><span class="python_operator">; </span><span class="python_name">fullname</span><span class="python_operator">: </span><span class="python_name">Mary Contrary</span><span class="python_operator">
</span></pre>
    </div>
<p>Result sets which have pending rows remaining should be explicitly closed before discarding.  While the resources referenced by the <code>ResultProxy</code> will be closed when the object is garbage collected, it's better to make it explicit as some database APIs are very picky about such things:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>If we'd like to more carefully control the columns which are placed in the COLUMNS clause of the select, we reference individual <code>Column</code> objects from our <code>Table</code>.  These are available as named attributes off the <code>c</code> attribute of the <code>Table</code> object:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_55', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_55_div" class="codepop" style="display:none;">SELECT users.name, users.fullname <br/>
FROM users<br/>
[]</div><pre><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:  
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Lets observe something interesting about the FROM clause.  Whereas the generated statement contains two distinct sections, a "SELECT columns" part and a "FROM table" part, our <code>select()</code> construct only has a list containing columns.  How does this work ?  Let's try putting <em>two</em> tables into our <code>select()</code> statement:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_56', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]))</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator"></span></pre><div id="popbox_56_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname, addresses.id, addresses.user_id, addresses.email_address <br/>
FROM users, addresses<br/>
[]</div><pre><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'www@www.org'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'www@www.org'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'www@www.org'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_literal">u'Fred Flintstone'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'www@www.org'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_literal">u'Mary Contrary'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>It placed <strong>both</strong> tables into the FROM clause.  But also, it made a real mess.  Those who are familiar with SQL joins know that this is a <strong>Cartesian product</strong>; each row from the <code>users</code> table is produced against each row from the <code>addresses</code> table.  So to put some sanity into this statement, we need a WHERE clause.  Which brings us to the second argument of <code>select()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_57', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_operator"></span></pre><div id="popbox_57_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname, addresses.id, addresses.user_id, addresses.email_address <br/>
FROM users, addresses <br/>
WHERE users.id = addresses.user_id<br/>
[]</div><pre><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'www@www.org'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>So that looks a lot better, we added an expression to our <code>select()</code> which had the effect of adding <code>WHERE users.id = addresses.user_id</code> to our statement, and our results were managed down so that the join of <code>users</code> and <code>addresses</code> rows made sense.  But let's look at that expression?  It's using just a Python equality operator between two different <code>Column</code> objects.  It should be clear that something is up.  Saying <code>1==1</code> produces <code>True</code>, and <code>1==2</code> produces <code>False</code>, not a WHERE clause.  So lets see exactly what that expression is doing:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">
&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">expression</span><span class="python_operator">.</span><span class="python_name">_BinaryExpression object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>
<p>Wow, surprise !  This is neither a <code>True</code> nor a <code>False</code>.  Well what is it ?
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">str</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">'users.id = addresses.user_id'</span><span class="python_operator">
</span></pre>
    </div>
<p>As you can see, the <code>==</code> operator is producing an object that is very much like the <code>Insert</code> and <code>select()</code> objects we've made so far, thanks to Python's <code>__eq__()</code> builtin; you call <code>str()</code> on it and it produces SQL.  By now, one can that everything we are working with is ultimately the same type of object.  SQLAlchemy terms the base class of all of these expressions as <code>sqlalchemy.sql.ClauseElement</code>.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_operators"></a>
    
    <div class="sectionL2">

    <h3>Operators</h3>
    
    

<p>Since we've stumbled upon SQLAlchemy's operator paradigm, let's go through some of its capabilities.  We've seen how to equate two columns to each other:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span></pre>
    </div>
<p>If we use a literal value (a literal meaning, not a SQLAlchemy clause object), we get a bind parameter:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= :</span><span class="python_name">id_1</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>7</code> literal is embedded in <code>ClauseElement</code>; we can use the same trick we did with the <code>Insert</code> object to see it:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">params</span><span class="python_operator">
</span><span class="python_enclosure">{</span><span class="python_literal">'id_1'</span><span class="python_operator">: </span><span class="python_number">7</span><span class="python_enclosure">}</span><span class="python_operator">
</span></pre>
    </div>
<p>Most Python operators, as it turns out, produce a SQL expression here, like equals, not equals, etc.:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">!= </span><span class="python_number">7</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">!= :</span><span class="python_name">id_1</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># None converts to IS NULL</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">== </span><span class="python_name">None</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name IS NULL</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># reverse works too </span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_literal">'fred' </span><span class="python_operator">&gt; </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">&lt; :</span><span class="python_name">name_1</span><span class="python_operator">
</span></pre>
    </div>
<p>If we add two integer columns together, we get an addition expression:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">+ </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">+ </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">
</span></pre>
    </div>
<p>Interestingly, the type of the <code>Column</code> is important !  If we use <code>+</code> with two string based columns (recall we put types like <code>Integer</code> and <code>String</code> on our <code>Column</code> objects at the beginning), we get something different:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">|| </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">
</span></pre>
    </div>
<p>Where <code>||</code> is the string concatenation operator used on most databases.  But not all of them.  MySQL users, fear not:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">concat</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above illustrates the SQL that's generated for an <code>Engine</code> that's connected to a MySQL database; the <code>||</code> operator now compiles as MySQL's <code>concat()</code> function.
</p>
<p>If you have come across an operator which really isn't available, you can always use the <code>op()</code> method; this generates whatever operator you need:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">op</span><span class="python_enclosure">(</span><span class="python_literal">'tiddlywinks'</span><span class="python_enclosure">)(</span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name tiddlywinks </span><span class="python_operator">:</span><span class="python_name">name_1</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_conjunctions"></a>
    
    <div class="sectionL2">

    <h3>Conjunctions</h3>
    
    

<p>We'd like to show off some of our operators inside of <code>select()</code> constructs.  But we need to lump them together a little more, so let's first introduce some conjunctions.  Conjunctions are those little words like AND and OR that put things together.  We'll also hit upon NOT.  AND, OR and NOT can work from the corresponding functions SQLAlchemy provides (notice we also throw in a LIKE):
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">and_</span><span class="python_operator">, </span><span class="python_name">or_</span><span class="python_operator">, </span><span class="python_name">not_</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'j%'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'wendy@aol.com'</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...     </span><span class="python_name">not_</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">&gt;</span><span class="python_number">5</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name LIKE </span><span class="python_operator">:</span><span class="python_name">name_1 AND users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id AND </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= :</span><span class="python_name">email_address_1 OR addresses</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= :</span><span class="python_name">email_address_2</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">AND users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">&lt;= :</span><span class="python_name">id_1</span><span class="python_operator">
</span></pre>
    </div>
<p>And you can also use the re-jiggered bitwise AND, OR and NOT operators, although because of Python operator precedence you have to watch your parenthesis:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'j%'</span><span class="python_enclosure">) </span><span class="python_operator">&amp; </span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">) </span><span class="python_operator">&amp;  \
...     </span><span class="python_enclosure">((</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'wendy@aol.com'</span><span class="python_enclosure">) </span><span class="python_operator">| </span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@yahoo.com'</span><span class="python_enclosure">))</span><span class="python_operator"> \
...     &amp; ~</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">&gt;</span><span class="python_number">5</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name LIKE </span><span class="python_operator">:</span><span class="python_name">name_1 AND users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id AND </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= :</span><span class="python_name">email_address_1 OR addresses</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">= :</span><span class="python_name">email_address_2</span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_name">AND users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">&lt;= :</span><span class="python_name">id_1</span><span class="python_operator">
</span></pre>
    </div>
<p>So with all of this vocabulary, let's select all users who have an email address at AOL or MSN, whose name starts with a letter between "m" and "z", and we'll also generate a column containing their full name combined with their email address.  We will add two new constructs to this statement, <code>between()</code> and <code>label()</code>.  <code>between()</code> produces a BETWEEN clause, and <code>label()</code> is used in a column expression to produce labels using the <code>AS</code> keyword; it's recommended when selecting from expressions that otherwise would not have a name:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">+ </span><span class="python_literal">", " </span><span class="python_operator">+ </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_enclosure">)]</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">and_</span><span class="python_enclosure">( </span>
<span class="python_operator">...            </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...            </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">between</span><span class="python_enclosure">(</span><span class="python_literal">'m'</span><span class="python_operator">, </span><span class="python_literal">'z'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
<span class="python_operator">...           </span><span class="python_name">or_</span><span class="python_enclosure">(</span>
<span class="python_operator">...              </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@aol.com'</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
<span class="python_operator">...              </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">)</span>
<span class="python_operator">...           </span><span class="python_enclosure">)</span>
<span class="python_operator">...        </span><span class="python_enclosure">)</span>
<span class="python_operator">...    </span><span class="python_enclosure">) </span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">() </span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">|| ? || </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">email_address AS title </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_name">addresses </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id AND users</span><span class="python_operator">.</span><span class="python_name">name BETWEEN</span><span class="python_operator"> ? </span><span class="python_name">AND</span><span class="python_operator"> ? </span><span class="python_name">AND </span><span class="python_operator">
</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">email_address LIKE</span><span class="python_operator"> ? </span><span class="python_name">OR addresses</span><span class="python_operator">.</span><span class="python_name">email_address LIKE</span><span class="python_operator"> ?</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">', '</span><span class="python_operator">, </span><span class="python_literal">'m'</span><span class="python_operator">, </span><span class="python_literal">'z'</span><span class="python_operator">, </span><span class="python_literal">'%@aol.com'</span><span class="python_operator">, </span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[(</span><span class="python_literal">u'Wendy Williams, wendy@aol.com'</span><span class="python_operator">,</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Once again, SQLAlchemy figured out the FROM clause for our statement.  In fact it will determine the FROM clause based on all of its other bits; the columns clause, the where clause, and also some other elements which we haven't covered yet, which include ORDER BY, GROUP BY, and HAVING. 
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_text"></a>
    
    <div class="sectionL2">

    <h3>Using Text</h3>
    
    

<p>Our last example really became a handful to type.  Going from what one understands to be a textual SQL expression into a Python construct which groups components together in a programmatic style can be hard.  That's why SQLAlchemy lets you just use strings too.  The <code>text()</code> construct represents any textual statement.  To use bind parameters with <code>text()</code>, always use the named colon format.  Such as below, we create a <code>text()</code> and execute it, feeding in the bind parameters to the <code>execute()</code> method:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">text</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"""SELECT users.fullname || ', ' || addresses.email_address AS title 
...            FROM users, addresses 
...            WHERE users.id = addresses.user_id AND users.name BETWEEN :x AND :y AND 
...            (addresses.email_address LIKE :e1 OR addresses.email_address LIKE :e2)
...        """</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_58', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">x</span><span class="python_operator">=</span><span class="python_literal">'m'</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_operator">=</span><span class="python_literal">'z'</span><span class="python_operator">, </span><span class="python_name">e1</span><span class="python_operator">=</span><span class="python_literal">'%@aol.com'</span><span class="python_operator">, </span><span class="python_name">e2</span><span class="python_operator">=</span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_58_div" class="codepop" style="display:none;">SELECT users.fullname || ', ' || addresses.email_address AS title <br/>
FROM users, addresses <br/>
WHERE users.id = addresses.user_id AND users.name BETWEEN ? AND ? AND <br/>
(addresses.email_address LIKE ? OR addresses.email_address LIKE ?)<br/>
['m', 'z', '%@aol.com', '%@msn.com']</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'Wendy Williams, wendy@aol.com'</span><span class="python_operator">,</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>To gain a "hybrid" approach, any of SA's SQL constructs can have text freely intermingled wherever you like - the <code>text()</code> construct can be placed within any other <code>ClauseElement</code> construct, and when used in a non-operator context, a direct string may be placed which converts to <code>text()</code> automatically.  Below we combine the usage of <code>text()</code> and strings with our constructed <code>select()</code> object, by using the <code>select()</code> object to structure the statement, and the <code>text()</code>/strings to provide all the content within the structure.  For this example, SQLAlchemy is not given any <code>Column</code> or <code>Table</code> objects in any of its expressions, so it cannot generate a FROM clause.  So we also give it the <code>from_obj</code> keyword argument, which is a list of <code>ClauseElements</code> (or strings) to be placed within the FROM clause:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"users.fullname || ', ' || addresses.email_address AS title"</span><span class="python_enclosure">)]</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">and_</span><span class="python_enclosure">( </span>
<span class="python_operator">...            </span><span class="python_literal">"users.id = addresses.user_id"</span><span class="python_operator">, </span>
<span class="python_operator">...             </span><span class="python_literal">"users.name BETWEEN 'm' AND 'z'"</span><span class="python_operator">,</span>
<span class="python_operator">...             </span><span class="python_literal">"(addresses.email_address LIKE :x OR addresses.email_address LIKE :y)"</span>
<span class="python_operator">...        </span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...         </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_literal">'addresses'</span><span class="python_enclosure">]</span>
<span class="python_operator">...    </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_59', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">x</span><span class="python_operator">=</span><span class="python_literal">'%@aol.com'</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_operator">=</span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_59_div" class="codepop" style="display:none;">SELECT users.fullname || ', ' || addresses.email_address AS title <br/>
FROM users, addresses <br/>
WHERE users.id = addresses.user_id AND users.name BETWEEN 'm' AND 'z' AND (addresses.email_address LIKE ? OR addresses.email_address LIKE ?)<br/>
['%@aol.com', '%@msn.com']</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'Wendy Williams, wendy@aol.com'</span><span class="python_operator">,</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Going from constructed SQL to text, we lose some capabilities.  We lose the capability for SQLAlchemy to compile our expression to a specific target database; above, our expression won't work with MySQL since it has no <code>||</code> construct.  It also becomes more tedious for SQLAlchemy to be made aware of the datatypes in use; for example, if our bind parameters required UTF-8 encoding before going in, or conversion from a Python <code>datetime</code> into a string (as is required with SQLite), we would have to add extra information to our <code>text()</code> construct.  Similar issues arise on the result set side, where SQLAlchemy also performs type-specific data conversion in some cases; still more information can be added to <code>text()</code> to work around this.  But what we really lose from our statement is the ability to manipulate it, transform it, and analyze it.  These features are critical when using the ORM, which makes heavy usage of relational transformations.  To show off what we mean, we'll first introduce the ALIAS construct and the JOIN construct, just so we have some juicier bits to play with.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_aliases"></a>
    
    <div class="sectionL2">

    <h3>Using Aliases</h3>
    
    

<p>The alias corresponds to a "renamed" version of a table or arbitrary relation, which occurs anytime you say "SELECT  .. FROM sometable AS someothername".  The <code>AS</code> creates a new name for the table.  Aliases are super important in SQL as they allow you to reference the same table more than once.  Scenarios where you need to do this include when you self-join a table to itself, or more commonly when you need to join from a parent table to a child table multiple times.  For example, we know that our user <code>jack</code> has two email addresses.  How can we locate jack based on the combination of those two addresses?  We need to join twice to it.  Let's construct two distinct aliases for the <code>addresses</code> table and join:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'a1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a2 </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'a2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">and_</span><span class="python_enclosure">(</span>
<span class="python_operator">...        </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@msn.com'</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@yahoo.com'</span>
<span class="python_operator">...   </span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_60', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_60_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users, addresses AS a1, addresses AS a2 <br/>
WHERE users.id = a1.user_id AND users.id = a2.user_id AND a1.email_address = ? AND a2.email_address = ?<br/>
['jack@msn.com', 'jack@yahoo.com']</div><pre><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Easy enough.  One thing that we're going for with the SQL Expression Language is the melding of programmatic behavior with SQL generation.  Coming up with names like <code>a1</code> and <code>a2</code> is messy; we really didn't need to use those names anywhere, it's just the database that needed them.  Plus, we might write some code that uses alias objects that came from several different places, and it's difficult to ensure that they all have unique names.  So instead, we just let SQLAlchemy make the names for us, using "anonymous" aliases:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a2 </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">and_</span><span class="python_enclosure">(</span>
<span class="python_operator">...        </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@msn.com'</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">a2</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'jack@yahoo.com'</span>
<span class="python_operator">...   </span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_61', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_61_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users, addresses AS addresses_1, addresses AS addresses_2 <br/>
WHERE users.id = addresses_1.user_id AND users.id = addresses_2.user_id AND addresses_1.email_address = ? AND addresses_2.email_address = ?<br/>
['jack@msn.com', 'jack@yahoo.com']</div><pre><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>One super-huge advantage of anonymous aliases is that not only did we not have to guess up a random name, but we can also be guaranteed that the above SQL string is <strong>deterministically</strong> generated to be the same every time.  This is important for databases such as Oracle which cache compiled "query plans" for their statements, and need to see the same SQL string in order to make use of it.
</p>
<p>Aliases can of course be used for anything which you can SELECT from, including SELECT statements themselves.  We can self-join the <code>users</code> table back to the <code>select()</code> we've created by making an alias of the entire statement.  The <code>correlate(None)</code> directive is to avoid SQLAlchemy's attempt to "correlate" the inner <code>users</code> table with the outer one:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">correlate</span><span class="python_enclosure">(</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_62', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_62_div" class="codepop" style="display:none;">SELECT users.name <br/>
FROM users, (SELECT users.id AS id, users.name AS name, users.fullname AS fullname <br/>
FROM users, addresses AS addresses_1, addresses AS addresses_2 <br/>
WHERE users.id = addresses_1.user_id AND users.id = addresses_2.user_id AND addresses_1.email_address = ? AND addresses_2.email_address = ?) AS anon_1 <br/>
WHERE users.id = anon_1.id<br/>
['jack@msn.com', 'jack@yahoo.com']</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'jack'</span><span class="python_operator">,</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_joins"></a>
    
    <div class="sectionL2">

    <h3>Using Joins</h3>
    
    

<p>We're halfway along to being able to construct any SELECT expression.  The next cornerstone of the SELECT is the JOIN expression.  We've already been doing joins in our examples, by just placing two tables in either the columns clause or the where clause of the <code>select()</code> construct.  But if we want to make a real "JOIN" or "OUTERJOIN" construct, we use the <code>join()</code> and <code>outerjoin()</code> methods, most commonly accessed from the left table in the join:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">users JOIN addresses ON users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span></pre>
    </div>
<p>The alert reader will see more surprises; SQLAlchemy figured out how to JOIN the two tables !  The ON condition of the join, as it's called, was automatically generated based on the <code>ForeignKey</code> object which we placed on the <code>addresses</code> table way at the beginning of this tutorial.  Already the <code>join()</code> construct is looking like a much better way to join tables.
</p>
<p>Of course you can join on whatever expression you want, such as if we want to join on all users who use the same name in their email address as their username:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">'%'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">users JOIN addresses ON addresses</span><span class="python_operator">.</span><span class="python_name">email_address LIKE users</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">|| :</span><span class="python_name">name_1</span><span class="python_operator">
</span></pre>
    </div>
<p>When we create a <code>select()</code> construct, SQLAlchemy looks around at the tables we've mentioned and then places them in the FROM clause of the statement.  When we use JOINs however, we know what FROM clause we want, so here we make usage of the <code>from_obj</code> keyword argument:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span>
<span class="python_operator">...    </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">'%'</span><span class="python_enclosure">))</span>
<span class="python_operator">...    </span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_63', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_63_div" class="codepop" style="display:none;">SELECT users.fullname <br/>
FROM users JOIN addresses ON addresses.email_address LIKE users.name || ?<br/>
['%']</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">,</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">,</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'Wendy Williams'</span><span class="python_operator">,</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>outerjoin()</code> function just creates <code>LEFT OUTER JOIN</code> constructs.  It's used just like <code>join()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)])</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">
</span><span class="python_name">FROM users LEFT OUTER JOIN addresses ON users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">
</span></pre>
    </div>
<p>That's the output <code>outerjoin()</code> produces, unless, of course, you're stuck in a gig using Oracle prior to version 9, and you've set up your engine (which would be using <code>OracleDialect</code>) to use Oracle-specific SQL:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">databases</span><span class="python_operator">.</span><span class="python_name">oracle </span><span class="python_keyword">import </span><span class="python_name">OracleDialect</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">(</span><span class="python_name">dialect</span><span class="python_operator">=</span><span class="python_name">OracleDialect</span><span class="python_enclosure">(</span><span class="python_name">use_ansi</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_name">addresses </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">(</span><span class="python_operator">+</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>If you don't know what that SQL means, don't worry !  The secret tribe of Oracle DBAs don't want their black magic being found out ;).
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_transform"></a>
    
    <div class="sectionL2">

    <h3>Intro to Generative Selects and Transformations</h3>
    
    

<p>We've now gained the ability to construct very sophisticated statements.  We can use all kinds of operators, table constructs, text, joins, and aliases.  The point of all of this, as mentioned earlier, is not that it's an "easier" or "better" way to write SQL than just writing a SQL statement yourself; the point is that it's better for writing <em>programmatically generated</em> SQL which can be morphed and adapted as needed in automated scenarios.
</p>
<p>To support this, the <code>select()</code> construct we've been working with supports piecemeal construction, in addition to the "all at once" method we've been doing.  Suppose you're writing a search function, which receives criterion and then must construct a select from it.  To accomplish this, upon each criterion encountered, you apply "generative" criterion to an existing <code>select()</code> construct with new elements, one at a time.  We start with a basic <code>select()</code> constructed with the shortcut method available on the <code>users</code> table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">
</span></pre>
    </div>
<p>We encounter search criterion of "name='jack'".  So we apply WHERE criterion stating such:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">where</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Next, we encounter that they'd like the results in descending order by full name.  We apply ORDER BY, using an extra modifier <code>desc</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">.</span><span class="python_name">desc</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>
<p>We also come across that they'd like only users who have an address at MSN.  A quick way to tack this on is by using an EXISTS clause, which we correlate to the <code>users</code> table in the enclosing SELECT:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">exists</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">where</span><span class="python_enclosure">(</span>
<span class="python_operator">...    </span><span class="python_name">exists</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
<span class="python_operator">...        </span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">))</span>
<span class="python_operator">...    </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">correlate</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>And finally, the application also wants to see the listing of email addresses at once; so to save queries, we outerjoin the <code>addresses</code> table (using an outer join so that users with no addresses come back as well; since we're programmatic, we might not have kept track that we used an EXISTS clause against the <code>addresses</code> table too...).  Additionally, since the <code>users</code> and <code>addresses</code> table both have a column named <code>id</code>, let's isolate their names from each other in the COLUMNS clause by using labels:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select_from</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">apply_labels</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Let's bake for .0001 seconds and see what rises:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">query</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, addresses.id AS addresses_id, addresses.user_id AS addresses_user_id, addresses.email_address AS addresses_email_address <br/>
FROM users LEFT OUTER JOIN addresses ON users.id = addresses.user_id <br/>
WHERE users.name = ? AND (EXISTS (SELECT addresses.id <br/>
FROM addresses <br/>
WHERE addresses.user_id = users.id AND addresses.email_address LIKE ?)) ORDER BY users.fullname DESC<br/>
['jack', '%@msn.com']</div><pre>

<span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>So we started small, added one little thing at a time, and at the end we have a huge statement..which actually works.  Now let's do one more thing; the searching function wants to add another <code>email_address</code> criterion on, however it doesn't want to construct an alias of the <code>addresses</code> table; suppose many parts of the application are written to deal specifically with the <code>addresses</code> table, and to change all those functions to support receiving an arbitrary alias of the address would be cumbersome.  We can actually <em>convert</em> the <code>addresses</code> table within the <em>existing</em> statement to be an alias of itself, using <code>replace_selectable()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">a1 </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">replace_selectable</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">a1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">query</span><span class="python_operator">
</span></pre><div class="codepop">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, addresses_1.id AS addresses_1_id, addresses_1.user_id AS addresses_1_user_id, addresses_1.email_address AS addresses_1_email_address <br/>
FROM users LEFT OUTER JOIN addresses AS addresses_1 ON users.id = addresses_1.user_id <br/>
WHERE users.name = :name_1 AND (EXISTS (SELECT addresses_1.id <br/>
FROM addresses AS addresses_1 <br/>
WHERE addresses_1.user_id = users.id AND addresses_1.email_address LIKE :email_address_1)) ORDER BY users.fullname DESC</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p>One more thing though, with automatic labeling applied as well as anonymous aliasing, how do we retrieve the columns from the rows for this thing ?  The label for the <code>email_addresses</code> column is now the generated name <code>addresses_1_email_address</code>; and in another statement might be something different !  This is where accessing by result columns by <code>Column</code> object becomes very useful:
</p>

    

    <div class="code">
        <pre> 
<span class="python_literal"><a href="javascript:togglePopbox('popbox_64', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">query</span><span class="python_enclosure">)</span><span class="python_operator">:
...     </span><span class="python_keyword">print </span><span class="python_literal">"Name:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_literal">"; Email Address"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_name">a1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">]</span><span class="python_operator"></span></pre><div id="popbox_64_div" class="codepop" style="display:none;">SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, addresses_1.id AS addresses_1_id, addresses_1.user_id AS addresses_1_user_id, addresses_1.email_address AS addresses_1_email_address <br/>
FROM users LEFT OUTER JOIN addresses AS addresses_1 ON users.id = addresses_1.user_id <br/>
WHERE users.name = ? AND (EXISTS (SELECT addresses_1.id <br/>
FROM addresses AS addresses_1 <br/>
WHERE addresses_1.user_id = users.id AND addresses_1.email_address LIKE ?)) ORDER BY users.fullname DESC<br/>
['jack', '%@msn.com']</div><pre><span class="python_name">Name</span><span class="python_operator">: </span><span class="python_name">jack </span><span class="python_operator">; </span><span class="python_name">Email Address jack</span><span class="python_operator">@</span><span class="python_name">yahoo</span><span class="python_operator">.</span><span class="python_name">com</span><span class="python_operator">
</span><span class="python_name">Name</span><span class="python_operator">: </span><span class="python_name">jack </span><span class="python_operator">; </span><span class="python_name">Email Address jack</span><span class="python_operator">@</span><span class="python_name">msn</span><span class="python_operator">.</span><span class="python_name">com</span><span class="python_operator">
</span></pre>
    </div>
<p>The above example, by its end, got significantly more intense than the typical end-user constructed SQL will usually be.  However when writing higher-level tools such as ORMs, they become more significant.  SQLAlchemy's ORM relies very heavily on techniques like this.
</p>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse"></a>
    
    <div class="sectionL2">

    <h3>Everything Else</h3>
    
    

<p>The concepts of creating SQL expressions have been introduced.  What's left are more variants of the same themes.  So now we'll catalog the rest of the important things we'll need to know.
</p>


    
    <A name="sql_everythingelse_bindparams"></a>
    
    <div class="sectionL3">

    <h3>Bind Parameter Objects</h3>
    
    

<p>Throughout all these examples, SQLAlchemy is busy creating bind parameters wherever literal expressions occur.  You can also specify your own bind parameters with your own names, and use the same statement repeatedly.  The database dialect converts to the appropriate named or positional style, as here where it converts to positional for SQLite:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">bindparam</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_65', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'wendy'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_65_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users <br/>
WHERE users.name = ?<br/>
['wendy']</div><pre><span class="python_enclosure">[(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Another important aspect of bind parameters is that they may be assigned a type.  The type of the bind parameter will determine its behavior within expressions and also how the data bound to it is processed before being sent off to the database:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_operator">, </span><span class="python_name">type_</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"'%'"</span><span class="python_enclosure">)))</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_66', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'wendy'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_66_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname <br/>
FROM users <br/>
WHERE users.name LIKE ? || '%'<br/>
['wendy']</div><pre><span class="python_enclosure">[(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_literal">u'Wendy Williams'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<pre><code>
</code></pre><p>Bind parameters of the same name can also be used multiple times, where only a single named value is needed in the execute parameters:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">]</span><span class="python_operator">, </span>
<span class="python_operator">...    </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">type_</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"'%'"</span><span class="python_enclosure">)) </span><span class="python_operator">| </span>
<span class="python_operator">...    </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">type_</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">) </span><span class="python_operator">+ </span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"'@%'"</span><span class="python_enclosure">))</span><span class="python_operator">, </span>
<span class="python_operator">...    </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)])</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_67', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_67_div" class="codepop" style="display:none;">SELECT users.id, users.name, users.fullname, addresses.id, addresses.user_id, addresses.email_address <br/>
FROM users LEFT OUTER JOIN addresses ON users.id = addresses.user_id <br/>
WHERE users.name LIKE ? || '%' OR addresses.email_address LIKE ? || '@%'<br/>
['jack', 'jack']</div><pre><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_literal">u'Jack Jones'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse_functions"></a>
    
    <div class="sectionL3">

    <h3>Functions</h3>
    
    

<p>SQL functions are created using the <code>func</code> keyword, which generates functions using attribute access:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">func</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">now</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">concat</span><span class="python_enclosure">(</span><span class="python_literal">'x'</span><span class="python_operator">, </span><span class="python_literal">'y'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">concat</span><span class="python_enclosure">(</span><span class="python_operator">:</span><span class="python_name">param_1</span><span class="python_operator">, :</span><span class="python_name">param_2</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Certain functions are marked as "ANSI" functions, which mean they don't get the parenthesis added after them, such as CURRENT_TIMESTAMP:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">current_timestamp</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">CURRENT_TIMESTAMP</span><span class="python_operator">
</span></pre>
    </div>
<p>Functions are most typically used in the columns clause of a select statement, and can also be labeled as well as given a type.  Labeling a function is recommended so that the result can be targeted in a result row based on a string name, and assigning it a type is required when you need result-set processing to occur, such as for Unicode conversion and date conversions.  Below, we use the result function <code>scalar()</code> to just read the first column of the first row and then close the result; the label, even though present, is not important in this case:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">max</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">type_</span><span class="python_operator">=</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'maxemail'</span><span class="python_enclosure">)])</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">scalar</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre><div class="codepop">SELECT max(addresses.email_address) AS maxemail <br/>
FROM addresses<br/>
[]</div><pre>

<span class="python_name">www</span><span class="python_operator">@</span><span class="python_name">www</span><span class="python_operator">.</span><span class="python_name">org</span><span class="python_operator">
</span></pre>
    </div>
<p>Databases such as PostgreSQL and Oracle which support functions that return whole result sets can be assembled into selectable units, which can be used in statements.   Such as, a database function <code>calculate()</code> which takes the parameters <code>x</code> and <code>y</code>, and returns three columns which we'd like to name <code>q</code>, <code>z</code> and <code>r</code>, we can construct using "lexical" column objects as well as bind parameters:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">column</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">calculate </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'q'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'z'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">column</span><span class="python_enclosure">(</span><span class="python_literal">'r'</span><span class="python_enclosure">)]</span><span class="python_operator">, </span>
<span class="python_operator">...     </span><span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">calculate</span><span class="python_enclosure">(</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'x'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'y'</span><span class="python_enclosure">))])</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">&gt; </span><span class="python_name">calculate</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">z</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT q</span><span class="python_operator">, </span><span class="python_name">z</span><span class="python_operator">, </span><span class="python_name">r </span>
<span class="python_name">FROM calculate</span><span class="python_enclosure">(</span><span class="python_operator">:</span><span class="python_name">x</span><span class="python_operator">, :</span><span class="python_name">y</span><span class="python_enclosure">)) </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">&gt; </span><span class="python_name">z</span><span class="python_operator">
</span></pre>
    </div>
<p>If we wanted to use our <code>calculate</code> statement twice with different bind parameters, the <code>unique_params()</code> function will create copies for us, and mark the bind parameters as "unique" so that conflicting names are isolated.  Note we also make two separate aliases of our selectable:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">.</span><span class="python_name">between</span><span class="python_enclosure">(</span>
<span class="python_operator">...    </span><span class="python_name">calculate</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'c1'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">unique_params</span><span class="python_enclosure">(</span><span class="python_name">x</span><span class="python_operator">=</span><span class="python_number">17</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_operator">=</span><span class="python_number">45</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">z</span><span class="python_operator">, </span>
<span class="python_operator">...    </span><span class="python_name">calculate</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'c2'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">unique_params</span><span class="python_enclosure">(</span><span class="python_name">x</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_operator">=</span><span class="python_number">12</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">z</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">fullname </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT q</span><span class="python_operator">, </span><span class="python_name">z</span><span class="python_operator">, </span><span class="python_name">r </span>
<span class="python_name">FROM calculate</span><span class="python_enclosure">(</span><span class="python_operator">:</span><span class="python_name">x_1</span><span class="python_operator">, :</span><span class="python_name">y_1</span><span class="python_enclosure">)) </span><span class="python_name">AS c1</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_name">SELECT q</span><span class="python_operator">, </span><span class="python_name">z</span><span class="python_operator">, </span><span class="python_name">r </span>
<span class="python_name">FROM calculate</span><span class="python_enclosure">(</span><span class="python_operator">:</span><span class="python_name">x_2</span><span class="python_operator">, :</span><span class="python_name">y_2</span><span class="python_enclosure">)) </span><span class="python_name">AS c2 </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id BETWEEN c1</span><span class="python_operator">.</span><span class="python_name">z AND c2</span><span class="python_operator">.</span><span class="python_name">z</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">compile</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">params</span><span class="python_operator">
</span><span class="python_enclosure">{</span><span class="python_literal">'x_2'</span><span class="python_operator">: </span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_literal">'y_2'</span><span class="python_operator">: </span><span class="python_number">12</span><span class="python_operator">, </span><span class="python_literal">'y_1'</span><span class="python_operator">: </span><span class="python_number">45</span><span class="python_operator">, </span><span class="python_literal">'x_1'</span><span class="python_operator">: </span><span class="python_number">17</span><span class="python_enclosure">}</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse_unions"></a>
    
    <div class="sectionL3">

    <h3>Unions and Other Set Operations</h3>
    
    

<p>Unions come in two flavors, UNION and UNION ALL, which are available via module level functions:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">union</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">union</span><span class="python_enclosure">(</span>
<span class="python_operator">...     </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">==</span><span class="python_literal">'foo@bar.com'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_operator">...    </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@yahoo.com'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_68', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_68_div" class="codepop" style="display:none;">SELECT addresses.id, addresses.user_id, addresses.email_address <br/>
FROM addresses <br/>
WHERE addresses.email_address = ? UNION SELECT addresses.id, addresses.user_id, addresses.email_address <br/>
FROM addresses <br/>
WHERE addresses.email_address LIKE ? ORDER BY addresses.email_address<br/>
['foo@bar.com', '%@yahoo.com']</div><pre><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Also available, though not supported on all databases, are <code>intersect()</code>, <code>intersect_all()</code>, <code>except_()</code>, and <code>except_all()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">sql </span><span class="python_keyword">import </span><span class="python_name">except_</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">except_</span><span class="python_enclosure">(</span>
<span class="python_operator">...    </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@%.com'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_operator">...    </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">like</span><span class="python_enclosure">(</span><span class="python_literal">'%@msn.com'</span><span class="python_enclosure">))</span>
<span class="python_operator">... </span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_69', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_69_div" class="codepop" style="display:none;">SELECT addresses.id, addresses.user_id, addresses.email_address <br/>
FROM addresses <br/>
WHERE addresses.email_address LIKE ? EXCEPT SELECT addresses.id, addresses.user_id, addresses.email_address <br/>
FROM addresses <br/>
WHERE addresses.email_address LIKE ?<br/>
['%@%.com', '%@msn.com']</div><pre><span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">4</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_literal">u'wendy@aol.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse_scalar"></a>
    
    <div class="sectionL3">

    <h3>Scalar Selects</h3>
    
    

<p>To embed a SELECT in a column expression, use <code>as_scalar()</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_70', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([   </span>
<span class="python_operator">...       </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span>
<span class="python_operator">...       </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">as_scalar</span><span class="python_enclosure">()</span>
<span class="python_operator">...    </span><span class="python_enclosure">]))</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_70_div" class="codepop" style="display:none;">SELECT users.name, (SELECT count(addresses.id) AS count_1<br/>
FROM addresses <br/>
WHERE users.id = addresses.user_id) AS anon_1 <br/>
FROM users<br/>
[]</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_number">0</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_number">0</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Alternatively, applying a <code>label()</code> to a select evaluates it as a scalar as well:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_71', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([    </span>
<span class="python_operator">...       </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span>
<span class="python_operator">...       </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'address_count'</span><span class="python_enclosure">)</span>
<span class="python_operator">...    </span><span class="python_enclosure">]))</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_71_div" class="codepop" style="display:none;">SELECT users.name, (SELECT count(addresses.id) AS count_1<br/>
FROM addresses <br/>
WHERE users.id = addresses.user_id) AS address_count <br/>
FROM users<br/>
[]</div><pre><span class="python_enclosure">[(</span><span class="python_literal">u'jack'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'wendy'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'fred'</span><span class="python_operator">, </span><span class="python_number">0</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'mary'</span><span class="python_operator">, </span><span class="python_number">0</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse_correlated"></a>
    
    <div class="sectionL3">

    <h3>Correlated Subqueries</h3>
    
    

<p>Notice in the examples on "scalar selects", the FROM clause of each embedded select did not contain the <code>users</code> table in its FROM clause.  This is because SQLAlchemy automatically attempts to correlate embedded FROM objects to that of an enclosing query.  To disable this, or to specify explicit FROM clauses to be correlated, use <code>correlate()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">correlate</span><span class="python_enclosure">(</span><span class="python_name">None</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">
</span><span class="python_name">FROM users </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_enclosure">(</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">id </span>
<span class="python_name">FROM users</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span>
<span class="python_operator">...        </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">correlate</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span>
<span class="python_operator">...    </span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">s</span><span class="python_operator">
</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">email_address </span><span class="python_operator">
</span><span class="python_name">FROM users</span><span class="python_operator">, </span><span class="python_name">addresses </span><span class="python_operator">
</span><span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_enclosure">(</span><span class="python_name">SELECT users</span><span class="python_operator">.</span><span class="python_name">id </span>
<span class="python_name">FROM users </span>
<span class="python_name">WHERE users</span><span class="python_operator">.</span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_everythingelse_ordering"></a>
    
    <div class="sectionL3">

    <h3>Ordering, Grouping, Limiting, Offset...ing...</h3>
    
    

<p>The <code>select()</code> function can take keyword arguments <code>order_by</code>, <code>group_by</code> (as well as <code>having</code>), <code>limit</code>, and <code>offset</code>.  There's also <code>distinct=True</code>.  These are all also available as generative functions.  <code>order_by()</code> expressions can use the modifiers <code>asc()</code> or <code>desc()</code> to indicate ascending or descending.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)])</span><span class="python_operator">.\
...     </span><span class="python_name">group_by</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">having</span><span class="python_enclosure">(</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">SELECT addresses.user_id, count(addresses.id) AS count_1 <br/>
FROM addresses GROUP BY addresses.user_id <br/>
HAVING count(addresses.id) &gt; ?<br/>
[1]</div><pre>

<span class="python_enclosure">[(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)]</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">distinct</span><span class="python_enclosure">()</span><span class="python_operator">.\
...     </span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_operator">.</span><span class="python_name">desc</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div class="codepop">SELECT DISTINCT addresses.email_address, addresses.id <br/>
FROM addresses ORDER BY addresses.email_address DESC, addresses.id<br/>
[]</div><pre>

<span class="python_enclosure">[(</span><span class="python_literal">u'www@www.org'</span><span class="python_operator">, </span><span class="python_number">3</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'wendy@aol.com'</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'jack@yahoo.com'</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_enclosure">(</span><span class="python_literal">u'jack@msn.com'</span><span class="python_operator">, </span><span class="python_number">2</span><span class="python_enclosure">)]</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">offset</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">limit</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">print </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">fetchall</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div class="codepop">SELECT addresses.id, addresses.user_id, addresses.email_address <br/>
FROM addresses <br/>
LIMIT 1 OFFSET 1<br/>
[]</div><pre>

<span class="python_enclosure">[(</span><span class="python_number">2</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">u'jack@msn.com'</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="sql_update"></a>
    
    <div class="sectionL2">

    <h3>Updates</h3>
    
    

<p>Finally, we're back to UPDATE.  Updates work a lot like INSERTS, except there is an additional WHERE clause that can be specified.
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># change 'jack' to 'ed'</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_72', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_72_div" class="codepop" style="display:none;">UPDATE users SET name=? WHERE users.name = ?<br/>
['ed', 'jack']<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># use bind parameters</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">u </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'oldname'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_literal">'name'</span><span class="python_operator">:</span><span class="python_name">bindparam</span><span class="python_enclosure">(</span><span class="python_literal">'newname'</span><span class="python_enclosure">)})</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_73', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">u</span><span class="python_operator">, </span><span class="python_name">oldname</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_operator">, </span><span class="python_name">newname</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator"> </span></pre><div id="popbox_73_div" class="codepop" style="display:none;">UPDATE users SET name=? WHERE users.name = ?<br/>
['ed', 'jack']<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># update a column to an expression</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_74', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">:</span><span class="python_literal">"Fullname: " </span><span class="python_operator">+ </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">}))</span><span class="python_operator"> </span></pre><div id="popbox_74_div" class="codepop" style="display:none;">UPDATE users SET fullname=(? || users.name)<br/>
['Fullname: ']<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>


    
    <A name="sql_update_correlated"></a>
    
    <div class="sectionL3">

    <h3>Correlated Updates</h3>
    
    

<p>A correlated update lets you update a table using selection from another table, or the same table:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email_address</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">limit</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_75', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">values</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_operator">:</span><span class="python_name">s</span><span class="python_enclosure">}))</span><span class="python_operator"> </span></pre><div id="popbox_75_div" class="codepop" style="display:none;">UPDATE users SET fullname=(SELECT addresses.email_address <br/>
FROM addresses <br/>
WHERE addresses.user_id = users.id <br/>
LIMIT 1 OFFSET 0)<br/>
[]<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="sql_delete"></a>
    
    <div class="sectionL2">

    <h3>Deletes</h3>
    
    

<p>Finally, a delete.  Easy enough:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_76', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">())</span><span class="python_operator"> </span></pre><div id="popbox_76_div" class="codepop" style="display:none;">DELETE FROM addresses<br/>
[]<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_77', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">&gt; </span><span class="python_literal">'m'</span><span class="python_enclosure">))</span><span class="python_operator"> </span></pre><div id="popbox_77_div" class="codepop" style="display:none;">DELETE FROM users WHERE users.name &gt; ?<br/>
['m']<br/>
COMMIT</div><pre><span class="python_operator">&lt;</span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">base</span><span class="python_operator">.</span><span class="python_name">ResultProxy object at </span><span class="python_number">0x</span><span class="python_operator">...&gt;
</span></pre>
    </div>



            <a href="#sql" class="totoc">back to section top</a>
    </div>



    
    <A name="sql_reference"></a>
    
    <div class="sectionL2">

    <h3>Further Reference</h3>
    
    

<p>The best place to get every possible name you can use in constructed SQL is the <a href="sqlalchemy_sql_expression.html#docstrings_sqlalchemy.sql.expression">Generated Documentation</a>.
</p>
<p>Table Metadata Reference: <a href="#metadata">Database Meta Data</a>
</p>
<p>Engine/Connection/Execution Reference: <a href="#dbengine">Database Engines</a>
</p>
<p>SQL Types: <a href="#types">The Types System</a>
</p>




            <a href="#sql" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="advdatamapping"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#sql">SQL Expression Language Tutorial</a>

               |   
            Next: <a href="#unitofwork">Using the Session</a>
    </div>

        <h2>Mapper Configuration</h2>
    </div>


        








    
    <A name="advdatamapping"></a>
    
    <div class="sectionL1">

    
    

<p>This section references most major configurational patterns involving the <a href="#docstrings_sqlalchemy.orm_modfunc_mapper">mapper()</a> and <a href="#docstrings_sqlalchemy.orm_modfunc_relation">relation()</a> functions.  It assumes you've worked through the <a href="#datamapping">Object Relational Tutorial</a> and know how to construct and use rudimentary mappers and relations.
</p>


    
    <A name="advdatamapping_mapper"></a>
    
    <div class="sectionL2">

    <h3>Mapper Configuration</h3>
    
    

<p>Full API documentation for the ORM:
</p>
<p><a href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm">module sqlalchemy.orm</a>.
</p>
<p>Options for the <code>mapper()</code> function:
</p>
<p><a href="#docstrings_sqlalchemy.orm_modfunc_mapper">mapper()</a>.
</p>


    
    <A name="advdatamapping_mapper_columns"></a>
    
    <div class="sectionL3">

    <h3>Customizing Column Properties</h3>
    
    

<p>The default behavior of a <code>mapper</code> is to assemble all the columns in the mapped <code>Table</code> into mapped object attributes.  This behavior can be modified in several ways, as well as enhanced by SQL expressions.
</p>
<p>To load only a part of the columns referenced by a table as attributes, use the <code>include_properties</code> and <code>exclude_properties</code> arguments:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">include_properties</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_literal">'user_name'</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">exclude_properties</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_literal">'street'</span><span class="python_operator">, </span><span class="python_literal">'city'</span><span class="python_operator">, </span><span class="python_literal">'state'</span><span class="python_operator">, </span><span class="python_literal">'zip'</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>To change the name of the attribute mapped to a particular column, place the <code>Column</code> object in the <code>properties</code> dictionary with the desired key:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
   <span class="python_literal">'id'</span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
   <span class="python_literal">'name'</span><span class="python_operator">: </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>To change the names of all attributes using a prefix, use the <code>column_prefix</code> option.  This is useful for classes which wish to add their own <code>property</code> accessors:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">column_prefix</span><span class="python_operator">=</span><span class="python_literal">'_'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above will place attribute names such as <code>_user_id</code>, <code>_user_name</code>, <code>_password</code> etc. on the mapped <code>User</code> class.
</p>
<p>To place multiple columns which are known to be "synonymous" based on foreign key relationship or join condition into the same mapped attribute, put  them together using a list, as below where we map to a <code>Join</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># join users and addresses
</span><span class="python_name">usersaddresses </span><span class="python_operator">= </span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, \</span>
    <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id </span><span class="python_operator">== </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">usersaddresses</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_deferred"></a>
    
    <div class="sectionL3">

    <h3>Deferred Column Loading</h3>
    
    

<p>This feature allows particular columns of a table to not be loaded by default, instead being loaded later on when first referenced.  It is essentially "column-level lazy loading".   This feature is useful when one wants to avoid loading a large text or binary field into memory when it's not needed.  Individual columns can be lazy loaded by themselves or placed into groups that lazy-load together.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper that will load each of 'excerpt' and 'photo' in
# separate, individual-row SELECT statements when each attribute
# is first referenced on the individual object instance
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
   <span class="python_literal">'excerpt'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_literal">'photo'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Deferred columns can be placed into groups so that they load together:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">book_excerpts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'books'</span><span class="python_operator">, </span><span class="python_name">db</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'book_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'title'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">200</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">2000</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo1'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo2'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'photo3'</span><span class="python_operator">, </span><span class="python_name">Binary</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Book</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
  </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a mapper with a 'photos' deferred group.  when one photo is referenced,
# all three photos will be loaded in one SELECT statement.  The 'excerpt' will
# be loaded separately when it is first referenced.
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_operator">, </span><span class="python_name">book_excerpts</span><span class="python_operator">, </span><span class="python_name">properties </span><span class="python_operator">= </span><span class="python_enclosure">{</span>
  <span class="python_literal">'excerpt'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">excerpt</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_literal">'photo1'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo1</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_literal">'photo2'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo2</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_literal">'photo3'</span><span class="python_operator">: </span><span class="python_name">deferred</span><span class="python_enclosure">(</span><span class="python_name">book_excerpts</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">photo3</span><span class="python_operator">, </span><span class="python_name">group</span><span class="python_operator">=</span><span class="python_literal">'photos'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>You can defer or undefer columns at the <code>Query</code> level using the <code>defer</code> and <code>undefer</code> options:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">defer</span><span class="python_enclosure">(</span><span class="python_literal">'summary'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">undefer</span><span class="python_enclosure">(</span><span class="python_literal">'excerpt'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>And an entire "deferred group", i.e. which uses the <code>group</code> keyword argument to <code>deferred()</code>, can be undeferred using <code>undefer_group()</code>, sending in the group name:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Book</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">undefer_group</span><span class="python_enclosure">(</span><span class="python_literal">'photos'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_expressions"></a>
    
    <div class="sectionL3">

    <h3>SQL Expressions as Mapped Attributes</h3>
    
    

<p>To add a SQL clause composed of local or external columns as a read-only, mapped column attribute, use the <code>column_property()</code> function.  Any scalar-returning <code>ClauseElement</code> may be used, as long as it has a <code>name</code> attribute; usually, you'll want to call <code>label()</code> to give it a specific name:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'fullname'</span><span class="python_operator">: </span><span class="python_name">column_property</span><span class="python_enclosure">(</span>
        <span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">firstname </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">lastname</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'fullname'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Correlated subqueries may be used as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'address_count'</span><span class="python_operator">: </span><span class="python_name">column_property</span><span class="python_enclosure">(</span>
            <span class="python_name">select</span><span class="python_enclosure">(</span>
                <span class="python_enclosure">[</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
                <span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span>
            <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'address_count'</span><span class="python_enclosure">)</span>
        <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_attributes"></a>
    
    <div class="sectionL3">

    <h3>Changing Attribute Behavior</h3>
    
    


    
    <A name="advdatamapping_mapper_attributes_validators"></a>
    
    <div class="sectionL4">

    <h3>Simple Validators</h3>
    
    
<p>A quick way to add a "validation" routine to an attribute is to use the <code>@validates</code> decorator.  This is a shortcut for using the <a href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_Validator">class Validator(AttributeExtension)</a> attribute extension with individual column or relation based attributes.   An attribute validator can raise an exception, halting the process of mutating the attribute's value, or can change the given value into something different.   Validators, like all attribute extensions, are only called by normal userland code; they are not issued when the ORM is populating the object.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">addresses_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">EmailAddress</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    @</span><span class="python_name">validates</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">validate_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">assert </span><span class="python_literal">'@' </span><span class="python_keyword">in </span><span class="python_name">address</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">address</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">EmailAddress</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Validators also receive collection events, when items are added to a collection:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    @</span><span class="python_name">validates</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">validate_address</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">, </span><span class="python_name">address</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">assert </span><span class="python_literal">'@' </span><span class="python_keyword">in </span><span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">email</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">address</span><span class="python_operator">
</span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_attributes_overriding"></a>
    
    <div class="sectionL4">

    <h3>Using Descriptors</h3>
    
    
<p>A more comprehensive way to produce modified behavior for an attribute is to use descriptors.   These are commonly used in Python using the <code>property()</code> function.   The standard SQLAlchemy technique for descriptors is to create a plain descriptor, and to have it read/write from a mapped attribute with a different name.  To have the descriptor named the same as a column, map the column under a different name, i.e.:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">EmailAddress</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
   </span><span class="python_keyword">def </span><span class="python_name">_set_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">email</span><span class="python_enclosure">)</span><span class="python_operator">:
      </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email </span><span class="python_operator">= </span><span class="python_name">email</span><span class="python_operator">
   </span><span class="python_keyword">def </span><span class="python_name">_get_email</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
      </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_email</span><span class="python_operator">
   </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_email</span><span class="python_operator">, </span><span class="python_name">_set_email</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyAddress</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'_email'</span><span class="python_operator">: </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">email</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>However, the approach above is not complete.  While our <code>EmailAddress</code> object will shuttle the value through the <code>email</code> descriptor and into the <code>_email</code> mapped attribute, the class level <code>EmailAddress.email</code> attribute does not have the usual expression semantics usable with <code>Query</code>.  To provide these, we instead use the <code>synonym()</code> function as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">EmailAddress</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'email'</span><span class="python_operator">: </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_email'</span><span class="python_operator">, </span><span class="python_name">map_column</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>email</code> attribute is now usable in the same way as any other mapped attribute, including filter expressions, get/set operations, etc.:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">address </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">EmailAddress</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">EmailAddress</span><span class="python_operator">.</span><span class="python_name">email </span><span class="python_operator">== </span><span class="python_literal">'some address'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">address</span><span class="python_operator">.</span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_literal">'some other address'</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">q </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">EmailAddress</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'some other address'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>If the mapped class does not provide a property, the <code>synonym()</code> construct will create a default getter/setter object automatically.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_mapper_composite"></a>
    
    <div class="sectionL3">

    <h3>Composite Column Types</h3>
    
    

<p>Sets of columns can be associated with a single datatype.  The ORM treats the group of columns like a single column which accepts and returns objects using the custom datatype you provide.  In this example, we'll create a table <code>vertices</code> which stores a pair of x/y coordinates, and a custom datatype <code>Point</code> which is a composite type of an x and y column:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">vertices </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'vertices'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'x1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'y1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'x2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'y2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The requirements for the custom datatype class are that it have a constructor which accepts positional arguments corresponding to its column format, and also provides a method <code>__composite_values__()</code> which returns the state of the object as a list or tuple, in order of its column-based attributes.  It also should supply adequate <code>__eq__()</code> and <code>__ne__()</code> methods which test the equality of two instances, and may optionally provide a <code>__set_composite_values__</code> method which is used to set internal state in some cases (typically when default values have been generated during a flush):
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">Point</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">x</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">x</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">y </span><span class="python_operator">= </span><span class="python_name">y</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__composite_values__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_enclosure">[</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">x</span><span class="python_operator">, </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">y</span><span class="python_enclosure">]</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__set_composite_values__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">x</span><span class="python_operator">, </span><span class="python_name">y</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">x</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">y </span><span class="python_operator">= </span><span class="python_name">y</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__eq__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">other</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">other</span><span class="python_operator">.</span><span class="python_name">x </span><span class="python_operator">== </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">x </span><span class="python_keyword">and </span><span class="python_name">other</span><span class="python_operator">.</span><span class="python_name">y </span><span class="python_operator">== </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">y</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__ne__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">other</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return not </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__eq__</span><span class="python_enclosure">(</span><span class="python_name">other</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>If <code>__set_composite_values__()</code> is not provided, the names of the mapped columns are taken as the names of attributes on the object, and <code>setattr()</code> is used to set data.
</p>
<p>Setting up the mapping uses the <code>composite()</code> function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">Vertex</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Vertex</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'start'</span><span class="python_operator">: </span><span class="python_name">composite</span><span class="python_enclosure">(</span><span class="python_name">Point</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">x1</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">y1</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'end'</span><span class="python_operator">: </span><span class="python_name">composite</span><span class="python_enclosure">(</span><span class="python_name">Point</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">x2</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">y2</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>We can now use the <code>Vertex</code> instances as well as querying as though the <code>start</code> and <code>end</code> attributes are regular scalar attributes:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">v </span><span class="python_operator">= </span><span class="python_name">Vertex</span><span class="python_enclosure">(</span><span class="python_name">Point</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Point</span><span class="python_enclosure">(</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_number">6</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">save</span><span class="python_enclosure">(</span><span class="python_name">v</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">v2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Vertex</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Vertex</span><span class="python_operator">.</span><span class="python_name">start </span><span class="python_operator">== </span><span class="python_name">Point</span><span class="python_enclosure">(</span><span class="python_number">3</span><span class="python_operator">, </span><span class="python_number">4</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The "equals" comparison operation by default produces an AND of all corresponding columns equated to one another.  If you'd like to override this, or define the behavior of other SQL operators for your new type, the <code>composite()</code> function accepts an extension object of type <code>sqlalchemy.orm.PropComparator</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">PropComparator</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">sql</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">PointComparator</span><span class="python_enclosure">(</span><span class="python_name">PropComparator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__gt__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">other</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_literal">"""define the 'greater than' operation"""</span><span class="python_operator">
</span>
        <span class="python_keyword">return </span><span class="python_name">sql</span><span class="python_operator">.</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_operator">*</span><span class="python_enclosure">[</span><span class="python_name">a</span><span class="python_operator">&gt;</span><span class="python_name">b </span><span class="python_keyword">for </span><span class="python_name">a</span><span class="python_operator">, </span><span class="python_name">b </span><span class="python_keyword">in</span>
                          <span class="python_name">zip</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">prop</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">,</span>
                              <span class="python_name">other</span><span class="python_operator">.</span><span class="python_name">__composite_values__</span><span class="python_enclosure">())])</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">maper</span><span class="python_enclosure">(</span><span class="python_name">Vertex</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'start'</span><span class="python_operator">: </span><span class="python_name">composite</span><span class="python_enclosure">(</span><span class="python_name">Point</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">x1</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">y1</span><span class="python_operator">, </span><span class="python_name">comparator</span><span class="python_operator">=</span><span class="python_name">PointComparator</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'end'</span><span class="python_operator">: </span><span class="python_name">composite</span><span class="python_enclosure">(</span><span class="python_name">Point</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">x2</span><span class="python_operator">, </span><span class="python_name">vertices</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">y2</span><span class="python_operator">, </span><span class="python_name">comparator</span><span class="python_operator">=</span><span class="python_name">PointComparator</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_orderby"></a>
    
    <div class="sectionL3">

    <h3>Controlling Ordering</h3>
    
    

<p>As of version 0.5, the ORM does not generate ordering for any query unless explicitly configured.
</p>
<p>The "default" ordering for a collection, which applies to list-based collections, can be configured using the <code>order_by</code> keyword argument on <code>relation()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order address objects by address id
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">address_id</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that when using eager loaders with relations, the tables used by the eager load's join are anonymously aliased.  You can only order by these columns if you specify it at the <code>relation()</code> level.  To control ordering at the query level based on a related table, you <code>join()</code> to that relation, then order by it:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">street</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Ordering for rows loaded through <code>Query</code> is usually specified using the <code>order_by()</code> generative method.  There is also an option to set a default ordering for Queries which are against a single mapped entity and where there was no explicit <code>order_by()</code> stated, which is the <code>order_by</code> keyword argument to <code>mapper()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># order by a column
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># order by multiple items
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_name</span><span class="python_operator">.</span><span class="python_name">desc</span><span class="python_enclosure">()])</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, a <code>Query</code> issued for the <code>User</code> class will use the value of the mapper's <code>order_by</code> setting if the <code>Query</code> itself has no ordering specified.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_inheritance"></a>
    
    <div class="sectionL3">

    <h3>Mapping Class Inheritance Hierarchies</h3>
    
    

<p>SQLAlchemy supports three forms of inheritance:  <em>single table inheritance</em>, where several types of classes are stored in one table, <em>concrete table inheritance</em>, where each type of class is stored in its own table, and <em>joined table inheritance</em>, where the parent/child classes are stored in their own tables that are joined together in a select.  Whereas support for single and joined table inheritance is strong, concrete table inheritance is a less common scenario with some particular problems so is not quite as flexible.
</p>
<p>When mappers are configured in an inheritance relationship, SQLAlchemy has the ability to load elements "polymorphically", meaning that a single query can return objects of multiple types.
</p>
<p>For the following sections, assume this class relationship:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">Employee</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Manager</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">manager_data</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data </span><span class="python_operator">= </span><span class="python_name">manager_data</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">manager_data</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Engineer</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">engineer_info</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info </span><span class="python_operator">= </span><span class="python_name">engineer_info</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">__class__</span><span class="python_operator">.</span><span class="python_name">__name__ </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+ </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">+ </span><span class="python_literal">" " </span><span class="python_operator">+  </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">
</span></pre>
    </div>

    
    <A name="advdatamapping_mapper_inheritance_joined"></a>
    
    <div class="sectionL4">

    <h3>Joined Table Inheritance</h3>
    
    
<p>In joined table inheritance, each class along a particular classes' list of parents is represented by a unique table.  The total set of attributes for a particular instance is represented as a join along all tables in its inheritance path.  Here, we first define a table to represent the <code>Employee</code> class.  This table will contain a primary key column (or columns), and a column for each attribute that's represented by <code>Employee</code>.  In this case it's just <code>name</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The table also has a column called <code>type</code>.  It is strongly advised in both single- and joined- table inheritance scenarios that the root table contains a column whose sole purpose is that of the <strong>discriminator</strong>; it stores a value which indicates the type of object represented within the row.  The column may be of any desired datatype.  While there are some "tricks" to work around the requirement that there be a discriminator column, they are more complicated to configure when one wishes to load polymorphically.
</p>
<p>Next we define individual tables for each of <code>Engineer</code> and <code>Manager</code>, which each contain columns that represent the attributes unique to the subclass they represent.  Each table also must contain a primary key column (or columns), and in most cases a foreign key reference to the parent table.  It is  standard practice that the same column is used for both of these roles, and that the column is also named the same as that of the parent table.  However this is optional in SQLAlchemy; separate columns may be used for primary key and parent-relation, the column may be named differently than that of the parent, and even a custom join condition can be specified between parent and child tables instead of using a foreign key.  In joined table inheritance, the primary key of an instance is always represented by the primary key of the base table only (new in SQLAlchemy 0.4).
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engineers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.employee_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">managers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'employees.employee_id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>We then configure mappers as usual, except we use some additional arguments to indicate the inheritance relationship, the polymorphic discriminator column, and the <strong>polymorphic identity</strong> of each class; this is the value that will be stored in the polymorphic discriminator column.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>And that's it.  Querying against <code>Employee</code> will return a combination of <code>Employee</code>, <code>Engineer</code> and <code>Manager</code> objects.
</p>

    
    <A name="advdatamapping_mapper_inheritance_joined_querying"></a>
    
    <div class="sectionL4">

    <h3>Polymorphic Querying Strategies</h3>
    
    
<p>The <code>Query</code> object includes some helper functionality when dealing with joined-table inheritance mappings.  These are the <code>with_polymorphic()</code> and <code>of_type()</code> methods, both of which are introduced in version 0.4.4.
</p>
<p>The <code>with_polymorphic()</code> method affects the specific subclass tables which the Query selects from.  Normally, a query such as this:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">==</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Selects only from the <code>employees</code> table.  The criterion we use in <code>filter()</code> and other methods will generate WHERE criterion against this table.  What if we wanted to load <code>Employee</code> objects but also wanted to use criterion against <code>Engineer</code> ?  We could just query against the <code>Engineer</code> class instead.  But, if we were using criterion which filters among more than one subclass (subclasses which do not inherit directly from one to the other), we'd like to select from an outer join of all those tables.  The <code>with_polymorphic()</code> method can tell <code>Query</code> which joined-table subclasses we want to select for:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_polymorphic</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'some info'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Even without criterion, the <code>with_polymorphic()</code> method has the added advantage that instances are loaded from all of their tables in one result set.  Such as, to optimize the loading of all <code>Employee</code> objects, <code>with_polymorphic()</code> accepts <code>'*'</code> as a wildcard indicating that all subclass tables should be joined:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_polymorphic</span><span class="python_enclosure">(</span><span class="python_literal">'*'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p><code>with_polymorphic()</code> is an effective query-level alternative to the existing <code>select_table</code> option available on <code>mapper()</code>.
</p>
<p>Next is a way to join along <code>relation</code> paths while narrowing the criterion to specific subclasses.  Suppose the <code>employees</code> table represents a collection of employees which are associated with a <code>Company</code> object.  We'll add a <code>company_id</code> column to the <code>employees</code> table and a new table <code>companies</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">companies </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'companies'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
   <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'companies.company_id'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Company</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_operator">, </span><span class="python_name">companies</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'employees'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>If we wanted to join from <code>Company</code> to not just <code>Employee</code> but specifically <code>Engineers</code>, using the <code>join()</code> method or <code>any()</code> or <code>has()</code> operators will by default create a join from <code>companies</code> to <code>employees</code>, without including <code>engineers</code> or <code>managers</code> in the mix.  If we wish to have criterion which is specifically against the <code>Engineer</code> class, we can tell those methods to join or subquery against the full set of tables representing the subclass using the <code>of_type()</code> operator:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_operator">.</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">of_type</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'someinfo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>A longhand notation, introduced in 0.4.3, is also available, which involves spelling out the full target selectable within a 2-tuple:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">((</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)))</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'someinfo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The second notation allows more flexibility, such as joining to any group of subclass tables:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">((</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">managers</span><span class="python_enclosure">)))</span><span class="python_operator">.\
    </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">or_</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'someinfo'</span><span class="python_operator">, </span><span class="python_name">Manager</span><span class="python_operator">.</span><span class="python_name">manager_data</span><span class="python_operator">==</span><span class="python_literal">'somedata'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>any()</code> and <code>has()</code> operators also can be used with <code>of_type()</code> when the embedded criterion is in terms of a subclass:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_operator">.</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">of_type</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">any</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'someinfo'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that the <code>any()</code> and <code>has()</code> are both shorthand for a correlated EXISTS query.  To build one by hand looks like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span>
    <span class="python_name">exists</span><span class="python_enclosure">([</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
        <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">.</span><span class="python_name">engineer_info</span><span class="python_operator">==</span><span class="python_literal">'someinfo'</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">company_id</span><span class="python_operator">==</span><span class="python_name">companies</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">company_id</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">from_obj</span><span class="python_operator">=</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The EXISTS subquery above selects from the join of <code>employees</code> to <code>engineers</code>, and also specifies criterion which correlates the EXISTS subselect back to the parent <code>companies</code> table.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_inheritance_joined_optimizing"></a>
    
    <div class="sectionL4">

    <h3>Optimizing Joined Table Loads</h3>
    
    
<p>When loading fresh from the database, the joined-table setup above will query from the parent table first, then for each row will issue a second query to the child table.  For example, for a load of five rows with <code>Employee</code> id 3, <code>Manager</code> ids 1 and 5 and <code>Engineer</code> ids 2 and 4, will produce queries along the lines of this example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre><div class="codepop">SELECT employees.employee_id AS employees_employee_id, employees.name AS employees_name, employees.type AS employees_type<br/>
FROM employees ORDER BY employees.oid<br/>
[]<br/>
SELECT managers.employee_id AS managers_employee_id, managers.manager_data AS managers_manager_data<br/>
FROM managers<br/>
WHERE ? = managers.employee_id<br/>
[5]<br/>
SELECT engineers.employee_id AS engineers_employee_id, engineers.engineer_info AS engineers_engineer_info<br/>
FROM engineers<br/>
WHERE ? = engineers.employee_id<br/>
[2]<br/>
SELECT engineers.employee_id AS engineers_employee_id, engineers.engineer_info AS engineers_engineer_info<br/>
FROM engineers<br/>
WHERE ? = engineers.employee_id<br/>
[4]<br/>
SELECT managers.employee_id AS managers_employee_id, managers.manager_data AS managers_manager_data<br/>
FROM managers<br/>
WHERE ? = managers.employee_id<br/>
[1]</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p>The above query works well for a <code>get()</code> operation, since it limits the queries to only the tables directly involved in fetching a single instance.  For instances which are already present in the session, the secondary table load is not needed.  However, the above loading style is not efficient for loading large groups of objects, as it incurs separate queries for each parent row.
</p>
<p>One way to reduce the number of "secondary" loads of child rows is to "defer" them, using <code>polymorphic_fetch='deferred'</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, \</span>
    <span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_operator">, </span><span class="python_name">polymorphic_fetch</span><span class="python_operator">=</span><span class="python_literal">'deferred'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above configuration queries in the same manner as earlier, except the load of each "secondary" table occurs only when attributes referencing those columns are first referenced on the loaded instance.  This style of loading is very efficient for cases where large selects of items occur, but a detailed "drill down" of extra inherited properties is less common.
</p>
<p>More commonly, an all-at-once load may be achieved by constructing a query which combines all three tables together.  The easiest way to do this as of version 0.4.4 is to use the <code>with_polymorphic()</code> query method which will automatically join in the classes desired:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_polymorphic</span><span class="python_enclosure">([</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">Manager</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>Which produces a query like the following:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre><div class="codepop">SELECT employees.employee_id AS employees_employee_id, engineers.employee_id AS engineers_employee_id, managers.employee_id AS managers_employee_id, employees.name AS employees_name, employees.type AS employees_type, engineers.engineer_info AS engineers_engineer_info, managers.manager_data AS managers_manager_data<br/>
FROM employees LEFT OUTER JOIN engineers ON employees.employee_id = engineers.employee_id LEFT OUTER JOIN managers ON employees.employee_id = managers.employee_id ORDER BY employees.oid<br/>
[]</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p><code>with_polymorphic()</code> accepts a single class or mapper, a list of classes/mappers, or the string <code>'*'</code> to indicate all subclasses.  It also accepts a second argument <code>selectable</code> which replaces the automatic join creation and instead selects directly from the selectable given.  This can allow polymorphic loads from a variety of inheritance schemes including concrete tables, if the appropriate unions are constructed.
</p>
<p>Similar behavior as provided by <code>with_polymorphic()</code> can be configured at the mapper level so that any user-defined query is used by default in order to load instances.  The <code>select_table</code> argument references an arbitrary selectable which the mapper will use for load operations (it has no impact on save operations).  Any selectable can be used for this, such as a UNION of tables.  For joined table inheritance, the easiest method is to use OUTER JOIN:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">join </span><span class="python_operator">= </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">engineers</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">managers</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, \</span>
    <span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_operator">, </span><span class="python_name">select_table</span><span class="python_operator">=</span><span class="python_name">join</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above mapping will produce a query similar to that of <code>with_polymorphic('*')</code> for every query of <code>Employee</code> objects.
</p>
<p>When <code>select_table</code> is used, <code>with_polymorphic()</code> still overrides its usage at the query level.  For example, if <code>select_table</code> were configured to load from a join of multiple tables, using <code>with_polymorphic(Employee)</code> will limit the list of tables selected from to just the base table (as always, tables which don't get loaded in the first pass will be loaded on an as-needed basis).
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_mapper_inheritance_single"></a>
    
    <div class="sectionL4">

    <h3>Single Table Inheritance</h3>
    
    
<p>Single table inheritance is where the attributes of the base class as well as all subclasses are represented within a single table.  A column is present in the table for every attribute mapped to the base class and all subclasses; the columns which correspond to a single subclass are nullable.  This configuration looks much like joined-table inheritance except there's only one table.  In this case, a <code>type</code> column is required, as there would be no other way to discriminate between classes.  The table is specified in the base mapper only; for the inheriting classes, leave their <code>table</code> parameter blank:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_operator">, \</span>
    <span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">employees_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that the mappers for the derived classes Manager and Engineer omit the specification of their associated table, as it is inherited from the employee_mapper. Omitting the table specification for derived mappers in single-table inheritance is required.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_inheritance_concrete"></a>
    
    <div class="sectionL4">

    <h3>Concrete Table Inheritance</h3>
    
    
<p>This form of inheritance maps each class to a distinct table, as below:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">managers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engineers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Notice in this case there is no <code>type</code> column.  If polymorphic loading is not required, there's no advantage to using <code>inherits</code> here; you just define a separate mapper for each class.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>To load polymorphically, the <code>select_table</code> argument is currently required.  In this case we must construct a UNION of all three tables.  SQLAlchemy includes a helper function to create these called <code>polymorphic_union</code>, which will map all the different columns into a structure of selects with the same numbers and names of columns, and also generate a virtual <code>type</code> column for each subselect:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">pjoin </span><span class="python_operator">= </span><span class="python_name">polymorphic_union</span><span class="python_enclosure">({</span>
    <span class="python_literal">'employee'</span><span class="python_operator">: </span><span class="python_name">employees_table</span><span class="python_operator">,</span>
    <span class="python_literal">'manager'</span><span class="python_operator">: </span><span class="python_name">managers_table</span><span class="python_operator">,</span>
    <span class="python_literal">'engineer'</span><span class="python_operator">: </span><span class="python_name">engineers_table</span>
<span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_literal">'pjoin'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">employee_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_operator">, </span><span class="python_name">select_table</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">, \</span>
    <span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">manager_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, \</span>
    <span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engineer_mapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, \</span>
    <span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Upon select, the polymorphic union produces a query like this:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre><div class="codepop">SELECT pjoin.type AS pjoin_type, pjoin.manager_data AS pjoin_manager_data, pjoin.employee_id AS pjoin_employee_id,<br/>
pjoin.name AS pjoin_name, pjoin.engineer_info AS pjoin_engineer_info<br/>
FROM (<br/>
    SELECT employees.employee_id AS employee_id, CAST(NULL AS VARCHAR(50)) AS manager_data, employees.name AS name,<br/>
    CAST(NULL AS VARCHAR(50)) AS engineer_info, 'employee' AS type<br/>
    FROM employees<br/>
UNION ALL<br/>
    SELECT managers.employee_id AS employee_id, managers.manager_data AS manager_data, managers.name AS name,<br/>
    CAST(NULL AS VARCHAR(50)) AS engineer_info, 'manager' AS type<br/>
    FROM managers<br/>
UNION ALL<br/>
    SELECT engineers.employee_id AS employee_id, CAST(NULL AS VARCHAR(50)) AS manager_data, engineers.name AS name,<br/>
    engineers.engineer_info AS engineer_info, 'engineer' AS type<br/>
    FROM engineers<br/>
) AS pjoin ORDER BY pjoin.oid<br/>
[]</div><pre>

<span class="python_operator"></span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_inheritance_relations"></a>
    
    <div class="sectionL4">

    <h3>Using Relations with Inheritance</h3>
    
    
<p>Both joined-table and single table inheritance scenarios produce mappings which are usable in relation() functions; that is, it's possible to map a parent object to a child object which is polymorphic.  Similarly, inheriting mappers can have <code>relation()</code>s of their own at any level, which are inherited to each child class.  The only requirement for relations is that there is a table relationship between parent and child.  An example is the following modification to the joined table inheritance example, which sets a bi-directional relationship between <code>Employee</code> and <code>Company</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'companies.company_id'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">companies </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'companies'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Company</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_operator">, </span><span class="python_name">companies</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
   <span class="python_literal">'employees'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'company'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>SQLAlchemy has a lot of experience in this area; the optimized "outer join" approach can be used freely for parent and child relationships, eager loads are fully useable, query aliasing and other tricks are fully supported as well.
</p>
<p>In a concrete inheritance scenario, mapping <code>relation()</code>s is more difficult since the distinct classes do not share a table.  In this case, you <em>can</em> establish a relationship from parent to child if a join condition can be constructed from parent to child, if each child table contains a foreign key to the parent:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">companies </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'companies'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_name">employees_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'companies.id'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">managers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'managers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'manager_data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'companies.id'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engineers_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engineers'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'engineer_info'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'company_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'companies.id'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_operator">, </span><span class="python_name">employees_table</span><span class="python_operator">, </span><span class="python_name">select_table</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">, </span><span class="python_name">polymorphic_on</span><span class="python_operator">=</span><span class="python_name">pjoin</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'employee'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Manager</span><span class="python_operator">, </span><span class="python_name">managers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'manager'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Engineer</span><span class="python_operator">, </span><span class="python_name">engineers_table</span><span class="python_operator">, </span><span class="python_name">inherits</span><span class="python_operator">=</span><span class="python_name">employee_mapper</span><span class="python_operator">, </span><span class="python_name">concrete</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">polymorphic_identity</span><span class="python_operator">=</span><span class="python_literal">'engineer'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_operator">, </span><span class="python_name">companies</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'employees'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Employee</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Let's crank it up and try loading with an eager load:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Company</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre><div class="codepop">SELECT anon_1.type AS anon_1_type, anon_1.manager_data AS anon_1_manager_data, anon_1.engineer_info AS anon_1_engineer_info,<br/>
anon_1.employee_id AS anon_1_employee_id, anon_1.name AS anon_1_name, anon_1.company_id AS anon_1_company_id,<br/>
companies.id AS companies_id, companies.name AS companies_name<br/>
FROM companies LEFT OUTER JOIN (SELECT CAST(NULL AS VARCHAR(50)) AS engineer_info, employees.employee_id AS employee_id,<br/>
CAST(NULL AS VARCHAR(50)) AS manager_data, employees.name AS name, employees.company_id AS company_id, 'employee' AS type<br/>
FROM employees UNION ALL SELECT CAST(NULL AS VARCHAR(50)) AS engineer_info, managers.employee_id AS employee_id,<br/>
managers.manager_data AS manager_data, managers.name AS name, managers.company_id AS company_id, 'manager' AS type<br/>
FROM managers UNION ALL SELECT engineers.engineer_info AS engineer_info, engineers.employee_id AS employee_id,<br/>
CAST(NULL AS VARCHAR(50)) AS manager_data, engineers.name AS name, engineers.company_id AS company_id, 'engineer' AS type<br/>
FROM engineers) AS anon_1 ON companies.id = anon_1.company_id ORDER BY companies.oid, anon_1.oid<br/>
[]</div><pre>

<span class="python_operator"></span></pre>
    </div>
<p>The big limitation with concrete table inheritance is that relation()s placed on each concrete mapper do <strong>not</strong> propagate to child mappers.  If you want to have the same relation()s set up on all concrete mappers, they must be configured manually on each.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_mapper_joins"></a>
    
    <div class="sectionL3">

    <h3>Mapping a Class against Multiple Tables</h3>
    
    

<p>Mappers can be constructed against arbitrary relational units (called <code>Selectables</code>) as well as plain <code>Tables</code>.  For example, The <code>join</code> keyword from the SQL package creates a neat selectable unit comprised of multiple tables, complete with its own composite primary key, which can be passed in to a mapper as the table.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># a class
</span><span class="python_keyword">class </span><span class="python_name">AddressUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># define a Join
</span><span class="python_operator"></span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of an AddressUser object will be
# based on (user_id, address_id) since those are the primary keys involved
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">AddressUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>A second example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># many-to-many join on an association table
</span><span class="python_name">j </span><span class="python_operator">= </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">,</span>
        <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">keywords</span><span class="python_operator">,</span>
           <span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a class
</span><span class="python_keyword">class </span><span class="python_name">KeywordUser</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># map to it - the identity of a KeywordUser object will be
# (user_id, keyword_id) since those are the primary keys involved
</span><span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">KeywordUser</span><span class="python_operator">, </span><span class="python_name">j</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user_id'</span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">, </span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">]</span><span class="python_operator">,</span>
    <span class="python_literal">'keyword_id'</span><span class="python_operator">: </span><span class="python_enclosure">[</span><span class="python_name">userkeywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">, </span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_enclosure">]</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>In both examples above, "composite" columns were added as properties to the mappers; these are aggregations of multiple columns into one mapper property, which instructs the mapper to keep both of those columns set at the same value.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_selects"></a>
    
    <div class="sectionL3">

    <h3>Mapping a Class against Arbitrary Selects</h3>
    
    

<p>Similar to mapping against a join, a plain select() object can be used with a mapper as well.  Below, an example select which contains two aggregate functions and a group_by is mapped to a class:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">customers</span><span class="python_operator">,</span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">count</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'order_count'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
            <span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">max</span><span class="python_enclosure">(</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">price</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">label</span><span class="python_enclosure">(</span><span class="python_literal">'highest_order'</span><span class="python_enclosure">)]</span><span class="python_operator">,</span>
            <span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">==</span><span class="python_name">orders</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">customer_id</span><span class="python_operator">,</span>
            <span class="python_name">group_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">c </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">customers</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">]</span>
            <span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'somealias'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Customer</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Customer</span><span class="python_operator">, </span><span class="python_name">s</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the "customers" table is joined against the "orders" table to produce a full row for each customer row, the total count of related rows in the "orders" table, and the highest price in the "orders" table, grouped against the full set of columns in the "customers" table.  That query is then mapped against the Customer class.  New instances of Customer will contain attributes for each column in the "customers" table as well as an "order_count" and "highest_order" attribute.  Updates to the Customer object will only be reflected in the "customers" table and not the "orders" table.  This is because the primary key columns of the "orders" table are not represented in this mapper and therefore the table is not affected by save or delete operations.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_multiple"></a>
    
    <div class="sectionL3">

    <h3>Multiple Mappers for One Class</h3>
    
    

<p>The first mapper created for a certain class is known as that class's "primary mapper."  Other mappers can be created as well on the "load side" - these are called <strong>secondary mappers</strong>.   This is a mapper that must be constructed with the keyword argument <code>non_primary=True</code>, and represents a load-only mapper.  Objects that are loaded with a secondary mapper will have their save operation processed by the primary mapper.  It is also invalid to add new <code>relation()</code>s to a non-primary mapper. To use this mapper with the Session, specify it to the <code>query</code> method:
</p>
<p>example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># primary mapper
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># make a secondary mapper to load User against a join
</span><span class="python_name">othermapper </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_name">someothertable</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">non_primary</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># select
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">othermapper</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The "non primary mapper" is a rarely needed feature of SQLAlchemy; in most cases, the <code>Query</code> object can produce any kind of query that's desired.  It's recommended that a straight <code>Query</code> be used in place of a non-primary mapper unless the mapper approach is absolutely needed.  Current use cases for the "non primary mapper" are when you want to map the class to a particular select statement or view to which additional query criterion can be added, and for when the particular mapped select statement or view is to be placed in a <code>relation()</code> of a parent mapper.
</p>
<p>Versions of SQLAlchemy previous to 0.5 included another mapper flag called "entity_name", as of version 0.5.0 this feature has been removed (it never worked very well).
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_reconstructor"></a>
    
    <div class="sectionL3">

    <h3>Constructors and Object Initialization</h3>
    
    

<p>Mapping imposes no restrictions or requirements on the constructor
   (<code>__init__</code>) method for the class.  You are free to require any
   arguments for the function that you wish, assign attributes to the
   instance that are unknown to the ORM, and generally do anything else
   you would normally do when writing a constructor for a Python class.
</p>
<p>The SQLAlchemy ORM does not call <code>__init__</code> when recreating objects
   from database rows.  The ORM's process is somewhat akin to the Python
   standard library's <code>pickle</code> module, invoking the low level <code>__new__</code>
   method and then quietly restoring attributes directly on the instance
   rather than calling <code>__init__</code>.
</p>
<p>If you need to do some setup on database-loaded instances before
   they're ready to use, you can use the <code>@reconstructor</code> decorator to
   tag a method as the ORM counterpart to <code>__init__</code>.  SQLAlchemy will
   call this method with no arguments every time it loads or reconstructs
   one of your instances.  This is useful for recreating transient
   properties that are normally assigned in your <code>__init__</code>.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_name">orm</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyMappedClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">data</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data </span><span class="python_operator">= </span><span class="python_name">data</span><span class="python_operator">
        </span><span class="python_comment"># we need stuff on all instances, but not in the database.
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">stuff </span><span class="python_operator">= </span><span class="python_enclosure">[]</span><span class="python_operator">
</span>
    <span class="python_operator">@</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">reconstructor</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">init_on_load</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">stuff </span><span class="python_operator">= </span><span class="python_enclosure">[]</span><span class="python_operator">
</span></pre>
    </div>
<p>When <code>obj = MyMappedClass()</code> is executed, Python calls the <code>__init__</code>
   method as normal and the <code>data</code> argument is required.  When instances
   are loaded during a <code>Query</code> operation as in
   <code>query(MyMappedClass).one()</code>, <code>init_on_load</code> is called instead.
</p>
<p>Any method may be tagged as the <code>reconstructor</code>, even the <code>__init__</code>
   method.  SQLAlchemy will call the reconstructor method with no
   arguments.  Scalar (non-collection) database-mapped attributes of the
   instance will be available for use within the function.
   Eagerly-loaded collections are generally not yet available and will
   usually only contain the first element.  ORM state changes made to
   objects at this stage will not be recorded for the next flush()
   operation, so the activity within a reconstructor should be
   conservative.
</p>
<p>While the ORM does not call your <code>__init__</code> method, it will modify the
   class's <code>__init__</code> slightly.  The method is lightly wrapped to act as
   a trigger for the ORM, allowing mappers to be compiled automatically
   and will fire a <code>init_instance</code> event that <code>MapperExtension</code>s may
   listen for.  <code>MapperExtension</code>s can also listen for a
   <code>reconstruct_instance</code> event, analogous to the <code>reconstructor</code>
   decorator above.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_mapper_extending"></a>
    
    <div class="sectionL3">

    <h3>Extending Mapper</h3>
    
    

<p>Mappers can have functionality augmented or replaced at many points in its execution via the usage of the MapperExtension class.  This class is just a series of "hooks" where various functionality takes place.  An application can make its own MapperExtension objects, overriding only the methods it needs.  Methods that are not overridden return the special value <code>sqlalchemy.orm.EXT_CONTINUE</code> to allow processing to continue to the next MapperExtension or simply proceed normally if there are no more extensions.
</p>
<p>API documentation for MapperExtension: <a href="sqlalchemy_orm.html#docstrings_sqlalchemy.orm_MapperExtension">class MapperExtension(object)</a>
</p>
<p>To use MapperExtension, make your own subclass of it and just send it off to a mapper:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MyExtension</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>
<p>Multiple extensions will be chained together and processed in order; they are specified as a list:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">m </span><span class="python_operator">= </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">ext1</span><span class="python_operator">, </span><span class="python_name">ext2</span><span class="python_operator">, </span><span class="python_name">ext3</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation"></a>
    
    <div class="sectionL2">

    <h3>Relation Configuration</h3>
    
    

<p>The full list of options for the <code>relation()</code> function:
</p>
<p><a href="#docstrings_sqlalchemy.orm_modfunc_relation">relation()</a>
</p>


    
    <A name="advdatamapping_relation_patterns"></a>
    
    <div class="sectionL3">

    <h3>Basic Relational Patterns</h3>
    
    

<p>A quick walkthrough of the basic relational patterns.
</p>

    
    <A name="advdatamapping_relation_patterns_onetomany"></a>
    
    <div class="sectionL4">

    <h3>One To Many</h3>
    
    
<p>A one to many relationship places a foreign key in the child table referencing the parent.   SQLAlchemy creates the relationship as a collection on the parent object containing instances of the child object.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">parent_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">child_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'child'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'parent.id'</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Parent</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Child</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">child_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>To establish a bi-directional relationship in one-to-many, where the "reverse" side is a many to one, specify the <code>backref</code> option:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'parent'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">child_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p><code>Child</code> will get a <code>parent</code> attribute with many-to-one semantics.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_patterns_manytoone"></a>
    
    <div class="sectionL4">

    <h3>Many To One</h3>
    
    
<p>Many to one places a foreign key in the parent table referencing the child.  The mapping setup is identical to one-to-many, however SQLAlchemy creates the relationship as a scalar attribute on the parent object referencing a single instance of the child object.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">parent_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'child_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'child.id'</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_name">child_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'child'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Parent</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Child</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'child'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">child_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Backref behavior is available here as well, where <code>backref=&quot;parents&quot;</code> will place a one-to-many collection on the <code>Child</code> class.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_patterns_onetoone"></a>
    
    <div class="sectionL4">

    <h3>One To One</h3>
    
    
<p>One To One is essentially a bi-directional relationship with a scalar attribute on both sides.  To achieve this, the <code>uselist=False</code> flag indicates the placement of a scalar attribute instead of a collection on the "many" side of the relationship.  To convert one-to-many into one-to-one:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'child'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'parent'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Or to turn many-to-one into one-to-one:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'child'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">uselist</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_patterns_manytomany"></a>
    
    <div class="sectionL4">

    <h3>Many To Many</h3>
    
    
<p>Many to Many adds an association table between two classes.  The association table is indicated by the <code>secondary</code> argument to <code>relation()</code>.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">left_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'left'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">right_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'right'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">association_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'association'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'left_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'left.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'right_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'right.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">left_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">association_table</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">right_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>For a bi-directional relationship, both sides of the relation contain a collection by default, which can be modified on either side via the <code>uselist</code> flag to be scalar.  The <code>backref</code> keyword will automatically use the same <code>secondary</code> argument for the reverse relation:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">left_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">association_table</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'parents'</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_patterns_association"></a>
    
    <div class="sectionL4">

    <h3>Association Object</h3>
    
    
<p>The association object pattern is a variant on many-to-many:  it specifically is used when your association table contains additional columns beyond those which are foreign keys to the left and right tables.  Instead of using the <code>secondary</code> argument, you map a new class directly to the association table.  The left side of the relation references the association object via one-to-many, and the association class references the right side via many-to-one.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">left_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'left'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">right_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'right'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">association_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'association'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'left_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'left.id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'right_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'right.id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">left_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Association</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Association</span><span class="python_operator">, </span><span class="python_name">association_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'child'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">right_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The bi-directional version adds backrefs to both relations:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">left_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Association</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">"parent"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Association</span><span class="python_operator">, </span><span class="python_name">association_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'child'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">"parent_assocs"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">right_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Working with the association pattern in its direct form requires that child objects are associated with an association instance before being appended to the parent; similarly, access from parent to child goes through the association object:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># create parent, append a child via association
</span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">Parent</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">a </span><span class="python_operator">= </span><span class="python_name">Association</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">a</span><span class="python_operator">.</span><span class="python_name">child </span><span class="python_operator">= </span><span class="python_name">Child</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">p</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">a</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># iterate through child objects via association, including association
# attributes
</span><span class="python_keyword">for </span><span class="python_name">assoc </span><span class="python_keyword">in </span><span class="python_name">p</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">
    </span><span class="python_keyword">print </span><span class="python_name">assoc</span><span class="python_operator">.</span><span class="python_name">child</span><span class="python_operator">
</span></pre>
    </div>
<p>To enhance the association object pattern such that direct access to the <code>Association</code> object is optional, SQLAlchemy provides the <a href="#plugins_associationproxy">associationproxy</a>.
</p>
<p><strong>Important Note</strong>:  it is strongly advised that the <code>secondary</code> table argument not be combined with the Association Object pattern, unless the <code>relation()</code> which contains the <code>secondary</code> argument is marked <code>viewonly=True</code>.  Otherwise, SQLAlchemy may persist conflicting data to the underlying association table since it is represented by two conflicting mappings.  The Association Proxy pattern should be favored in the case where access to the underlying association data is only sometimes needed.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_selfreferential"></a>
    
    <div class="sectionL3">

    <h3>Adjacency List Relationships</h3>
    
    

<p>The <strong>adjacency list</strong> pattern is a common relational pattern whereby a table contains a foreign key reference to itself.  This is the most common and simple way to represent hierarchical data in flat tables.  The other way is the "nested sets" model, sometimes called "modified preorder".  Despite what many online articles say about modified preorder, the adjacency list model is probably the most appropriate pattern for the large majority of hierarchical storage needs, for reasons of concurrency, reduced complexity, and that modified preorder has little advantage over an application which can fully load subtrees into the application space.
</p>
<p>SQLAlchemy commonly refers to an adjacency list relation as a <strong>self-referential mapper</strong>.  In this example, we'll work with a single table called <code>treenodes</code> to represent a tree structure:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">nodes </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'treenodes.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>A graph such as the following:
</p>

    

    <div class="sliding_code">
        <pre>
root --+---> child1
       +---> child2 --+--> subchild1
       |              +--> subchild2
       +---> child3
</pre>
    </div>
<p>Would be represented with data such as:
</p>

    

    <div class="sliding_code">
        <pre>
id       parent_id     data
---      -------       ----
1        NULL          root
2        1             child1
3        1             child2
4        3             subchild1
5        3             subchild2
6        1             child3
</pre>
    </div>
<p>SQLAlchemy's <code>mapper()</code> configuration for a self-referential one-to-many relationship is exactly like a "normal" one-to-many relationship.  When SQLAlchemy encounters the foreign key relation from <code>treenodes</code> to <code>treenodes</code>, it assumes one-to-many unless told otherwise:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># entity class
</span><span class="python_keyword">class </span><span class="python_name">Node</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">nodes</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>To create a many-to-one relationship from child to parent, an extra indicator of the "remote side" is added, which contains the <code>Column</code> object or objects indicating the remote side of the relation:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">nodes</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'parent'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">nodes</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">])</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>And the bi-directional version combines both:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">nodes</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">remote_side</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">nodes</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">]))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>There are several examples included with SQLAlchemy illustrating self-referential strategies; these include <a href='http://www.sqlalchemy.org/trac/browser/sqlalchemy/trunk/examples/adjacencytree/basic_tree.py'>basic_tree.py</a> and <a href='http://www.sqlalchemy.org/trac/browser/sqlalchemy/trunk/examples/elementtree/optimized_al.py'>optimized_al.py</a>, the latter of which illustrates how to persist and search XML documents in conjunction with <a href='http://effbot.org/zone/element-index.htm'>ElementTree</a>.
</p>

    
    <A name="advdatamapping_relation_selfreferential_query"></a>
    
    <div class="sectionL4">

    <h3>Self-Referential Query Strategies</h3>
    
    
<p>Querying self-referential structures is done in the same way as any other query in SQLAlchemy, such as below, we query for any node whose <code>data</code> attribute stores the value <code>child2</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># get all nodes named 'child2'
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'child2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>On the subject of joins, i.e. those described in <a href="#datamapping_joins">Querying with Joins</a>, self-referential structures require the usage of aliases so that the same table can be referenced multiple times within the FROM clause of the query.   Aliasing can be done either manually using the <code>nodes</code> <code>Table</code> object as a source of aliases:
</p>

    

    <div class="code">
        <pre>
<span class="python_comment"># get all nodes named 'subchild1' with a parent named 'child2'
</span><span class="python_name">nodealias </span><span class="python_operator">= </span><span class="python_name">nodes</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_78', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'subchild1'</span><span class="python_enclosure">)</span><span class="python_operator">.\
    </span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">parent_id</span><span class="python_operator">==</span><span class="python_name">nodealias</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">, </span><span class="python_name">nodealias</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'child2'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_78_div" class="codepop" style="display:none;">SELECT treenodes.id AS treenodes_id, treenodes.parent_id AS treenodes_parent_id, treenodes.data AS treenodes_data<br/>
FROM treenodes, treenodes AS treenodes_1<br/>
WHERE treenodes.data = ? AND treenodes.parent_id = treenodes_1.id AND treenodes_1.data = ? ORDER BY treenodes.oid<br/>
['subchild1', 'child2']</div><pre><span class="python_operator"></span></pre>
    </div>
<p>or automatically, using <code>join()</code> with <code>aliased=True</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_comment"># get all nodes named 'subchild1' with a parent named 'child2'
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_79', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'subchild1'</span><span class="python_enclosure">)</span><span class="python_operator">.\
    </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">aliased</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'child2'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_79_div" class="codepop" style="display:none;">SELECT treenodes.id AS treenodes_id, treenodes.parent_id AS treenodes_parent_id, treenodes.data AS treenodes_data<br/>
FROM treenodes JOIN treenodes AS treenodes_1 ON treenodes_1.id = treenodes.parent_id<br/>
WHERE treenodes.data = ? AND treenodes_1.data = ? ORDER BY treenodes.oid<br/>
['subchild1', 'child2']</div><pre><span class="python_operator"></span></pre>
    </div>
<p>To add criterion to multiple points along a longer join, use <code>from_joinpoint=True</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_comment"># get all nodes named 'subchild1' with a parent named 'child2' and a grandparent 'root'
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_80', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'subchild1'</span><span class="python_enclosure">)</span><span class="python_operator">.\
    </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">aliased</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'child2'</span><span class="python_enclosure">)</span><span class="python_operator">.\
    </span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'parent'</span><span class="python_operator">, </span><span class="python_name">aliased</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">from_joinpoint</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">==</span><span class="python_literal">'root'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_80_div" class="codepop" style="display:none;">SELECT treenodes.id AS treenodes_id, treenodes.parent_id AS treenodes_parent_id, treenodes.data AS treenodes_data<br/>
FROM treenodes JOIN treenodes AS treenodes_1 ON treenodes_1.id = treenodes.parent_id JOIN treenodes AS treenodes_2 ON treenodes_2.id = treenodes_1.parent_id<br/>
WHERE treenodes.data = ? AND treenodes_1.data = ? AND treenodes_2.data = ? ORDER BY treenodes.oid<br/>
['subchild1', 'child2', 'root']</div><pre><span class="python_operator"></span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_selfreferential_eagerloading"></a>
    
    <div class="sectionL4">

    <h3>Configuring Eager Loading</h3>
    
    
<p>Eager loading of relations occurs using joins or outerjoins from parent to child table during a normal query operation, such that the parent and its child collection can be populated from a single SQL statement.  SQLAlchemy's eager loading uses aliased tables in all cases when joining to related items, so it is compatible with self-referential joining.  However, to use eager loading with a self-referential relation, SQLAlchemy needs to be told how many levels deep it should join; otherwise the eager load will not take place.  This depth setting is configured via <code>join_depth</code>:
</p>

    

    <div class="code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">nodes</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">join_depth</span><span class="python_operator">=</span><span class="python_number">2</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_81', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Node</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_81_div" class="codepop" style="display:none;">SELECT treenodes_1.id AS treenodes_1_id, treenodes_1.parent_id AS treenodes_1_parent_id, treenodes_1.data AS treenodes_1_data, treenodes_2.id AS treenodes_2_id, treenodes_2.parent_id AS treenodes_2_parent_id, treenodes_2.data AS treenodes_2_data, treenodes.id AS treenodes_id, treenodes.parent_id AS treenodes_parent_id, treenodes.data AS treenodes_data<br/>
FROM treenodes LEFT OUTER JOIN treenodes AS treenodes_2 ON treenodes.id = treenodes_2.parent_id LEFT OUTER JOIN treenodes AS treenodes_1 ON treenodes_2.id = treenodes_1.parent_id ORDER BY treenodes.oid, treenodes_2.oid, treenodes_1.oid<br/>
[]</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_customjoin"></a>
    
    <div class="sectionL3">

    <h3>Specifying Alternate Join Conditions to relation()</h3>
    
    

<p>The <code>relation()</code> function uses the foreign key relationship between the parent and child tables to formulate the <strong>primary join condition</strong> between parent and child; in the case of a many-to-many relationship it also formulates the <strong>secondary join condition</strong>.  If you are working with a <code>Table</code> which has no <code>ForeignKey</code> objects on it (which can be the case when using reflected tables with MySQL), or if the join condition cannot be expressed by a simple foreign key relationship, use the <code>primaryjoin</code> and possibly <code>secondaryjoin</code> conditions to create the appropriate relationship.
</p>
<p>In this example we create a relation <code>boston_addresses</code> which will only load the user addresses with a city of "Boston":
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Many to many relationships can be customized by one or both of <code>primaryjoin</code> and <code>secondaryjoin</code>, shown below with just the default many-to-many relationship explicitly set:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'keywords'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">,</span>
        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
        <span class="python_name">secondaryjoin</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span><span class="python_operator">==</span><span class="python_name">keywords_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword_id</span>
        <span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>

    
    <A name="advdatamapping_relation_customjoin_fks"></a>
    
    <div class="sectionL4">

    <h3>Specifying Foreign Keys</h3>
    
    
<p>When using <code>primaryjoin</code> and <code>secondaryjoin</code>, SQLAlchemy also needs to be aware of which columns in the relation reference the other.  In most cases, a <code>Table</code> construct will have <code>ForeignKey</code> constructs which take care of this; however, in the case of reflected tables on a database that does not report FKs (like MySQL ISAM) or when using join conditions on columns that don't have foreign keys, the <code>relation()</code> needs to be told specifically which columns are "foreign" using the <code>foreign_keys</code> collection:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">foreign_keys</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">])</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_customjoin_properties"></a>
    
    <div class="sectionL4">

    <h3>Building Query-Enabled Properties</h3>
    
    
<p>Very ambitious custom join conditions may fail to be directly persistable, and in some cases may not even load correctly.  To remove the persistence part of the equation, use the flag <code>viewonly=True</code> on the <code>relation()</code>, which establishes it as a read-only attribute (data written to the collection will be ignored on flush()).  However, in extreme cases, consider using a regular Python property in conjunction with <code>Query</code> as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">_get_addresses</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">with_parent</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_operator">...</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_customjoin_multiplejoin"></a>
    
    <div class="sectionL4">

    <h3>Multiple Relations against the Same Parent/Child</h3>
    
    
<p>Theres no restriction on how many times you can relate from parent to child.  SQLAlchemy can usually figure out what you want, particularly if the join conditions are straightforward.  Below we add a <code>newyork_addresses</code> attribute to complement the <code>boston_addresses</code> attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'boston_addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'Boston'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_literal">'newyork_addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span>
                <span class="python_name">and_</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">,</span>
                <span class="python_name">addresses_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">city</span><span class="python_operator">==</span><span class="python_literal">'New York'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_collections"></a>
    
    <div class="sectionL3">

    <h3>Alternate Collection Implementations</h3>
    
    

<p>Mapping a one-to-many or many-to-many relationship results in a collection of values accessible through an attribute on the parent instance.  By default, this collection is a <code>list</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_name">children </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">parent </span><span class="python_operator">= </span><span class="python_name">Parent</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">parent</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_name">parent</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>Collections are not limited to lists.  Sets, mutable sequences and almost any other Python object that can act as a container can be used in place of the default list.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># use a set
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_name">children </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">set</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">parent </span><span class="python_operator">= </span><span class="python_name">Parent</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">child </span><span class="python_operator">= </span><span class="python_name">Child</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">parent</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">child</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">assert </span><span class="python_name">child </span><span class="python_keyword">in </span><span class="python_name">parent</span><span class="python_operator">.</span><span class="python_name">children</span><span class="python_operator">
</span></pre>
    </div>

    
    <A name="advdatamapping_relation_collections_custom"></a>
    
    <div class="sectionL4">

    <h3>Custom Collection Implementations</h3>
    
    
<p>You can use your own types for collections as well.  For most cases, simply inherit from <code>list</code> or <code>set</code> and add the custom behavior.
</p>
<p>Collections in SQLAlchemy are transparently <em>instrumented</em>.  Instrumentation means that normal operations on the collection are tracked and result in changes being written to the database at flush time.  Additionally, collection operations can fire <em>events</em> which indicate some secondary operation must take place.  Examples of a secondary operation include saving the child item in the parent's <code>Session</code> (i.e. the <code>save-update</code> cascade), as well as synchronizing the state of a bi-directional relationship (i.e. a <code>backref</code>).
</p>
<p>The collections package understands the basic interface of lists, sets and dicts and will automatically apply instrumentation to those built-in types and their subclasses.  Object-derived types that implement a basic collection interface are detected and instrumented via duck-typing:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">ListLike</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data </span><span class="python_operator">= </span><span class="python_enclosure">[]</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">extend</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">items</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">extend</span><span class="python_enclosure">(</span><span class="python_name">items</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__iter__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">iter</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">foo</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">'foo'</span><span class="python_operator">
</span></pre>
    </div>
<p><code>append</code>, <code>remove</code>, and <code>extend</code> are known list-like methods, and will be instrumented automatically.  <code>__iter__</code> is not a mutator method and won't be instrumented, and <code>foo</code> won't be either.
</p>
<p>Duck-typing (i.e. guesswork) isn't rock-solid, of course, so you can be explicit about the interface you are implementing by providing an <code>__emulates__</code> class attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">SetLike</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__emulates__ </span><span class="python_operator">= </span><span class="python_name">set</span><span class="python_operator">
</span>
    <span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data </span><span class="python_operator">= </span><span class="python_name">set</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__iter__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">iter</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>This class looks list-like because of <code>append</code>, but <code>__emulates__</code> forces it to set-like.  <code>remove</code> is known to be part of the set interface and will be instrumented.
</p>
<p>But this class won't work quite yet: a little glue is needed to adapt it for use by SQLAlchemy.  The ORM needs to know which methods to use to append, remove and iterate over members of the collection.  When using a type like <code>list</code> or <code>set</code>, the appropriate methods are well-known and used automatically when present. This set-like class does not provide the expected <code>add</code> method, so we must supply an explicit mapping for the ORM via a decorator.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_collections_decorators"></a>
    
    <div class="sectionL4">

    <h3>Annotating Custom Collections via Decorators</h3>
    
    
<p>Decorators can be used to tag the individual methods the ORM needs to manage collections.  Use them when your class doesn't quite meet the regular interface for its container type, or you simply would like to use a different method to get the job done.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">collections </span><span class="python_keyword">import </span><span class="python_name">collection</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">SetLike</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__emulates__ </span><span class="python_operator">= </span><span class="python_name">set</span><span class="python_operator">
</span>
    <span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data </span><span class="python_operator">= </span><span class="python_name">set</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
    <span class="python_operator">@</span><span class="python_name">collection</span><span class="python_operator">.</span><span class="python_name">appender</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">__iter__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">iter</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">data</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>And that's all that's needed to complete the example.  SQLAlchemy will add instances via the <code>append</code> method.  <code>remove</code> and <code>__iter__</code> are the default methods for sets and will be used for removing and iteration.  Default methods can be changed as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">collections </span><span class="python_keyword">import </span><span class="python_name">collection</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyList</span><span class="python_enclosure">(</span><span class="python_name">list</span><span class="python_enclosure">)</span><span class="python_operator">:
    @</span><span class="python_name">collection</span><span class="python_operator">.</span><span class="python_name">remover</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">zark</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">item</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_comment"># do something special...
</span>
    <span class="python_operator">@</span><span class="python_name">collection</span><span class="python_operator">.</span><span class="python_name">iterator</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">hey_use_this_instead_for_iteration</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_comment"># ...
</span><span class="python_operator"></span></pre>
    </div>
<p>There is no requirement to be list-, or set-like at all.  Collection classes can be any shape, so long as they have the append, remove and iterate interface marked for SQLAlchemy's use.  Append and remove methods will be called with a mapped entity as the single argument, and iterator methods are called with no arguments and must return an iterator.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_collections_dictcollections"></a>
    
    <div class="sectionL4">

    <h3>Dictionary-Based Collections</h3>
    
    
<p>A <code>dict</code> can be used as a collection, but a keying strategy is needed to map entities loaded by the ORM to key, value pairs.  The <a href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections">collections</a> package provides several built-in types for dictionary-based collections:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">collections </span><span class="python_keyword">import </span><span class="python_name">column_mapped_collection</span><span class="python_operator">, </span><span class="python_name">attribute_mapped_collection</span><span class="python_operator">, </span><span class="python_name">mapped_collection</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_comment"># key by column</span>
    <span class="python_literal">'notes'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Note</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">column_mapped_collection</span><span class="python_enclosure">(</span><span class="python_name">notes_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_comment"># or named attribute</span>
    <span class="python_literal">'notes2'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Note</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">attribute_mapped_collection</span><span class="python_enclosure">(</span><span class="python_literal">'keyword'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_comment"># or any callable</span>
    <span class="python_literal">'notes3'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Note</span><span class="python_operator">, </span><span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">mapped_collection</span><span class="python_enclosure">(</span><span class="python_keyword">lambda </span><span class="python_name">entity</span><span class="python_operator">: </span><span class="python_name">entity</span><span class="python_operator">.</span><span class="python_name">a </span><span class="python_operator">+ </span><span class="python_name">entity</span><span class="python_operator">.</span><span class="python_name">b</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># ...
</span><span class="python_name">item </span><span class="python_operator">= </span><span class="python_name">Item</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">item</span><span class="python_operator">.</span><span class="python_name">notes</span><span class="python_enclosure">[</span><span class="python_literal">'color'</span><span class="python_enclosure">] </span><span class="python_operator">= </span><span class="python_name">Note</span><span class="python_enclosure">(</span><span class="python_literal">'color'</span><span class="python_operator">, </span><span class="python_literal">'blue'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_name">item</span><span class="python_operator">.</span><span class="python_name">notes</span><span class="python_enclosure">[</span><span class="python_literal">'color'</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>These functions each provide a <code>dict</code> subclass with decorated <code>set</code> and <code>remove</code> methods and the keying strategy of your choice.
</p>
<p>The <b>collections.MappedCollection</b> class can be used as a base class for your custom types or as a mix-in to quickly add <code>dict</code> collection support to other classes.  It uses a keying function to delegate to <code>__setitem__</code> and <code>__delitem__</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">util </span><span class="python_keyword">import </span><span class="python_name">OrderedDict</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">collections </span><span class="python_keyword">import </span><span class="python_name">MappedCollection</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">NodeMap</span><span class="python_enclosure">(</span><span class="python_name">OrderedDict</span><span class="python_operator">, </span><span class="python_name">MappedCollection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""Holds 'Node' objects, keyed by the 'name' attribute with insert order maintained."""</span><span class="python_operator">
</span>
    <span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kw</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">MappedCollection</span><span class="python_operator">.</span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">keyfunc</span><span class="python_operator">=</span><span class="python_keyword">lambda </span><span class="python_name">node</span><span class="python_operator">: </span><span class="python_name">node</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">OrderedDict</span><span class="python_operator">.</span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, *</span><span class="python_name">args</span><span class="python_operator">, **</span><span class="python_name">kw</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The ORM understands the <code>dict</code> interface just like lists and sets, and will automatically instrument all dict-like methods if you choose to subclass <code>dict</code> or provide dict-like collection behavior in a duck-typed class.  You must decorate appender and remover methods, however- there are no compatible methods in the basic dictionary interface for SQLAlchemy to use by default.  Iteration will go through <code>itervalues()</code> unless otherwise decorated.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_collections_adv_collections"></a>
    
    <div class="sectionL4">

    <h3>Instrumentation and Custom Types</h3>
    
    
<p>Many custom types and existing library classes can be used as a entity collection type as-is without further ado.  However, it is important to note that the instrumentation process <em>will</em> modify the type, adding decorators around methods automatically.
</p>
<p>The decorations are lightweight and no-op outside of relations, but they do add unneeded overhead when triggered elsewhere.  When using a library class as a collection, it can be good practice to use the "trivial subclass" trick to restrict the decorations to just your usage in relations.  For example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyAwesomeList</span><span class="python_enclosure">(</span><span class="python_name">some</span><span class="python_operator">.</span><span class="python_name">great</span><span class="python_operator">.</span><span class="python_name">library</span><span class="python_operator">.</span><span class="python_name">AwesomeList</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_comment"># ... relation(..., collection_class=MyAwesomeList)
</span><span class="python_operator"></span></pre>
    </div>
<p>The ORM uses this approach for built-ins, quietly substituting a trivial subclass when a <code>list</code>, <code>set</code> or <code>dict</code> is used directly.
</p>
<p>The collections package provides additional decorators and support for authoring custom types.  See the <a href="sqlalchemy_orm_collections.html#docstrings_sqlalchemy.orm.collections">package documentation</a> for more information and discussion of advanced usage and Python 2.3-compatible decoration options.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_strategies"></a>
    
    <div class="sectionL3">

    <h3>Configuring Loader Strategies: Lazy Loading, Eager Loading</h3>
    
    

<p>In the <a href="#datamapping">Object Relational Tutorial</a>, we introduced the concept of <strong>Eager Loading</strong>.  We used an <code>option</code> in conjunction with the <code>Query</code> object in order to indicate that a relation should be loaded at the same time as the parent, within a single SQL query:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_82', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'jack'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"> </span></pre><div id="popbox_82_div" class="codepop" style="display:none;">SELECT addresses_1.id AS addresses_1_id, addresses_1.email_address AS addresses_1_email_address,<br/>
addresses_1.user_id AS addresses_1_user_id, users.id AS users_id, users.name AS users_name,<br/>
users.fullname AS users_fullname, users.password AS users_password<br/>
FROM users LEFT OUTER JOIN addresses AS addresses_1 ON users.id = addresses_1.user_id<br/>
WHERE users.name = ? ORDER BY users.oid, addresses_1.oid<br/>
['jack']</div><pre><span class="python_operator"></span></pre>
    </div>
<p>By default, all relations are <strong>lazy loading</strong>.  The scalar or collection attribute associated with a <code>relation()</code> contains a trigger which fires the first time the attribute is accessed, which issues a SQL call at that point:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_83', 'show', 'hide')" class="codepoplink">sql</a>&gt;&gt;&gt; </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator"></span></pre><div id="popbox_83_div" class="codepop" style="display:none;">SELECT addresses.id AS addresses_id, addresses.email_address AS addresses_email_address, addresses.user_id AS addresses_user_id<br/>
FROM addresses<br/>
WHERE ? = addresses.user_id ORDER BY addresses.oid<br/>
[5]</div><pre><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">u'jack@google.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_literal">u'j25@yahoo.com'</span><span class="python_enclosure">)</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>The default <strong>loader strategy</strong> for any <code>relation()</code> is configured by the <code>lazy</code> keyword argument, which defaults to <code>True</code>.  Below we set it as <code>False</code> so that the <code>children</code> relation is eager loading:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># eager load 'children' attribute
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_operator">, </span><span class="python_name">parent_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Child</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>The loader strategy can be changed from lazy to eager as well as eager to lazy using the <code>eagerload()</code> and <code>lazyload()</code> query options:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># set children to load lazily
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">lazyload</span><span class="python_enclosure">(</span><span class="python_literal">'children'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># set children to load eagerly
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'children'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>To reference a relation that is deeper than one level, separate the names by periods:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Parent</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'foo.bar.bat'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>When using dot-separated names with <code>eagerload()</code>, option applies <strong>only</strong> to the actual attribute named, and <strong>not</strong> its ancestors.  For example, suppose a mapping from <code>A</code> to <code>B</code> to <code>C</code>, where the relations, named <code>atob</code> and <code>btoc</code>, are both lazy-loading.  A statement like the following:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">A</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'atob.btoc'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>will load only <code>A</code> objects to start.  When the <code>atob</code> attribute on each <code>A</code> is accessed, the returned <code>B</code> objects will <em>eagerly</em> load their <code>C</code> objects.
</p>
<p>Therefore, to modify the eager load to load both <code>atob</code> as well as <code>btoc</code>, place eagerloads for both:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">A</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'atob'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">eagerload</span><span class="python_enclosure">(</span><span class="python_literal">'atob.btoc'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>or more simply just use <code>eagerload_all()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">A</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">eagerload_all</span><span class="python_enclosure">(</span><span class="python_literal">'atob.btoc'</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>There are two other loader strategies available, <strong>dynamic loading</strong> and <strong>no loading</strong>; these are described in <a href="#advdatamapping_relation_largecollections">Working with Large Collections</a>.
</p>

    
    <A name="advdatamapping_relation_strategies_containseager"></a>
    
    <div class="sectionL4">

    <h3>Routing Explicit Joins/Statements into Eagerly Loaded Collections</h3>
    
    
<p>When full statement loads are used with <code>Query</code>, the user defined SQL is used verbatim and the <code>Query</code> does not play any role in generating it.  In this scenario, if eager loading is desired, the <code>Query</code> should be informed as to what collections should also be loaded from the result set.  Similarly, Queries which compile their statement in the usual way may also have user-defined joins built in which are synonymous with what eager loading would normally produce, and it improves performance to utilize those same JOINs for both purposes, instead of allowing the eager load mechanism to generate essentially the same JOIN redundantly.   Yet another use case for such a feature is a Query which returns instances with a filtered view of their collections loaded, in which case the default eager load mechanisms need to be bypassed.
</p>
<p>The single option <code>Query</code> provides to control this is the <code>contains_eager()</code> option, which specifies the path of a single relationship to be eagerly loaded.  Like all relation-oriented options, it takes a string or Python descriptor as an argument.  Below it's used with a <code>from_statement</code> load:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># mapping is the users-&gt;addresses mapping
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># define a query on USERS with an outer join to ADDRESSES
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses_table</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">apply_labels</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Query object which expects the "addresses" results
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># get results normally
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">from_statement</span><span class="python_enclosure">(</span><span class="python_name">statement</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>It works just as well with an inline <code>Query.join()</code> or <code>Query.outerjoin()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>If the "eager" portion of the statement is "aliased", the <code>alias</code> keyword argument to <code>contains_eager()</code> may be used to indicate it.  This is a string alias name or reference to an actual <code>Alias</code> object:
</p>

    

    <div class="code">
        <pre>
<span class="python_comment"># use an alias of the Address entity
</span><span class="python_name">adalias </span><span class="python_operator">= </span><span class="python_name">aliased</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># construct a Query object which expects the "addresses" results
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">((</span><span class="python_name">adalias</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">, </span><span class="python_name">alias</span><span class="python_operator">=</span><span class="python_name">adalias</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># get results normally
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_84', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_84_div" class="codepop" style="display:none;">SELECT users.user_id AS users_user_id, users.user_name AS users_user_name, adalias.address_id AS adalias_address_id,<br/>
adalias.user_id AS adalias_user_id, adalias.email_address AS adalias_email_address, (...other columns...)<br/>
FROM users LEFT OUTER JOIN email_addresses AS email_addresses_1 ON users.user_id = email_addresses_1.user_id</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The path given as the argument to <code>contains_eager()</code> needs to be a full path from the starting entity.  For example if we were loading <code>Users-&gt;orders-&gt;Order-&gt;items-&gt;Item</code>, the string version would look like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'orders'</span><span class="python_operator">, </span><span class="python_literal">'items'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The descriptor version like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">orders</span><span class="python_operator">, </span><span class="python_name">Order</span><span class="python_operator">.</span><span class="python_name">items</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>A variant on <code>contains_eager()</code> is the <code>contains_alias()</code> option, which is used in the rare case that the parent object is loaded from an alias within a user-defined SELECT statement:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># define an aliased UNION called 'ulist'
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">union</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">&gt;</span><span class="python_number">7</span><span class="python_enclosure">))</span><span class="python_operator">.</span><span class="python_name">alias</span><span class="python_enclosure">(</span><span class="python_literal">'ulist'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># add on an eager load of "addresses"
</span><span class="python_name">statement </span><span class="python_operator">= </span><span class="python_name">statement</span><span class="python_operator">.</span><span class="python_name">outerjoin</span><span class="python_enclosure">(</span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">apply_labels</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># create query, indicating "ulist" is an alias for the main table, "addresses" property should
# be eager loaded
</span><span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">options</span><span class="python_enclosure">(</span><span class="python_name">contains_alias</span><span class="python_enclosure">(</span><span class="python_literal">'ulist'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">contains_eager</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># results
</span><span class="python_name">r </span><span class="python_operator">= </span><span class="python_name">query</span><span class="python_operator">.</span><span class="python_name">from_statement</span><span class="python_enclosure">(</span><span class="python_name">statement</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_largecollections"></a>
    
    <div class="sectionL3">

    <h3>Working with Large Collections</h3>
    
    

<p>The default behavior of <code>relation()</code> is to fully load the collection of items in, as according to the loading strategy of the relation.  Additionally, the Session by default only knows how to delete objects which are actually present within the session.  When a parent instance is marked for deletion and flushed, the Session loads its full list of child items in so that they may either be deleted as well, or have their foreign key value set to null; this is to avoid constraint violations.  For large collections of child items, there are several strategies to bypass full loading of child items both at load time as well as deletion time.
</p>

    
    <A name="advdatamapping_relation_largecollections_dynamic"></a>
    
    <div class="sectionL4">

    <h3>Dynamic Relation Loaders</h3>
    
    
<p>The most useful by far is the <code>dynamic_loader()</code> relation.  This is a variant of <code>relation()</code> which returns a <code>Query</code> object in place of a collection when accessed.  <code>filter()</code> criterion may be applied as well as limits and offsets, either explicitly or via array slices:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'posts'</span><span class="python_operator">: </span><span class="python_name">dynamic_loader</span><span class="python_enclosure">(</span><span class="python_name">Post</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">jack </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># filter Jack's blog posts
</span><span class="python_name">posts </span><span class="python_operator">= </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Post</span><span class="python_operator">.</span><span class="python_name">headline</span><span class="python_operator">==</span><span class="python_literal">'this is a post'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># apply array slices
</span><span class="python_name">posts </span><span class="python_operator">= </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_enclosure">[</span><span class="python_number">5</span><span class="python_operator">:</span><span class="python_number">20</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>The dynamic relation supports limited write operations, via the <code>append()</code> and <code>remove()</code> methods.  Since the read side of the dynamic relation always queries the database, changes to the underlying collection will not be visible until the data has been flushed:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">oldpost </span><span class="python_operator">= </span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">Post</span><span class="python_operator">.</span><span class="python_name">headline</span><span class="python_operator">==</span><span class="python_literal">'old post'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">one</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">(</span><span class="python_name">oldpost</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">jack</span><span class="python_operator">.</span><span class="python_name">posts</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Post</span><span class="python_enclosure">(</span><span class="python_literal">'new post'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>To place a dynamic relation on a backref, use <code>lazy='dynamic'</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Post</span><span class="python_operator">, </span><span class="python_name">posts_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_name">backref</span><span class="python_enclosure">(</span><span class="python_literal">'posts'</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_literal">'dynamic'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that eager/lazy loading options cannot be used in conjunction dynamic relations at this time.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_largecollections_noload"></a>
    
    <div class="sectionL4">

    <h3>Setting Noload</h3>
    
    
<p>The opposite of the dynamic relation is simply "noload", specified using <code>lazy=None</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">lazy</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the <code>children</code> collection is fully writeable, and changes to it will be persisted to the database as well as locally available for reading at the time they are added.  However when instances of  <code>MyClass</code> are freshly loaded from the database, the <code>children</code> collection stays empty.
</p>


            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>



    
    <A name="advdatamapping_relation_largecollections_passivedelete"></a>
    
    <div class="sectionL4">

    <h3>Using Passive Deletes</h3>
    
    
<p>Use <code>passive_deletes=True</code> to disable child object loading on a DELETE operation, in conjunction with "ON DELETE (CASCADE|SET NULL)" on your database to automatically cascade deletes to child objects.   Note that "ON DELETE" is not supported on SQLite, and requires <code>InnoDB</code> tables when using MySQL:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">myothertable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'myothertable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'parent_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'parent_id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'mytable.id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">myothertable</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'children'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">MyOtherClass</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_operator">, </span><span class="python_name">passive_deletes</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>When <code>passive_deletes</code> is applied, the <code>children</code> relation will not be loaded into memory when an instance of <code>MyClass</code> is marked for deletion.  The <code>cascade=&quot;all, delete-orphan&quot;</code> <em>will</em> take effect for instances of <code>MyOtherClass</code> which are currently present in the session; however for instances of <code>MyOtherClass</code> which are not loaded, SQLAlchemy assumes that "ON DELETE CASCADE" rules will ensure that those rows are deleted by the database and that no foreign key violation will occur.
</p>



            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="advdatamapping_relation_mutablepks"></a>
    
    <div class="sectionL3">

    <h3>Mutable Primary Keys / Update Cascades</h3>
    
    

<p>As of SQLAlchemy 0.4.2, the primary key attributes of an instance can be changed freely, and will be persisted upon flush.  When the primary key of an entity changes, related items which reference the primary key must also be updated as well.  For databases which enforce referential integrity, it's required to use the database's ON UPDATE CASCADE functionality in order to propagate primary key changes.  For those which don't, the <code>passive_cascades</code> flag can be set to <code>False</code> which instructs SQLAlchemy to issue UPDATE statements individually.  The <code>passive_cascades</code> flag can also be <code>False</code> in conjunction with ON UPDATE CASCADE functionality, although in that case it issues UPDATE statements unnecessarily.
</p>
<p>A typical mutable primary key setup might look like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'fullname'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'username'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.username'</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_literal">"cascade"</span><span class="python_enclosure">)))</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">passive_updates</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">addresses</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>passive_updates is set to <code>True</code> by default.  Foreign key references to non-primary key columns are supported as well.
</p>




            <a href="#advdatamapping" class="totoc">back to section top</a>
    </div>




    </div>




    </div>



    
    
    <A name="unitofwork"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#advdatamapping">Mapper Configuration</a>

               |   
            Next: <a href="#dbengine">Database Engines</a>
    </div>

        <h2>Using the Session</h2>
    </div>


        








    
    <A name="unitofwork"></a>
    
    <div class="sectionL1">

    
    

<p>The <a href="#advdatamapping">Mapper</a> is the entrypoint to the configurational API of the SQLAlchemy object relational mapper.  But the primary object one works with when using the ORM is the <a href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_Session">Session</a>.
</p>


    
    <A name="unitofwork_what"></a>
    
    <div class="sectionL2">

    <h3>What does the Session do ?</h3>
    
    

<p>In the most general sense, the <code>Session</code> establishes all conversations with the database and represents a "holding zone" for all the mapped instances which you've loaded or created during its lifespan.  It implements the <a href='http://martinfowler.com/eaaCatalog/unitOfWork.html'>Unit of Work</a> pattern, which means it keeps track of all changes which occur, and is capable of <strong>flushing</strong> those changes to the database as appropriate.   Another important facet of the <code>Session</code> is that it's also maintaining <strong>unique</strong> copies of each instance, where "unique" means "only one object with a particular primary key" - this pattern is called the <a href='http://martinfowler.com/eaaCatalog/identityMap.html'>Identity Map</a>.
</p>
<p>Beyond that, the <code>Session</code> implements an interface which lets you move objects in or out of the session in a variety of ways, it provides the entryway to a <code>Query</code> object which is used to query the database for data, and it also provides a transactional context for SQL operations which rides on top of the transactional capabilities of <code>Engine</code> and <code>Connection</code> objects.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_getting"></a>
    
    <div class="sectionL2">

    <h3>Getting a Session</h3>
    
    

<p><code>Session</code> is a regular Python class which can be directly instantiated.  However, to standardize how sessions are configured and acquired, the <code>sessionmaker()</code> function is normally used to create a top level <code>Session</code> configuration which can then be used throughout an application without the need to repeat the configurational arguments.
</p>


    
    <A name="unitofwork_getting_sessionmaker"></a>
    
    <div class="sectionL3">

    <h3>Using a sessionmaker() Configuration</h3>
    
    

<p>The usage of <code>sessionmaker()</code> is illustrated below:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">sessionmaker</span><span class="python_operator">
</span>
<span class="python_comment"># create a configured "Session" class
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">some_engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># work with sess
</span><span class="python_name">myobject </span><span class="python_operator">= </span><span class="python_name">MyObject</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_literal">'bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">myobject</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># close when finished
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the <code>sessionmaker</code> call creates a class for us, which we assign to the name <code>Session</code>.  This class is a subclass of the actual <code>sqlalchemy.orm.session.Session</code> class, which will instantiate with a particular bound engine.
</p>
<p>When you write your application, place the call to <code>sessionmaker()</code> somewhere global, and then make your new <code>Session</code> class available to the rest of your application.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_getting_binding"></a>
    
    <div class="sectionL3">

    <h3>Binding Session to an Engine</h3>
    
    

<p>In our previous example regarding <code>sessionmaker()</code>, we specified a <code>bind</code> for a particular <code>Engine</code>.  If we'd like to construct a <code>sessionmaker()</code> without an engine available and bind it later on, or to specify other options to an existing <code>sessionmaker()</code>, we may use the <code>configure()</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># configure Session class with desired options
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># later, we create the engine
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://...'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># associate it with our custom Session class
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">configure</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># work with the session
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>It's actually entirely optional to bind a Session to an engine.  If the underlying mapped <code>Table</code> objects use "bound" metadata, the <code>Session</code> will make use of the bound engine instead (or will even use multiple engines if multiple binds are present within the mapped tables).  "Bound" metadata is described at <a href="#metadata_tables_binding">Binding MetaData to an Engine or Connection</a>.
</p>
<p>The <code>Session</code> also has the ability to be bound to multiple engines explicitly.   Descriptions of these scenarios are described in <a href="#unitofwork_partitioning">Partitioning Strategies</a>.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_getting_connection"></a>
    
    <div class="sectionL3">

    <h3>Binding Session to a Connection</h3>
    
    

<p>The <code>Session</code> can also be explicitly bound to an individual database <code>Connection</code>.  Reasons for doing this may include to join a <code>Session</code> with an ongoing transaction local to a specific <code>Connection</code> object, or to bypass connection pooling by just having connections persistently checked out and associated with distinct, long running sessions:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># global application scope.  create Session class, engine
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://...'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator">...
</span>
<span class="python_comment"># local scope, such as within a controller function
</span>
<span class="python_comment"># connect to the database
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># bind an individual Session to the connection
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_getting_createsession"></a>
    
    <div class="sectionL3">

    <h3>Using create_session()</h3>
    
    

<p>As an alternative to <code>sessionmaker()</code>, <code>create_session()</code> is a function which calls the normal <code>Session</code> constructor directly.  All arguments are passed through and the new <code>Session</code> object is returned:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">myengine</span><span class="python_operator">, </span><span class="python_name">autocommit</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">autoflush</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_getting_configuration"></a>
    
    <div class="sectionL3">

    <h3>Configurational Arguments</h3>
    
    

<p>Configurational arguments accepted by <code>sessionmaker()</code> and <code>create_session()</code> are the same as that of the <code>Session</code> class itself, and are described at <a href="#docstrings_sqlalchemy.orm_modfunc_sessionmaker">sessionmaker()</a>.
</p>
<p>Note that the defaults of <code>create_session()</code> are the opposite of that of <code>sessionmaker()</code>: autoflush and expire_on_commit are False, autocommit is True. It is recommended to use the <code>sessionmaker()</code> function instead of <code>create_session()</code>. <code>create_session()</code> is used to get a session with no automation turned on and is useful for testing.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_using"></a>
    
    <div class="sectionL2">

    <h3>Using the Session</h3>
    
    



    
    <A name="unitofwork_using_states"></a>
    
    <div class="sectionL3">

    <h3>Quickie Intro to Object States</h3>
    
    

<p>It's helpful to know the states which an instance can have within a session:
</p>
<ul>
 <li><p><em>Transient</em> - an instance that's not in a session, and is not saved to the database; i.e. it has no database identity.  The only relationship such an object has to the ORM is that its class has a <code>mapper()</code> associated with it.
</p>

 </li>

 <li><p><em>Pending</em> - when you <code>add()</code> a transient instance, it becomes pending.  It still wasn't actually flushed to the database yet, but it will be when the next flush occurs.
</p>

 </li>

 <li><p><em>Persistent</em> - An instance which is present in the session and has a record in the database.  You get persistent instances by either flushing so that the pending instances become persistent, or by querying the database for existing instances (or moving persistent instances from other sessions into your local session).
</p>

 </li>

 <li><p><em>Detached</em> - an instance which has a record in the database, but is not in any session.  There's nothing wrong with this, and you can use objects normally when they're detached, <strong>except</strong> they will not be able to issue any SQL in order to load collections or attributes which are not yet loaded, or were marked as "expired".
</p>

 </li>
</ul>
<p>Knowing these states is important, since the <code>Session</code> tries to be strict about ambiguous operations (such as trying to save the same object to two different sessions at the same time).
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_faq"></a>
    
    <div class="sectionL3">

    <h3>Frequently Asked Questions</h3>
    
    

<ul>
 <li><p>When do I make a <code>sessionmaker</code> ?
</p>
<p>Just one time, somewhere in your application's global scope.  It should be looked upon as part of your application's configuration.  If your application has three .py files in a package, you could, for example, place the <code>sessionmaker</code> line in your <code>__init__.py</code> file; from that point on your other modules say "from mypackage import Session".   That way, everyone else just uses <code>Session()</code>, and the configuration of that session is controlled by that central point.
</p>
<p>If your application starts up, does imports, but does not know what database it's going to be connecting to, you can bind the <code>Session</code> at the "class" level to the engine later on, using <code>configure()</code>.
</p>
<p>In the examples in this section, we will frequently show the <code>sessionmaker</code> being created right above the line where we actually invoke <code>Session()</code>.  But that's just for example's sake !  In reality, the <code>sessionmaker</code> would be somewhere at the module level, and your individual <code>Session()</code> calls would be sprinkled all throughout your app, such as in a web application within each controller method.
</p>

 </li>

 <li><p>When do I make a <code>Session</code> ? 
</p>
<p>You typically invoke <code>Session()</code> when you first need to talk to your database, and want to save some objects or load some existing ones.  Then, you work with it, save your changes, and then dispose of it....or at the very least <code>close()</code> it.  It's not a "global" kind of object, and should be handled more like a "local variable", as it's generally <strong>not</strong> safe to use with concurrent threads.  Sessions are very inexpensive to make, and don't use any resources whatsoever until they are first used...so create some !
</p>
<p>There is also a pattern whereby you're using a <strong>contextual session</strong>, this is described later in <a href="#unitofwork_contextual">Contextual/Thread-local Sessions</a>.  In this pattern, a helper object is maintaining a <code>Session</code> for you, most commonly one that is local to the current thread (and sometimes also local to an application instance).  SQLAlchemy has worked this pattern out such that it still <em>looks</em> like you're creating a new session as you need one...so in that case, it's still a guaranteed win to just say <code>Session()</code> whenever you want a session.  
</p>

 </li>

 <li><p>Is the Session a cache ? 
</p>
<p>Yeee...no.  It's somewhat used as a cache, in that it implements the identity map pattern, and stores objects keyed to their primary key.  However, it doesn't do any kind of query caching.  This means, if you say <code>session.query(Foo).filter_by(name='bar')</code>, even if <code>Foo(name='bar')</code> is right there, in the identity map, the session has no idea about that.  It has to issue SQL to the database, get the rows back, and then when it sees the primary key in the row, <em>then</em> it can look in the local identity map and see that the object is already there.  It's only when you say <code>query.get({some primary key})</code> that the <code>Session</code> doesn't have to issue a query.
</p>
<p>Additionally, the Session stores object instances using a weak reference by default.  This also defeats the purpose of using the Session as a cache, unless the <code>weak_identity_map</code> flag is set to <code>False</code>.
</p>
<p>The <code>Session</code> is not designed to be a global object from which everyone consults as a "registry" of objects.  That is the job of a <strong>second level cache</strong>.  A good library for implementing second level caching is <a href='http://www.danga.com/memcached/'>Memcached</a>.  It <em>is</em> possible to "sort of" use the <code>Session</code> in this manner, if you set it to be non-transactional and it never flushes any SQL, but it's not a terrific solution,  since if concurrent threads load the same objects at the same time, you may have multiple copies of the same objects present in collections.
</p>

 </li>

 <li><p>How can I get the <code>Session</code> for a certain object ?
</p>
<p>Use the <code>object_session()</code> classmethod available on <code>Session</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">object_session</span><span class="python_enclosure">(</span><span class="python_name">someobject</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>

 </li>

 <li><p>Is the session threadsafe ?
</p>
<p>Nope.  It has no thread synchronization of any kind built in, and particularly when you do a flush operation, it definitely is not open to concurrent threads accessing it, because it holds onto a single database connection at that point.  If you use a session which is non-transactional for read operations only, it's still not thread-"safe", but you also wont get any catastrophic failures either, since it opens and closes connections on an as-needed basis; it's just that different threads might load the same objects independently of each other, but only one will wind up in the identity map (however, the other one might still live in a collection somewhere).
</p>
<p>But the bigger point here is, you should not <em>want</em> to use the session with multiple concurrent threads.  That would be like having everyone at a restaurant all eat from the same plate.  The session is a local "workspace" that you use for a specific set of tasks; you don't want to, or need to, share that session with other threads who are doing some other task.  If, on the other hand, there are other threads  participating in the same task you are, such as in a desktop graphical application, then you would be sharing the session with those threads, but you also will have implemented a proper locking scheme (or your graphical framework does) so that those threads do not collide.
     <br></br>
</p>

 </li>
</ul>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_querying"></a>
    
    <div class="sectionL3">

    <h3>Querying</h3>
    
    

<p>The <code>query()</code> function takes one or more <em>entities</em> and returns a new <code>Query</code> object which will issue mapper queries within the context of this Session.  An entity is defined as a mapped class, a <code>Mapper</code> object, an orm-enabled <em>descriptor</em>, or an <code>AliasedClass</code> object.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># query from a class
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># query with multiple classes, returns tuples
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">Address</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">join</span><span class="python_enclosure">(</span><span class="python_literal">'addresses'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter_by</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># query using orm-enabled descriptors
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">, </span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">fullname</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># query from a mapper
</span><span class="python_name">user_mapper </span><span class="python_operator">= </span><span class="python_name">class_mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">user_mapper</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>When <code>Query</code> returns results, each object instantiated is stored within the identity map.   When a row matches an object which is already present, the same object is returned.  In the latter case, whether or not the row is populated onto an existing object depends upon whether the attributes of the instance have been <em>expired</em> or not.  As of 0.5, a default-configured <code>Session</code> automatically expires all instances along transaction boundaries, so that with a normally isolated transaction, there shouldn't be any issue of instances representing data which is stale with regards to the current transaction.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_adding"></a>
    
    <div class="sectionL3">

    <h3>Adding New or Existing Items</h3>
    
    

<p><code>add()</code> is used to place instances in the session.  For <em>transient</em> (i.e. brand new) instances, this will have the effect of an INSERT taking place for those instances upon the next flush.  For instances which are <em>persistent</em> (i.e. were loaded by this session), they are already present and do not need to be added.  Instances which are <em>detached</em> (i.e. have been removed from a session) may be re-associated with a session using this method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">user1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'user2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">user1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">user2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()     </span><span class="python_comment"># write changes to the database</span><span class="python_operator">
</span></pre>
    </div>
<p>To add a list of items to the session at once, use <code>add_all()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add_all</span><span class="python_enclosure">([</span><span class="python_name">item1</span><span class="python_operator">, </span><span class="python_name">item2</span><span class="python_operator">, </span><span class="python_name">item3</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>add()</code> operation <strong>cascades</strong> along the <code>save-update</code> cascade.  For more details see the section <a href="#unitofwork_cascades">Cascades</a>.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_merging"></a>
    
    <div class="sectionL3">

    <h3>Merging</h3>
    
    

<p><code>merge()</code> reconciles the current state of an instance and its associated children with existing data in the database, and returns a copy of the instance associated with the session.  Usage is as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">merged_object </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">merge</span><span class="python_enclosure">(</span><span class="python_name">existing_object</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>When given an instance, it follows these steps:
</p>
<ul>
 <li>
     It examines the primary key of the instance.  If it's present, it attempts to load an instance with that primary key (or pulls from the local identity map).
 </li>

 <li>
     If there's no primary key on the given instance, or the given primary key does not exist in the database, a new instance is created.
 </li>

 <li>
     The state of the given instance is then copied onto the located/newly created instance.
 </li>

 <li>
     The operation is cascaded to associated child items along the <code>merge</code> cascade.  Note that all changes present on the given instance, including changes to collections, are merged.
 </li>

 <li>
     The new instance is returned.
 </li>
</ul>
<p>With <code>merge()</code>, the given instance is not placed within the session, and can be associated with a different session or detached.  <code>merge()</code> is very useful for taking the state of any kind of object structure without regard for its origins or current session associations and placing that state within a session.   Here's two examples:
</p>
<ul>
 <li>
     An application which reads an object structure from a file and wishes to save it to the database might parse the file, build up the structure, and then use <code>merge()</code> to save it to the database, ensuring that the data within the file is used to formulate the primary key of each element of the structure.  Later, when the file has changed, the same process can be re-run, producing a slightly different object structure, which can then be <code>merged()</code> in again, and the <code>Session</code> will automatically update the database to reflect those changes.
 </li>

 <li>
     A web application stores mapped entities within an HTTP session object.  When each request starts up, the serialized data can be merged into the session, so that the original entity may be safely shared among requests and threads.
 </li>
</ul>
<p><code>merge()</code> is frequently used by applications which implement their own second level caches.  This refers to an application which uses an in memory dictionary, or an tool like Memcached to store objects over long running spans of time.  When such an object needs to exist within a <code>Session</code>, <code>merge()</code> is a good choice since it leaves the original cached object untouched.  For this use case, merge provides a keyword option called <code>dont_load=True</code>.  When this boolean flag is set to <code>True</code>, <code>merge()</code> will not issue any SQL to reconcile the given object against the current state of the database, thereby reducing query overhead.   The limitation is that the given object and all of its children may not contain any pending changes, and it's also of course possible that newer information in the database will not be present on the merged object, since no load is issued.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_deleting"></a>
    
    <div class="sectionL3">

    <h3>Deleting</h3>
    
    

<p>The <code>delete</code> method places an instance into the Session's list of objects to be marked as deleted:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># mark two objects to be deleted
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># commit (or flush)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The big gotcha with <code>delete()</code> is that <strong>nothing is removed from collections</strong>.  Such as, if a <code>User</code> has a collection of three <code>Addresses</code>, deleting an <code>Address</code> will not remove it from <code>user.addresses</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">address </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">delete</span><span class="python_enclosure">(</span><span class="python_name">address</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">address </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span></pre>
    </div>
<p>The solution is to use proper cascading:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'addresses'</span><span class="python_operator">:</span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete, delete-orphan"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_keyword">del </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">addresses</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_flushing"></a>
    
    <div class="sectionL3">

    <h3>Flushing</h3>
    
    

<p>When the <code>Session</code> is used with its default configuration, the flush step is nearly always done transparently.  Specifically, the flush occurs before any individual <code>Query</code> is issued, as well as within the <code>commit()</code> call before the transaction is committed.  It also occurs before a SAVEPOINT is issued when <code>begin_nested()</code> is used.  The "flush-on-Query" aspect of the behavior can be disabled by constructing <code>sessionmaker()</code> with the flag <code>autoflush=False</code>.
</p>
<p>Regardless of the autoflush setting, a flush can always be forced by issuing <code>flush()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p><code>flush()</code> also supports the ability to flush a subset of objects which are present in the session, by passing a list of objects:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># saves only user1 and address2.  all other modified
# objects remain present in the session.
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">flush</span><span class="python_enclosure">([</span><span class="python_name">user1</span><span class="python_operator">, </span><span class="python_name">address2</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>This second form of flush should be used carefully as it currently does not cascade, meaning that it will not necessarily affect other objects directly associated with the objects given.
</p>
<p>The flush process <em>always</em> occurs within a transaction, even if the <code>Session</code> has been configured with <code>autocommit=True</code>, a setting that disables the session's persistent transactional state.  If no transaction is present, <code>flush()</code> creates its own transaction and commits it.  Any failures during flush will always result in a rollback of whatever transaction is present.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_committing"></a>
    
    <div class="sectionL3">

    <h3>Committing</h3>
    
    

<p><code>commit()</code> is used to commit the current transaction.  It always issues <code>flush()</code> beforehand to flush any remaining state to the database; this is independent of the "autoflush" setting.   If no transaction is present, it raises an error.  Note that the default behavior of the <code>Session</code> is that a transaction is always present; this behavior can be disabled by setting <code>autocommit=True</code>.  In autocommit mode, a transaction can be initiated by calling the <code>begin()</code> method.
</p>
<p>Another behavior of <code>commit()</code> is that by default it expires the state of all instances present after the commit is complete.  This is so that when the instances are next accessed, either through attribute access or by them being present in a <code>Query</code> result set, they receive the most recent state.  To disable this behavior, configure <code>sessionmaker()</code> with <code>expire_on_commit=False</code>.
</p>
<p>Normally, instances loaded into the <code>Session</code> are never changed by subsequent queries; the assumption is that the current transaction is isolated so the state most recently loaded is correct as long as the transaction continues.  Setting <code>autocommit=True</code> works against this model to some degree since the <code>Session</code> behaves in exactly the same way with regard to attribute state, except no transaction is present.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_rolling"></a>
    
    <div class="sectionL3">

    <h3>Rolling Back</h3>
    
    

<p><code>rollback()</code> rolls back the current transaction.   With a default configured session, the post-rollback state of the session is as follows:
</p>
<ul>
 <li>
     All connections are rolled back and returned to the connection pool, unless the Session was bound directly to 
       a Connection, in which case the connection is still maintained (but still rolled back).
 </li>

 <li>
     Objects which were initially in the <em>pending</em> state when they were added to the <code>Session</code> within the lifespan of the transaction are expunged, corresponding to their INSERT statement being rolled back.  The state of their attributes remains unchanged.
 </li>

 <li>
     Objects which were marked as <em>deleted</em> within the lifespan of the transaction are promoted back to the <em>persistent</em> state, corresponding to their DELETE statement being rolled back.  Note that if those objects were first <em>pending</em> within the transaction, that operation takes precedence instead.
 </li>

 <li>
     All objects not expunged are fully expired.  <br></br>
 </li>
</ul>
<p>With that state understood, the <code>Session</code> may safely continue usage after a rollback occurs (note that this is a new feature as of version 0.5).
</p>
<p>When a <code>flush()</code> fails, typically for reasons like primary key, foreign key, or "not nullable" constraint violations, a <code>rollback()</code> is issued automatically (it's currently not possible for a flush to continue after a partial failure).  However, the flush process always uses its own transactional demarcator called a <em>subtransaction</em>, which is described more fully in the docstrings for <code>Session</code>.  What it means here is that even though the database transaction has been rolled back, the end user must still issue <code>rollback()</code> to fully reset the state of the <code>Session</code>.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_expunging"></a>
    
    <div class="sectionL3">

    <h3>Expunging</h3>
    
    

<p>Expunge removes an object from the Session, sending persistent instances to the detached state, and pending instances to the transient state:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expunge</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>To remove all items, call <code>session.expunge_all()</code> (this method was formerly known as <code>clear()</code>).
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_closing"></a>
    
    <div class="sectionL3">

    <h3>Closing</h3>
    
    

<p>The <code>close()</code> method issues a <code>expunge_all()</code>, and releases any transactional/connection resources.  When connections are returned to the connection pool, transactional state is rolled back as well.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_refreshing"></a>
    
    <div class="sectionL3">

    <h3>Refreshing / Expiring</h3>
    
    

<p>To assist with the Session's "sticky" behavior of instances which are present, individual objects can have all of their attributes immediately re-loaded from the database, or marked as "expired" which will cause a re-load to occur upon the next access of any of the object's mapped attributes.  This includes all relationships, so lazy-loaders will be re-initialized, eager relationships will be repopulated.  Any changes marked on the object are discarded:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># immediately re-load attributes on obj1, obj2
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># expire objects obj1, obj2, attributes will be reloaded
# on the next access:
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p><code>refresh()</code> and <code>expire()</code> also support being passed a list of individual attribute names in which to be refreshed.  These names can reference any attribute, column-based or relation based:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># immediately re-load the attributes 'hello', 'world' on obj1, obj2
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'hello'</span><span class="python_operator">, </span><span class="python_literal">'world'</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">refresh</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'hello'</span><span class="python_operator">, </span><span class="python_literal">'world'</span><span class="python_enclosure">])</span><span class="python_operator">
</span>
<span class="python_comment"># expire the attributes 'hello', 'world' objects obj1, obj2, attributes will be reloaded
# on the next access:
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj1</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'hello'</span><span class="python_operator">, </span><span class="python_literal">'world'</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire</span><span class="python_enclosure">(</span><span class="python_name">obj2</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'hello'</span><span class="python_operator">, </span><span class="python_literal">'world'</span><span class="python_enclosure">])</span><span class="python_operator">
</span></pre>
    </div>
<p>The full contents of the session may be expired at once using <code>expire_all()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">expire_all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p><code>refresh()</code> and <code>expire()</code> are usually not needed when working with a default-configured <code>Session</code>.  The usual need is when an UPDATE or DELETE has been issued manually within the transaction using <code>Session.execute()</code>.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_using_attributes"></a>
    
    <div class="sectionL3">

    <h3>Session Attributes</h3>
    
    

<p>The <code>Session</code> itself acts somewhat like a set-like collection.  All items present may be accessed using the iterator interface:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">for </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">obj</span><span class="python_operator">
</span></pre>
    </div>
<p>And presence may be tested for using regular "contains" semantics:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">if </span><span class="python_name">obj </span><span class="python_keyword">in </span><span class="python_name">session</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"Object is present"</span><span class="python_operator">
</span></pre>
    </div>
<p>The session is also keeping track of all newly created (i.e. pending) objects, all objects which have had changes since they were last loaded or saved (i.e. "dirty"), and everything that's been marked as deleted.  <br></br>
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># pending objects recently added to the Session
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">new</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects which currently have changes detected
# (this collection is now created on the fly each time the property is called)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">dirty</span><span class="python_operator">
</span>
<span class="python_comment"># persistent objects that have been marked as deleted via session.delete(obj)
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">deleted</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that objects within the session are by default <em>weakly referenced</em>.  This means that when they are dereferenced in the outside application, they fall out of scope from within the <code>Session</code> as well and are subject to garbage collection by the Python interpreter.  The exceptions to this include objects which are pending, objects which are marked as deleted, or persistent objects which have pending changes on them.  After a full flush, these collections are all empty, and all objects are again weakly referenced.  To disable the weak referencing behavior and force all objects within the session to remain until explicitly expunged, configure <code>sessionmaker()</code> with the <code>weak_identity_map=False</code> setting.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_cascades"></a>
    
    <div class="sectionL2">

    <h3>Cascades</h3>
    
    

<p>Mappers support the concept of configurable <em>cascade</em> behavior on <code>relation()</code>s.  This behavior controls how the Session should treat the instances that have a parent-child relationship with another instance that is operated upon by the Session.  Cascade is indicated as a comma-separated list of string keywords, with the possible values <code>all</code>, <code>delete</code>, <code>save-update</code>, <code>refresh-expire</code>, <code>merge</code>, <code>expunge</code>, and <code>delete-orphan</code>.
</p>
<p>Cascading is configured by setting the <code>cascade</code> keyword argument on a <code>relation()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Order</span><span class="python_operator">, </span><span class="python_name">order_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'items' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_operator">, </span><span class="python_name">items_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"all, delete-orphan"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'customer' </span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">user_orders_table</span><span class="python_operator">, </span><span class="python_name">cascade</span><span class="python_operator">=</span><span class="python_literal">"save-update"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>The above mapper specifies two relations, <code>items</code> and <code>customer</code>.  The <code>items</code> relationship specifies "all, delete-orphan" as its <code>cascade</code> value, indicating that all  <code>add</code>, <code>merge</code>, <code>expunge</code>, <code>refresh</code> <code>delete</code> and <code>expire</code> operations performed on a parent <code>Order</code> instance should also be performed on the child <code>Item</code> instances attached to it.  The <code>delete-orphan</code> cascade value additionally indicates that if an <code>Item</code> instance is no longer associated with an <code>Order</code>, it should also be deleted.  The "all, delete-orphan" cascade argument allows a so-called <em>lifecycle</em> relationship between an <code>Order</code> and an <code>Item</code> object.
</p>
<p>The <code>customer</code> relationship specifies only the "save-update" cascade value, indicating most operations will not be cascaded from a parent <code>Order</code> instance to a child <code>User</code> instance except for the <code>add()</code> operation.  "save-update" cascade indicates that an <code>add()</code> on the parent will cascade to all child items, and also that items added to a parent which is already present in the session will also be added.
</p>
<p>The default value for <code>cascade</code> on <code>relation()</code>s is <code>save-update, merge</code>.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_managing"></a>
    
    <div class="sectionL2">

    <h3>Managing Transactions</h3>
    
    

<p>The <code>Session</code> manages transactions across all engines associated with it.  As the <code>Session</code> receives requests to execute SQL statements using a particular <code>Engine</code> or <code>Connection</code>, it adds each individual <code>Engine</code> encountered to its transactional state and maintains an open connection for each one (note that a simple application normally has just one <code>Engine</code>).  At commit time, all unflushed data is flushed, and each individual transaction is committed.  If the underlying databases support two-phase semantics, this may be used by the Session as well if two-phase transactions are enabled.
</p>
<p>Normal operation ends the transactional state using the <code>rollback()</code> or <code>commit()</code> methods.  After either is called, the <code>Session</code> starts a new transaction.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator">
</span>
    <span class="python_comment"># commit- will immediately go into a new transaction afterwards
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_comment"># rollback - will immediately go into a new transaction afterwards.
</span><span class="python_operator">    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>A session which is configured with <code>autocommit=True</code> may be placed into a transaction using <code>begin()</code>.  With an <code>autocommit=True</code> session that's been placed into a transaction using <code>begin()</code>, the session releases all connection resources after a <code>commit()</code> or <code>rollback()</code> and remains transaction-less (with the exception of flushes) until the next <code>begin()</code> call:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">autocommit</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator">
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>begin()</code> method also returns a transactional token which is compatible with the Python 2.6 <code>with</code> statement:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">autocommit</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">with </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">item1 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item2 </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">Item</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">2</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">item1</span><span class="python_operator">.</span><span class="python_name">foo </span><span class="python_operator">= </span><span class="python_literal">'bar'</span><span class="python_operator">
    </span><span class="python_name">item2</span><span class="python_operator">.</span><span class="python_name">bar </span><span class="python_operator">= </span><span class="python_literal">'foo'</span><span class="python_operator">
</span></pre>
    </div>


    
    <A name="unitofwork_managing_savepoint"></a>
    
    <div class="sectionL3">

    <h3>Using SAVEPOINT</h3>
    
    

<p>SAVEPOINT transactions, if supported by the underlying engine, may be delineated using the <code>begin_nested()</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">u1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">u2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">begin_nested</span><span class="python_enclosure">() </span><span class="python_comment"># establish a savepoint</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">u3</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()  </span><span class="python_comment"># rolls back u3, keeps u1 and u2</span><span class="python_operator">
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">() </span><span class="python_comment"># commits u1 and u2</span><span class="python_operator">
</span></pre>
    </div>
<p><code>begin_nested()</code> may be called any number of times, which will issue a new SAVEPOINT with a unique identifier for each call.  For each <code>begin_nested()</code> call, a corresponding <code>rollback()</code> or <code>commit()</code> must be issued.  <br></br>
</p>
<p>When <code>begin_nested()</code> is called, a <code>flush()</code> is unconditionally issued (regardless of the <code>autoflush</code> setting).  This is so that when a <code>rollback()</code> occurs, the full state of the session is expired, thus causing all subsequent attribute/instance access to reference the full state of the <code>Session</code> right before <code>begin_nested()</code> was called.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_managing_twophase"></a>
    
    <div class="sectionL3">

    <h3>Enabling Two-Phase Commit</h3>
    
    

<p>Finally, for MySQL, PostgreSQL, and soon Oracle as well, the session can be instructed to use two-phase commit semantics. This will coordinate the committing of transactions across databases so that the transaction is either committed or rolled back in all databases. You can also <code>prepare()</code> the session for interacting with transactions not managed by SQLAlchemy. To use two phase transactions set the flag <code>twophase=True</code> on the session:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine1 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine2 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">twophase</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># bind User operations to engine 1, Account operations to engine 2
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">configure</span><span class="python_enclosure">(</span><span class="python_name">binds</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">User</span><span class="python_operator">:</span><span class="python_name">engine1</span><span class="python_operator">, </span><span class="python_name">Account</span><span class="python_operator">:</span><span class="python_name">engine2</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># .... work with accounts and users
</span>
<span class="python_comment"># commit.  session will issue a flush to all DBs, and a prepare step to all DBs,
# before committing both transactions
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_flushsql"></a>
    
    <div class="sectionL2">

    <h3>Embedding SQL Insert/Update Expressions into a Flush</h3>
    
    

<p>This feature allows the value of a database column to be set to a SQL expression instead of a literal value.  It's especially useful for atomic updates, calling stored procedures, etc.  All you do is assign an expression to an attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">SomeClass</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">pass</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">SomeClass</span><span class="python_operator">, </span><span class="python_name">some_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">someobject </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">SomeClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">get</span><span class="python_enclosure">(</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># set 'value' attribute to a SQL expression adding one
</span><span class="python_name">someobject</span><span class="python_operator">.</span><span class="python_name">value </span><span class="python_operator">= </span><span class="python_name">some_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">value </span><span class="python_operator">+ </span><span class="python_number">1</span><span class="python_operator">
</span>
<span class="python_comment"># issues "UPDATE some_table SET value=value+1"
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>This technique works both for INSERT and UPDATE statements.  After the flush/commit operation, the <code>value</code> attribute on <code>someobject</code> above is expired, so that when next accessed the newly generated value will be loaded from the database. 
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_sql"></a>
    
    <div class="sectionL2">

    <h3>Using SQL Expressions with Sessions</h3>
    
    

<p>SQL expressions and strings can be executed via the <code>Session</code> within its transactional context.  This is most easily accomplished using the <code>execute()</code> method, which returns a <code>ResultProxy</code> in the same manner as an <code>Engine</code> or <code>Connection</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># execute a string statement
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table where id=:id"</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_comment"># execute a SQL expression construct
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">mytable</span><span class="python_enclosure">])</span><span class="python_operator">.</span><span class="python_name">where</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The current <code>Connection</code> held by the <code>Session</code> is accessible using the <code>connection()</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The examples above deal with a <code>Session</code> that's bound to a single <code>Engine</code> or <code>Connection</code>.  To execute statements using a <code>Session</code> which is bound either to multiple engines, or none at all (i.e. relies upon bound metadata), both <code>execute()</code> and <code>connection()</code> accept a <code>mapper</code> keyword argument, which is passed a mapped class or <code>Mapper</code> instance, which is used to locate the proper context for the desired engine:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># need to specify mapper or class when executing
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table where id=:id"</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'id'</span><span class="python_operator">:</span><span class="python_number">7</span><span class="python_enclosure">}</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">=</span><span class="python_name">MyMappedClass</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">mytable</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_operator">==</span><span class="python_number">7</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">mapper</span><span class="python_operator">=</span><span class="python_name">MyMappedClass</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_enclosure">(</span><span class="python_name">MyMappedClass</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_joining"></a>
    
    <div class="sectionL2">

    <h3>Joining a Session into an External Transaction</h3>
    
    

<p>If a <code>Connection</code> is being used which is already in a transactional state (i.e. has a <code>Transaction</code>), a <code>Session</code> can be made to participate within that transaction by just binding the <code>Session</code> to that <code>Connection</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># non-ORM connection + transaction
</span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># create a Session, bind to the connection
</span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># ... work with session
</span>
<span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">() </span><span class="python_comment"># commit the session</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()  </span><span class="python_comment"># close it out, prohibit further actions</span><span class="python_operator">
</span>
<span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">() </span><span class="python_comment"># commit the actual transaction</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that above, we issue a <code>commit()</code> both on the <code>Session</code> as well as the <code>Transaction</code>.  This is an example of where we take advantage of <code>Connection</code>'s ability to maintain <em>subtransactions</em>, or nested begin/commit pairs.  The <code>Session</code> is used exactly as though it were managing the transaction on its own; its <code>commit()</code> method issues its <code>flush()</code>, and commits the subtransaction.   The subsequent transaction the <code>Session</code> starts after commit will not begin until it's next used.  Above we issue a <code>close()</code> to prevent this from occurring.  Finally, the actual transaction is committed using <code>Transaction.commit()</code>.
</p>
<p>When using the <code>threadlocal</code> engine context, the process above is simplified; the <code>Session</code> uses the same connection/transaction as everyone else in the current thread, whether or not you explicitly bind it:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://mydb'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">"threadlocal"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()  </span><span class="python_comment"># session takes place in the transaction like everyone else</span><span class="python_operator">
</span>
<span class="python_comment"># ... go nuts
</span>
<span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">() </span><span class="python_comment"># commit the transaction</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_contextual"></a>
    
    <div class="sectionL2">

    <h3>Contextual/Thread-local Sessions</h3>
    
    

<p>A common need in applications, particularly those built around web frameworks, is the ability to "share" a <code>Session</code> object among disparate parts of an application, without needing to pass the object explicitly to all method and function calls.  What you're really looking for is some kind of "global" session object, or at least "global" to all the parts of an application which are tasked with servicing the current request.  For this pattern, SQLAlchemy provides the ability to enhance the <code>Session</code> class generated by <code>sessionmaker()</code> to provide auto-contextualizing support.  This means that whenever you create a <code>Session</code> instance with its constructor, you get an <em>existing</em> <code>Session</code> object which is bound to some "context".  By default, this context is the current thread.  This feature is what previously was accomplished using the <code>sessioncontext</code> SQLAlchemy extension.
</p>


    
    <A name="unitofwork_contextual_creating"></a>
    
    <div class="sectionL3">

    <h3>Creating a Thread-local Context</h3>
    
    

<p>The <code>scoped_session()</code> function wraps around the <code>sessionmaker()</code> function, and produces an object which behaves the same as the <code>Session</code> subclass returned by <code>sessionmaker()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm </span><span class="python_keyword">import </span><span class="python_name">scoped_session</span><span class="python_operator">, </span><span class="python_name">sessionmaker</span><span class="python_operator">
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">scoped_session</span><span class="python_enclosure">(</span><span class="python_name">sessionmaker</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>
<p>However, when you instantiate this <code>Session</code> "class", in reality the object is pulled from a threadlocal variable, or if it doesn't exist yet, it's created using the underlying class generated by <code>sessionmaker()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># call Session() the first time.  the new Session instance is created.</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># later, in the same application thread, someone else calls Session()</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session2 </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_comment"># the two Session objects are *the same* object</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">session </span><span class="python_keyword">is </span><span class="python_name">session2</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span></pre>
    </div>
<p>Since the <code>Session()</code> constructor now returns the same <code>Session</code> object every time within the current thread, the object returned by <code>scoped_session()</code> also implements most of the <code>Session</code> methods and properties at the "class" level, such that you don't even need to instantiate <code>Session()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># create some objects
</span><span class="python_name">u1 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">u2 </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># save to the contextual session, without instantiating
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">u1</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">add</span><span class="python_enclosure">(</span><span class="python_name">u2</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># view the "new" attribute
</span><span class="python_keyword">assert </span><span class="python_name">u1 </span><span class="python_keyword">in </span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">new</span><span class="python_operator">
</span>
<span class="python_comment"># commit changes
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The contextual session may be disposed of by calling <code>Session.remove()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># remove current contextual session
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">remove</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>After <code>remove()</code> is called, the next operation with the contextual session will start a new <code>Session</code> for the current thread.
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_contextual_lifespan"></a>
    
    <div class="sectionL3">

    <h3>Lifespan of a Contextual Session</h3>
    
    

<p>A (really, really) common question is when does the contextual session get created, when does it get disposed ?  We'll consider a typical lifespan as used in a web application:
</p>

    

    <div class="sliding_code">
        <pre>
Web Server          Web Framework        User-defined Controller Call
--------------      --------------       ------------------------------
web request    -> 
                    call controller ->   # call Session().  this establishes a new,
                                         # contextual Session.
                                         session = Session()

                                         # load some objects, save some changes
                                         objects = session.query(MyClass).all()

                                         # some other code calls Session, it's the 
                                         # same contextual session as "sess"
                                         session2 = Session()
                                         session2.add(foo)
                                         session2.commit()

                                         # generate content to be returned
                                         return generate_content()
                    Session.remove() <-
web response   <-
</pre>
    </div>
<p>The above example illustrates an explicit call to <code>Session.remove()</code>.  This has the effect such that each web request starts fresh with a brand new session.   When integrating with a web framework, there's actually many options on how to proceed for this step, particularly as of version 0.5:
</p>
<ul>
 <li>
     Session.remove() - this is the most cut and dry approach; the <code>Session</code> is thrown away, all of its transactional/connection resources are closed out, everything within it is explicitly gone.  A new <code>Session</code> will be used on the next request.
 </li>

 <li>
     Session.close() - Similar to calling <code>remove()</code>, in that all objects are explicitly expunged and all transactional/connection resources closed, except the actual <code>Session</code> object hangs around.  It doesn't make too much difference here unless the start of the web request would like to pass specific options to the initial construction of <code>Session()</code>, such as a specific <code>Engine</code> to bind to.
 </li>

 <li>
     Session.commit() - In this case, the behavior is that any remaining changes pending are flushed, and the transaction is committed.  The full state of the session is expired, so that when the next web request is started, all data will be reloaded.  In reality, the contents of the <code>Session</code> are weakly referenced anyway so its likely that it will be empty on the next request in any case.
 </li>

 <li>
     Session.rollback() - Similar to calling commit, except we assume that the user would have called commit explicitly if that was desired; the <code>rollback()</code> ensures that no transactional state remains and expires all data, in the case that the request was aborted and did not roll back itself.
 </li>

 <li>
     do nothing - this is a valid option as well.  The controller code is responsible for doing one of the above steps at the end of the request.
 </li>
</ul>
<p><a href="#docstrings_sqlalchemy.orm_modfunc_scoped_session">Generated docstrings for scoped_session()</a>
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_partitioning"></a>
    
    <div class="sectionL2">

    <h3>Partitioning Strategies</h3>
    
    

<p>this section is TODO
</p>


    
    <A name="unitofwork_partitioning_vertical"></a>
    
    <div class="sectionL3">

    <h3>Vertical Partitioning</h3>
    
    

<p>Vertical partitioning places different kinds of objects, or different tables, across multiple databases.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine1 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db1'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">engine2 </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://db2'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">twophase</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># bind User operations to engine 1, Account operations to engine 2
</span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">configure</span><span class="python_enclosure">(</span><span class="python_name">binds</span><span class="python_operator">=</span><span class="python_enclosure">{</span><span class="python_name">User</span><span class="python_operator">:</span><span class="python_name">engine1</span><span class="python_operator">, </span><span class="python_name">Account</span><span class="python_operator">:</span><span class="python_name">engine2</span><span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>



    
    <A name="unitofwork_partitioning_horizontal"></a>
    
    <div class="sectionL3">

    <h3>Horizontal Partitioning</h3>
    
    

<p>Horizontal partitioning partitions the rows of a single table (or a set of tables) across multiple databases.
</p>
<p>See the "sharding" example in <a href='http://www.sqlalchemy.org/trac/browser/sqlalchemy/trunk/examples/sharding/attribute_shard.py'>attribute_shard.py</a>
</p>



            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="unitofwork_extending"></a>
    
    <div class="sectionL2">

    <h3>Extending Session</h3>
    
    

<p>Extending the session can be achieved through subclassing as well as through a simple extension class, which resembles the style of <a href="#advdatamapping_mapper_extending">Extending Mapper</a> called <a href="sqlalchemy_orm_session.html#docstrings_sqlalchemy.orm.session_SessionExtension">SessionExtension</a>.  See the docstrings for more information on this class' methods.
</p>
<p>Basic usage is similar to <code>MapperExtension</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MySessionExtension</span><span class="python_enclosure">(</span><span class="python_name">SessionExtension</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">before_commit</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">session</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">print </span><span class="python_literal">"before commit!"</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MySessionExtension</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>
<p>or with <code>create_session()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">session </span><span class="python_operator">= </span><span class="python_name">create_session</span><span class="python_enclosure">(</span><span class="python_name">extension</span><span class="python_operator">=</span><span class="python_name">MySessionExtension</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>
<p>The same <code>SessionExtension</code> instance can be used with any number of sessions.
</p>




            <a href="#unitofwork" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="dbengine"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#unitofwork">Using the Session</a>

               |   
            Next: <a href="#metadata">Database Meta Data</a>
    </div>

        <h2>Database Engines</h2>
    </div>


        








    
    <A name="dbengine"></a>
    
    <div class="sectionL1">

    
    

<p>The <strong>Engine</strong> is the starting point for any SQLAlchemy application.  It's "home base" for the actual database and its DBAPI, delivered to the SQLAlchemy application through a connection pool and a <strong>Dialect</strong>, which describes how to talk to a specific kind of database and DBAPI combination.
</p>
<p>The general structure is this:
</p>

    

    <div class="sliding_code">
        <pre>
                                     +-----------+                        __________
                                 /---|   Pool    |---\                   (__________)
             +-------------+    /    +-----------+    \     +--------+   |          |
connect() <--|   Engine    |---x                       x----| DBAPI  |---| database |
             +-------------+    \    +-----------+    /     +--------+   |          |
                                 \---|  Dialect  |---/                   |__________|
                                     +-----------+                       (__________)
</pre>
    </div>
<p>Where above, a <a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Engine">sqlalchemy.engine.Engine</a> references both a  <a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Dialect">sqlalchemy.engine.Dialect</a> and <a href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool_Pool">sqlalchemy.pool.Pool</a>, which together interpret the DBAPI's module functions as well as the behavior of the database.
</p>
<p>Creating an engine is just a matter of issuing a single call, <code>create_engine()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost:5432/mydatabase'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above engine invokes the <code>postgres</code> dialect and a connection pool which references <code>localhost:5432</code>.
</p>
<p>The engine can be used directly to issue SQL to the database.  The most generic way is to use connections, which you get via the <code>connect()</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select username from users"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"username:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'username'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The connection is an instance of <a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_Connection">sqlalchemy.engine.Connection</a>, which is a <strong>proxy</strong> object for an actual DBAPI connection.  The returned result is an instance of <a href="sqlalchemy_engine.html#docstrings_sqlalchemy.engine_ResultProxy">sqlalchemy.engine.ResultProxy</a>, which acts very much like a DBAPI cursor.
</p>
<p>When you say <code>engine.connect()</code>, a new <code>Connection</code> object is created, and a DBAPI connection is retrieved from the connection pool.  Later, when you call <code>connection.close()</code>, the DBAPI connection is returned to the pool; nothing is actually "closed" from the perspective of the database.
</p>
<p>To execute some SQL more quickly, you can skip the <code>Connection</code> part and just say:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select username from users"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_literal">"username:"</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'username'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Where above, the <code>execute()</code> method on the <code>Engine</code> does the <code>connect()</code> part for you, and returns the <code>ResultProxy</code> directly.  The actual <code>Connection</code> is <em>inside</em> the <code>ResultProxy</code>, waiting for you to finish reading the result.  In this case, when you <code>close()</code> the <code>ResultProxy</code>, the underlying <code>Connection</code> is closed, which returns the DBAPI connection to the pool. 
</p>
<p>To summarize the above two examples, when you use a <code>Connection</code> object, it's known as <strong>explicit execution</strong>.  When you don't see the <code>Connection</code> object, but you still use the <code>execute()</code> method on the <code>Engine</code>, it's called <strong>explicit, connectionless execution</strong>.   A third variant of execution also exists called <strong>implicit execution</strong>; this will be described later.
</p>
<p>The <code>Engine</code> and <code>Connection</code> can do a lot more than what we illustrated above; SQL strings are only its most rudimentary function.  Later chapters will describe how "constructed SQL" expressions can be used with engines; in many cases, you don't have to deal with the <code>Engine</code> at all after it's created.  The Object Relational Mapper (ORM), an optional feature of SQLAlchemy, also uses the <code>Engine</code> in order to get at connections; that's also a case where you can often create the engine once, and then forget about it.
</p>


    
    <A name="dbengine_supported"></a>
    
    <div class="sectionL2">

    <h3>Supported Databases</h3>
    
    

<p>Recall that the <code>Dialect</code> is used to describe how to talk to a specific kind of database.  Dialects are included with SQLAlchemy for SQLite, Postgres, MySQL, MS-SQL, Firebird, Informix, and Oracle; these can each be seen as a Python module present in the <code>sqlalchemy.databases</code> package.  Each dialect requires the appropriate DBAPI drivers to be installed separately.
</p>
<p>Downloads for each DBAPI at the time of this writing are as follows:
</p>
<ul>
 <li>
     Postgres:  <a href='http://www.initd.org/tracker/psycopg/wiki/PsycopgTwo'>psycopg2</a>
 </li>

 <li>
     SQLite:  <a href='http://www.python.org/doc/2.5.2/lib/module-sqlite3.html'>sqlite3</a> <a href='http://initd.org/tracker/pysqlite'>pysqlite</a>
 </li>

 <li>
     MySQL:   <a href='http://sourceforge.net/projects/mysql-python'>MySQLDB</a>
 </li>

 <li>
     Oracle:  <a href='http://www.cxtools.net/default.aspx?nav=home'>cx_Oracle</a>
 </li>

 <li>
     MS-SQL:  <a href='http://pyodbc.sourceforge.net/'>pyodbc</a> (recommended) <a href='http://adodbapi.sourceforge.net/'>adodbapi</a>  <a href='http://pymssql.sourceforge.net/'>pymssql</a>
 </li>

 <li>
     Firebird:  <a href='http://kinterbasdb.sourceforge.net/'>kinterbasdb</a>
 </li>

 <li>
     Informix:  <a href='http://informixdb.sourceforge.net/'>informixdb</a>
 </li>
</ul>
<p>The SQLAlchemy Wiki contains a page of database notes, describing whatever quirks and behaviors have been observed.  Its a good place to check for issues with specific databases.  <a href='http://www.sqlalchemy.org/trac/wiki/DatabaseNotes'>Database Notes</a>
</p>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>



    
    <A name="dbengine_establishing"></a>
    
    <div class="sectionL2">

    <h3>create_engine() URL Arguments</h3>
    
    

<p>SQLAlchemy indicates the source of an Engine strictly via <a href='http://rfc.net/rfc1738.html'>RFC-1738</a> style URLs, combined with optional keyword arguments to specify options for the Engine.  The form of the URL is:
</p>
<pre><code>driver://username:password@host:port/database
</code></pre><p>Available drivernames are <code>sqlite</code>, <code>mysql</code>, <code>postgres</code>, <code>oracle</code>, <code>mssql</code>, and <code>firebird</code>.  For sqlite, the database name is the filename to connect to, or the special name ":memory:" which indicates an in-memory database.  The URL is typically sent as a string to the <code>create_engine()</code> function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># postgres
</span><span class="python_name">pg_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost:5432/mydatabase'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># sqlite (note the four slashes for an absolute path)
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:////absolute/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///relative/path/to/database.txt'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">)  </span><span class="python_comment"># in-memory database</span><span class="python_operator">
</span><span class="python_name">sqlite_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://:memory:'</span><span class="python_enclosure">)  </span><span class="python_comment"># the same</span><span class="python_operator">
</span>
<span class="python_comment"># mysql
</span><span class="python_name">mysql_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/foo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle via TNS name
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@dsn'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># oracle will feed host/port/SID into cx_oracle.makedsn
</span><span class="python_name">oracle_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'oracle://scott:tiger@127.0.0.1:1521/sidname'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mssql
</span><span class="python_name">mssql_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mssql://username:password@localhost/database'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># mssql via a DSN connection
</span><span class="python_name">mssql_db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mssql://username:password@/?dsn=mydsn'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Engine</code> will ask the connection pool for a connection when the <code>connect()</code> or <code>execute()</code> methods are called.  The default connection pool, <code>QueuePool</code>, as well as the default connection pool used with SQLite, <code>SingletonThreadPool</code>, will open connections to the database on an as-needed basis.  As concurrent statements are executed, <code>QueuePool</code> will grow its pool of connections to a default size of five, and will allow a default "overflow" of ten.   Since the <code>Engine</code> is essentially "home base" for the connection pool, it follows that you should keep a single <code>Engine</code> per database established within an application, rather than creating a new one for each connection.
</p>


    
    <A name="dbengine_establishing_custom"></a>
    
    <div class="sectionL3">

    <h3>Custom DBAPI connect() arguments</h3>
    
    

<p>Custom arguments used when issuing the <code>connect()</code> call to the underlying DBAPI may be issued in three distinct ways.  String-based arguments can be passed directly from the URL string as query arguments:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test?argument1=foo&amp;argument2=bar'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>If SQLAlchemy's database connector is aware of a particular query argument, it may convert its type from string to its proper type.
</p>
<p><code>create_engine</code> also takes an argument <code>connect_args</code> which is an additional dictionary that will be passed to <code>connect()</code>.  This can be used when arguments of a type other than string are required, and SQLAlchemy's database connector has no type conversion logic present for that parameter:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test'</span><span class="python_operator">, </span><span class="python_name">connect_args </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'argument1'</span><span class="python_operator">:</span><span class="python_number">17</span><span class="python_operator">, </span><span class="python_literal">'argument2'</span><span class="python_operator">:</span><span class="python_literal">'bar'</span><span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>The most customizable connection method of all is to pass a <code>creator</code> argument, which specifies a callable that returns a DBAPI connection:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">def </span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'localhost'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">connect</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="dbengine_options"></a>
    
    <div class="sectionL2">

    <h3>Database Engine Options</h3>
    
    

<p>Keyword options can also be specified to <code>create_engine()</code>, following the string URL as follows:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://...'</span><span class="python_operator">, </span><span class="python_name">encoding</span><span class="python_operator">=</span><span class="python_literal">'latin1'</span><span class="python_operator">, </span><span class="python_name">echo</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>A list of all standard options, as well as several that are used by particular database dialects, is as follows:
</p>
<ul>
 <li>
     <strong>assert_unicode=False</strong> - When set to <code>True</code> alongside convert_unicode=<code>True</code>, asserts that incoming string bind parameters are instances of <code>unicode</code>, otherwise raises an error.  Only takes effect when <code>convert_unicode==True</code>.  This flag is also available on the <code>String</code> type and its descendants. New in 0.4.2.  <br></br>
 </li>

 <li>
     <strong>connect_args</strong> - a dictionary of options which will be passed directly to the DBAPI's <code>connect()</code> method as additional keyword arguments.
 </li>

 <li>
     <strong>convert_unicode=False</strong> - if set to True, all String/character based types will convert Unicode values to raw byte values going into the database, and all raw byte values to Python Unicode coming out in result sets.  This is an engine-wide method to provide unicode conversion across the board.  For unicode conversion on a column-by-column level, use the <code>Unicode</code> column type instead, described in <a href="#types">The Types System</a>.
 </li>

 <li>
     <strong>creator</strong> - a callable which returns a DBAPI connection.  This creation function will be passed to the underlying connection pool and will be used to create all new database connections.  Usage of this function causes connection parameters specified in the URL argument to be bypassed.
 </li>

 <li>
     <strong>echo=False</strong> - if True, the Engine will log all statements as well as a repr() of their parameter lists to the engines logger, which defaults to sys.stdout.  The <code>echo</code> attribute of <code>Engine</code> can be modified at any time to turn logging on and off.  If set to the string <code>&quot;debug&quot;</code>, result rows will be printed to the standard output as well.  This flag ultimately controls a Python logger; see <a href="#dbengine_logging">Configuring Logging</a> at the end of this chapter for information on how to configure logging directly.
 </li>

 <li>
     <strong>echo_pool=False</strong> - if True, the connection pool will log all checkouts/checkins to the logging stream, which defaults to sys.stdout.  This flag ultimately controls a Python logger; see <a href="#dbengine_logging">Configuring Logging</a> for information on how to configure logging directly.
 </li>

 <li>
     <strong>encoding='utf-8'</strong> - the encoding to use for all Unicode translations, both by engine-wide unicode conversion as well as the <code>Unicode</code> type object.
 </li>

 <li>
     <strong>label_length=None</strong> - optional integer value which limits the size of dynamically generated column labels to that many characters.  If less than 6, labels are generated as "_(counter)".  If <code>None</code>, the value of <code>dialect.max_identifier_length</code> is used instead.
 </li>

 <li>
     <strong>module=None</strong> - used by database implementations which support multiple DBAPI modules, this is a reference to a DBAPI2 module to be used instead of the engine's default module.  For Postgres, the default is psycopg2.  For Oracle, it's cx_Oracle.
 </li>

 <li>
     <strong>pool=None</strong> - an already-constructed instance of <code>sqlalchemy.pool.Pool</code>, such as a <code>QueuePool</code> instance.  If non-None, this pool will be used directly as the underlying connection pool for the engine, bypassing whatever connection parameters are present in the URL argument.  For information on constructing connection pools manually, see <a href="#pooling">Connection Pooling</a>.
 </li>

 <li>
     <strong>poolclass=None</strong> - a <code>sqlalchemy.pool.Pool</code> subclass, which will be used to create a connection pool instance using the connection parameters given in the URL.  Note this differs from <code>pool</code> in that you don't actually instantiate the pool in this case, you just indicate what type of pool to be used.
 </li>

 <li>
     <strong>max_overflow=10</strong> - the number of connections to allow in connection pool "overflow", that is connections that can be opened above and beyond the pool_size setting, which defaults to five.  this is only used with <code>QueuePool</code>.
 </li>

 <li>
     <strong>pool_size=5</strong> - the number of connections to keep open inside the connection pool.  This used with <code>QueuePool</code> as well as <code>SingletonThreadPool</code>.
 </li>

 <li>
     <strong>pool_recycle=-1</strong> - this setting causes the pool to recycle connections after the given number of seconds has passed.  It defaults to -1, or no timeout.  For example, setting to 3600 means connections will be recycled after one hour.  Note that MySQL in particular will <strong>disconnect automatically</strong> if no activity is detected on a connection for eight hours (although this is configurable with the MySQLDB connection itself and the  server configuration as well).
 </li>

 <li>
     <strong>pool_timeout=30</strong> - number of seconds to wait before giving up on getting a connection from the pool.  This is only used with <code>QueuePool</code>.
 </li>

 <li>
     <strong>strategy='plain'</strong> - the Strategy argument is used to select alternate implementations of the underlying Engine object, which coordinates operations between dialects, compilers, connections, and so on.  Currently, the only alternate strategy besides the default value of "plain" is the "threadlocal" strategy, which selects the usage of the <code>TLEngine</code> class that provides a modified connection scope for connectionless executions.  Connectionless execution as well as further detail on this setting are described in <a href="#dbengine_implicit">Connectionless Execution, Implicit Execution</a>.
 </li>

 <li>
     <strong>threaded=True</strong> - used by cx_Oracle; sets the <code>threaded</code> parameter of the connection indicating thread-safe usage.  cx_Oracle docs indicate setting this flag to <code>False</code> will speed performance by 10-15%.  While this defaults to <code>False</code> in cx_Oracle, SQLAlchemy defaults it to <code>True</code>, preferring stability over early optimization.
 </li>

 <li>
     <strong>use_ansi=True</strong> - used only by Oracle;  when False, the Oracle driver attempts to support a particular "quirk" of Oracle versions 8 and previous, that the LEFT OUTER JOIN SQL syntax is not supported, and the "Oracle join" syntax of using <code>column1(+)=column2</code> must be used in order to achieve a LEFT OUTER JOIN.
 </li>

 <li>
     <strong>use_oids=False</strong> - used only by Postgres, will enable the column name "oid" as the object ID column, which is also used for the default sort order of tables.  Postgres as of 8.1 has object IDs disabled by default.
 </li>
</ul>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>



    
    <A name="dbengine_connections"></a>
    
    <div class="sectionL2">

    <h3>More On Connections</h3>
    
    

<p>Recall from the beginning of this section that the Engine provides a <code>connect()</code> method which returns a <code>Connection</code> object.  <code>Connection</code> is a <em>proxy</em> object which maintains a reference to a DBAPI connection instance.  The <code>close()</code> method on <code>Connection</code> does not actually close the DBAPI connection, but instead returns it to the connection pool referenced by the <code>Engine</code>.  <code>Connection</code> will also automatically return its resources to the connection pool when the object is garbage collected, i.e. its <code>__del__()</code> method is called.  When using the standard C implementation of Python, this method is usually called immediately as soon as the object is dereferenced.  With other Python implementations such as Jython, this is not so guaranteed.  <br></br>
</p>
<p>The <code>execute()</code> methods on both <code>Engine</code> and <code>Connection</code> can also receive SQL clause constructs as well:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">select</span><span class="python_enclosure">([</span><span class="python_name">table1</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col1</span><span class="python_operator">==</span><span class="python_number">5</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col1'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">row</span><span class="python_enclosure">[</span><span class="python_literal">'col2'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The above SQL construct is known as a <code>select()</code>.  The full range of SQL constructs available are described in <a href="#sql">SQL Expression Language Tutorial</a>.
</p>
<p>Both <code>Connection</code> and <code>Engine</code> fulfill an interface known as <code>Connectable</code> which specifies common functionality between the two objects, namely being able to call <code>connect()</code> to return a <code>Connection</code> object (<code>Connection</code> just returns itself), and being able to call <code>execute()</code> to get a result set.   Following this, most SQLAlchemy functions and objects which accept an <code>Engine</code> as a parameter or attribute with which to execute SQL will also accept a <code>Connection</code>.  As of SQLAlchemy 0.3.9, this argument is named <code>bind</code>.
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Specify Engine or Connection</div>
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># specify some Table metadata
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'sometable'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># create the table with the Engine
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># drop the table with a Connection off the Engine
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">table</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Connection facts:
</p>
<ul>
 <li>
     the Connection object is <strong>not threadsafe</strong>.  While a Connection can be shared among threads using properly synchronized access, this is also not recommended as many DBAPIs have issues with, if not outright disallow, sharing of connection state between threads.
 </li>

 <li>
     The Connection object represents a single dbapi connection checked out from the connection pool.  In this state, the connection pool has no affect upon the connection, including its expiration or timeout state.  For the connection pool to properly manage connections, <em></em>connections should be returned to the connection pool (i.e. <code>connection.close()</code>) whenever the connection is not in use<em></em>.  If your application has a need for management of multiple connections or is otherwise long running (this includes all web applications, threaded or not), don't hold a single connection open at the module level.
 </li>
</ul>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>



    
    <A name="dbengine_transactions"></a>
    
    <div class="sectionL2">

    <h3>Using Transactions with Connection</h3>
    
    

<p>The <code>Connection</code> object provides a <code>begin()</code> method which returns a <code>Transaction</code> object.  This object is usually used within a try/except clause so that it is guaranteed to <code>rollback()</code> or <code>commit()</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
    </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_number">7</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'this is some data'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_keyword">raise</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Transaction</code> object also handles "nested" behavior by keeping track of the outermost begin/commit pair.  In this example, two functions both issue a transaction on a Connection, but only the outermost Transaction object actually takes effect when it is committed.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># method_a starts a transaction and calls method_b
</span><span class="python_keyword">def </span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is committed here</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># method_b also starts a transaction
</span><span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">method_b</span><span class="python_enclosure">(</span><span class="python_name">connection</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">() </span><span class="python_comment"># open a transaction - this runs in the context of method_a's transaction</span><span class="python_operator">
    </span><span class="python_keyword">try</span><span class="python_operator">:
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into mytable values ('bat', 'lala')"</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">()</span><span class="python_operator">, </span><span class="python_name">col1</span><span class="python_operator">=</span><span class="python_literal">'bat'</span><span class="python_operator">, </span><span class="python_name">col2</span><span class="python_operator">=</span><span class="python_literal">'lala'</span><span class="python_enclosure">)</span><span class="python_operator">
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()  </span><span class="python_comment"># transaction is not committed yet</span><span class="python_operator">
    </span><span class="python_keyword">except</span><span class="python_operator">:
        </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">() </span><span class="python_comment"># this rolls back the transaction unconditionally</span><span class="python_operator">
        </span><span class="python_keyword">raise</span><span class="python_operator">
</span>
<span class="python_comment"># open a Connection and call method_a
</span><span class="python_operator"></span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()                </span><span class="python_operator">
</span><span class="python_name">method_a</span><span class="python_enclosure">(</span><span class="python_name">conn</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, <code>method_a</code> is called first, which calls <code>connection.begin()</code>.  Then it calls <code>method_b</code>. When <code>method_b</code> calls <code>connection.begin()</code>, it just increments a counter that is decremented when it calls <code>commit()</code>.  If either <code>method_a</code> or <code>method_b</code> calls <code>rollback()</code>, the whole transaction is rolled back.  The transaction is not committed until <code>method_a</code> calls the <code>commit()</code> method.  This "nesting" behavior allows the creation of functions which "guarantee" that a transaction will be used if one was not already available, but will automatically participate in an enclosing transaction if one exists.
</p>
<p>Note that SQLAlchemy's Object Relational Mapper also provides a way to control transaction scope at a higher level; this is described in <b>unitofwork_transaction</b>.
</p>
<p>Transaction Facts:
</p>
<ul>
 <li>
     the Transaction object, just like its parent Connection, is <strong>not threadsafe</strong>.
 </li>

 <li>
     SQLAlchemy 0.4 will feature transactions with two-phase commit capability as well as SAVEPOINT capability.
 </li>
</ul>


    
    <A name="dbengine_transactions_understanding"></a>
    
    <div class="sectionL3">

    <h3>Understanding Autocommit</h3>
    
    

<p>The above transaction example illustrates how to use <code>Transaction</code> so that several executions can take part in the same transaction.  What happens when we issue an INSERT, UPDATE or DELETE call without using <code>Transaction</code>?  The answer is <strong>autocommit</strong>.  While many DBAPIs  implement a flag called <code>autocommit</code>, the current SQLAlchemy behavior is such that it implements its own autocommit.  This is achieved by detecting statements which represent data-changing operations, i.e. INSERT, UPDATE, DELETE, etc., and then issuing a COMMIT automatically if no transaction is in progress.  The detection is based on compiled statement attributes, or in the case of a text-only statement via regular expressions.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"INSERT INTO users VALUES (1, 'john')"</span><span class="python_enclosure">)  </span><span class="python_comment"># autocommits</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="dbengine_implicit"></a>
    
    <div class="sectionL2">

    <h3>Connectionless Execution, Implicit Execution</h3>
    
    

<p>Recall from the first section we mentioned executing with and without a <code>Connection</code>.  <code>Connectionless</code> execution refers to calling the <code>execute()</code> method on an object which is not a <code>Connection</code>, which could be on the <code>Engine</code> itself, or could be a constructed SQL object.  When we say "implicit", we mean that we are calling the <code>execute()</code> method on an object which is neither a <code>Connection</code> nor an <code>Engine</code> object; this can only be used with constructed SQL objects which have their own <code>execute()</code> method, and can be "bound" to an <code>Engine</code>.  A description of "constructed SQL objects" may be found in <a href="#sql">SQL Expression Language Tutorial</a>.
</p>
<p>A summary of all three methods follows below.  First, assume the usage of the following <code>MetaData</code> and <code>Table</code> objects; while we haven't yet introduced these concepts, for now you only need to know that we are representing a database table, and are creating an "executable" SQL construct which issues a statement to the database.  These objects are described in <a href="#metadata">Database Meta Data</a>.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Explicit execution delivers the SQL text or constructed SQL expression to the <code>execute()</code> method of <code>Connection</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///file.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_comment"># ....
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Explicit, connectionless execution delivers the expression to the <code>execute()</code> method of <code>Engine</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///file.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_comment"># ....
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Implicit execution is also connectionless, and calls the <code>execute()</code> method on the expression itself, utilizing the fact that either an <code>Engine</code> or <code>Connection</code> has been <em>bound</em> to the expression object (binding is discussed further in the next section, <a href="#metadata">Database Meta Data</a>):
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///file.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">result</span><span class="python_operator">:
    </span><span class="python_comment"># ....
</span><span class="python_name">result</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>In both "connectionless" examples, the <code>Connection</code> is created behind the scenes; the <code>ResultProxy</code> returned by the <code>execute()</code> call references the <code>Connection</code> used to issue the SQL statement.   When we issue <code>close()</code> on the <code>ResultProxy</code>, or if the result set object falls out of scope and is garbage collected, the underlying <code>Connection</code> is closed for us, resulting in the DBAPI connection being returned to the pool.
</p>


    
    <A name="dbengine_implicit_strategies"></a>
    
    <div class="sectionL3">

    <h3>Using the Threadlocal Execution Strategy</h3>
    
    

<p>With connectionless execution, each returned <code>ResultProxy</code> object references its own distinct DBAPI connection object.  This means that multiple executions will result in multiple DBAPI connections being used at the same time; the example below illustrates this:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references a *second* DBAPI connection resource.
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># release connection 1
</span><span class="python_operator"></span><span class="python_name">r1</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># release connection 2
</span><span class="python_name">r2</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Where above, we have two result sets in scope at the same time, therefore we have two distinct DBAPI connections, both separately checked out from the connection pool, in scope at the same time.
</p>
<p>An option exists to <code>create_engine()</code> called <code>strategy=&quot;threadlocal&quot;</code>, which changes this behavior.  When this option is used, the <code>Engine</code> which is returned by <code>create_engine()</code> is a special subclass of engine called <code>TLEngine</code>.  This engine, when it creates the <code>Connection</code> used by a connectionless execution, checks a <strong>threadlocal variable</strong> for an existing DBAPI connection that was already checked out from the pool, within the current thread.  If one exists, it uses that one. 
</p>
<p>The usage of "threadlocal" modifies the underlying behavior of our example above, as follows:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Threadlocal Strategy</div>
        <pre>
<span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute one statement and receive results.  r1 now references a DBAPI connection resource.
</span><span class="python_name">r1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table1"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># execute a second statement and receive results.  r2 now references the *same* resource as r1
</span><span class="python_name">r2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"select * from table2"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r1</span><span class="python_operator">:
    ...
</span><span class="python_keyword">for </span><span class="python_name">row </span><span class="python_keyword">in </span><span class="python_name">r2</span><span class="python_operator">:
    ...
</span><span class="python_comment"># close r1.  the connection is still held by r2.
</span><span class="python_operator"></span><span class="python_name">r1</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># close r2.  with no more references to the underlying connection resources, they
# are returned to the pool.
</span><span class="python_name">r2</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Where above, we again have two result sets in scope at the same time, but because they are present in the same thread, there is only <strong>one DBAPI connection in use</strong>.
</p>
<p>While the above distinction may not seem like much, it has several potentially desirable effects.  One is that you can in some cases reduce the number of concurrent connections checked out from the connection pool, in the case that a <code>ResultProxy</code> is still opened and a second statement is issued.  A second advantage is that by limiting the number of checked out connections in a thread to just one, you eliminate the issue of deadlocks within a single thread, such as when connection A locks a table, and connection B attempts to read from the same table in the same thread, it will "deadlock" on waiting for connection A to release its lock; the <code>threadlocal</code> strategy eliminates this possibility.
</p>
<p>A third advantage to the <code>threadlocal</code> strategy is that it allows the <code>Transaction</code> object to be used in combination with connectionless execution.  Recall from the section on transactions, that the <code>Transaction</code> is returned by the <code>begin()</code> method on a <code>Connection</code>; all statements which wish to participate in this transaction must be executed by the same <code>Connection</code>, thereby forcing the usage of an explicit connection.  However, the <code>TLEngine</code> provides a <code>Transaction</code> that is local to the current thread;  using it, one can issue many "connectionless" statements within a thread and they will all automatically partake in the current transaction, as in the example below:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">threadlocal connection sharing</div>
        <pre>
<span class="python_comment"># get a TLEngine
</span><span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into users values (?, ?)"</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">"john"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Notice that no <code>Connection</code> needed to be used; the <code>begin()</code> method on <code>TLEngine</code> (which note is not available on the regular <code>Engine</code>) created a <code>Transaction</code> as well as a <code>Connection</code>, and held onto both in a context corresponding to the current thread.  Each <code>execute()</code> call made use of the same connection, allowing them all to participate in the same transaction.
</p>
<p>Complex application flows can take advantage of the "threadlocal" strategy in order to allow many disparate parts of an application to take place in the same transaction automatically.  The example below demonstrates several forms of "connectionless execution" as well as some specialized explicit ones:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">threadlocal connection sharing</div>
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">table1</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">table2</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_comment"># do stuff with conn
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"some other sql"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">close</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">conn </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">trans </span><span class="python_operator">= </span><span class="python_name">conn</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
     </span><span class="python_comment"># do stuff
    </span><span class="python_name">trans</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">try</span><span class="python_operator">:
    </span><span class="python_name">dosomethingimplicit</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingelse</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">dosomethingtransactional</span><span class="python_enclosure">()</span><span class="python_operator">
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">commit</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_keyword">except</span><span class="python_operator">:
    </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>In the above example, the program calls three functions <code>dosomethingimplicit()</code>, <code>dosomethingelse()</code> and <code>dosomethingtransactional()</code>.  All three functions use either connectionless execution, or a special function <code>contextual_connect()</code> which we will describe in a moment.  These two styles of execution both indicate that all executions will use the same connection object.  Additionally, the method <code>dosomethingtransactional()</code> begins and commits its own <code>Transaction</code>.  But only one transaction is used, too; it's controlled completely by the <code>engine.begin()</code>/<code>engine.commit()</code> calls at the bottom.  Recall that <code>Transaction</code> supports "nesting" behavior, whereby transactions begun on a <code>Connection</code> which already has a transaction open, will "nest" into the enclosing transaction.  Since the transaction opened in <code>dosomethingtransactional()</code> occurs using the same connection which already has a transaction begun, it "nests" into that transaction and therefore has no effect on the actual transaction scope (unless it calls <code>rollback()</code>).
</p>
<p>Some of the functions in the above example make use of a method called <code>engine.contextual_connect()</code>.  This method is available on both <code>Engine</code> as well as <code>TLEngine</code>, and returns the <code>Connection</code> that applies to the current <strong>connection context</strong>.  When using the <code>TLEngine</code>, this is just another term for the "thread local connection" that is being used for all connectionless executions.  When using just the regular <code>Engine</code> (i.e. the "default" strategy), <code>contextual_connect()</code> is synonymous with <code>connect()</code>.  Below we illustrate that two connections opened via <code>contextual_connect()</code> at the same time, both reference the same underlying DBAPI connection:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Contextual Connection</div>
        <pre>
<span class="python_comment"># threadlocal strategy
</span><span class="python_name">db </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'mysql://localhost/test'</span><span class="python_operator">, </span><span class="python_name">strategy</span><span class="python_operator">=</span><span class="python_literal">'threadlocal'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">conn1 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">conn2 </span><span class="python_operator">= </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">contextual_connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">conn1</span><span class="python_operator">.</span><span class="python_name">connection </span><span class="python_keyword">is </span><span class="python_name">conn2</span><span class="python_operator">.</span><span class="python_name">connection</span><span class="python_operator">
</span><span class="python_name">True</span><span class="python_operator">
</span></pre>
    </div>
<p>The basic idea of <code>contextual_connect()</code> is that it's the "connection used by connectionless execution".  It's different from the <code>connect()</code> method in that <code>connect()</code> is always used when handling an explicit <code>Connection</code>, which will always reference distinct DBAPI connection.  Using <code>connect()</code> in combination with <code>TLEngine</code> allows one to "circumvent" the current thread local context, as in this example where a single statement issues data to the database externally to the current transaction:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">begin</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"insert into users values (?, ?)"</span><span class="python_operator">, </span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_literal">"john"</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">update</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_number">5</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">rollback</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>In the above example, a thread-local transaction is begun, but is later rolled back.  The statement <code>insert into users values (?, ?)</code> is executed without using a connection, therefore uses the thread-local transaction.  So its data is rolled back when the transaction is rolled back.  However, the <code>users.update()</code> statement is executed using a distinct <code>Connection</code> returned by the <code>engine.connect()</code> method, so it therefore is not part of the threadlocal transaction; it autocommits immediately.
</p>



            <a href="#dbengine" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="dbengine_logging"></a>
    
    <div class="sectionL2">

    <h3>Configuring Logging</h3>
    
    

<p>As of the 0.3 series of SQLAlchemy, Python's standard <a href='http://www.python.org/doc/lib/module-logging.html'>logging</a> module is used to implement informational and debug log output.  This allows SQLAlchemy's logging to integrate in a standard way with other applications and libraries.  The <code>echo</code> and <code>echo_pool</code> flags that are present on <code>create_engine()</code>, as well as the <code>echo_uow</code> flag used on <code>Session</code>, all interact with regular loggers.
</p>
<p>This section assumes familiarity with the above linked logging module.  All logging performed by SQLAlchemy exists underneath the <code>sqlalchemy</code> namespace, as used by <code>logging.getLogger('sqlalchemy')</code>.  When logging has been configured (i.e. such as via <code>logging.basicConfig()</code>), the general namespace of SA loggers that can be turned on is as follows:
</p>
<ul>
 <li>
     <code>sqlalchemy.engine</code> - controls SQL echoing.  set to <code>logging.INFO</code> for SQL query output, <code>logging.DEBUG</code> for query + result set output.
 </li>

 <li>
     <code>sqlalchemy.pool</code> - controls connection pool logging.  set to <code>logging.INFO</code> or lower to log connection pool checkouts/checkins.
 </li>

 <li>
     <code>sqlalchemy.orm</code> - controls logging of various ORM functions.  set to <code>logging.INFO</code> for configurational logging as well as unit of work dumps, <code>logging.DEBUG</code> for extensive logging during query and flush() operations.  Subcategories of <code>sqlalchemy.orm</code> include:<ul>
 <li>
     <code>sqlalchemy.orm.attributes</code> - logs certain instrumented attribute operations, such as triggered callables
 </li>

 <li>
     <code>sqlalchemy.orm.mapper</code> - logs Mapper configuration and operations
 </li>

 <li>
     <code>sqlalchemy.orm.unitofwork</code> - logs flush() operations, including dependency sort graphs and other operations
 </li>

 <li>
     <code>sqlalchemy.orm.strategies</code> - logs relation loader operations (i.e. lazy and eager loads)
 </li>

 <li>
     <code>sqlalchemy.orm.sync</code> - logs synchronization of attributes from parent to child instances during a flush()
 </li>
</ul>

 </li>
</ul>
<p>For example, to log SQL queries as well as unit of work debugging:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">import </span><span class="python_name">logging</span><span class="python_operator">
</span>
<span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">basicConfig</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">getLogger</span><span class="python_enclosure">(</span><span class="python_literal">'sqlalchemy.engine'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">setLevel</span><span class="python_enclosure">(</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">INFO</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">getLogger</span><span class="python_enclosure">(</span><span class="python_literal">'sqlalchemy.orm.unitofwork'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">setLevel</span><span class="python_enclosure">(</span><span class="python_name">logging</span><span class="python_operator">.</span><span class="python_name">DEBUG</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>By default, the log level is set to <code>logging.ERROR</code> within the entire <code>sqlalchemy</code> namespace so that no log operations occur, even within an application that has logging enabled otherwise.
</p>
<p>The <code>echo</code> flags present as keyword arguments to <code>create_engine()</code> and others as well as the <code>echo</code> property on <code>Engine</code>, when set to <code>True</code>, will first attempt to ensure that logging is enabled.  Unfortunately, the <code>logging</code> module provides no way of determining if output has already been configured (note we are referring to if a logging configuration has been set up, not just that the logging level is set).  For this reason, any <code>echo=True</code> flags will result in a call to <code>logging.basicConfig()</code> using sys.stdout as the destination.  It also sets up a default format using the level name, timestamp, and logger name.  Note that this configuration has the affect of being configured <strong>in addition</strong> to any existing logger configurations.  Therefore, <strong>when using Python logging, ensure all echo flags are set to False at all times</strong>, to avoid getting duplicate log lines.
</p>




            <a href="#dbengine" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="metadata"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#dbengine">Database Engines</a>

               |   
            Next: <a href="#types">The Types System</a>
    </div>

        <h2>Database Meta Data</h2>
    </div>


        








    
    <A name="metadata"></a>
    
    <div class="sectionL1">

    
    



    
    <A name="metadata_tables"></a>
    
    <div class="sectionL2">

    <h3>Describing Databases with MetaData</h3>
    
    

<p>The core of SQLAlchemy's query and object mapping operations are supported by <strong>database metadata</strong>, which is comprised of Python objects that describe tables and other schema-level objects.  These objects can be created by explicitly naming the various components and their properties, using the Table, Column, ForeignKey, Index, and Sequence objects imported from <code>sqlalchemy.schema</code>.  There is also support for <strong>reflection</strong> of some entities, which means you only specify the <em>name</em> of the entities and they are recreated from the database automatically.
</p>
<p>A collection of metadata entities is stored in an object aptly named <code>MetaData</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy </span><span class="python_keyword">import </span><span class="python_operator">*
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>To represent a Table, use the <code>Table</code> class:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The specific datatypes for each Column, such as Integer, String, etc. are described in <a href="#types">The Types System</a>, and exist within the module <code>sqlalchemy.types</code> as well as the global <code>sqlalchemy</code> namespace.
</p>
<p>Foreign keys are most easily specified by the <code>ForeignKey</code> object within a <code>Column</code> object.  For a composite foreign key, i.e. a foreign key that contains multiple columns referencing multiple columns to a composite primary key, an explicit syntax is provided which allows the correct table CREATE statements to be generated:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># a table with a composite primary key
</span><span class="python_name">invoices </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoices'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'description'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># a table with a composite foreign key referencing the parent table
</span><span class="python_name">invoice_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_items'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'item_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ref_num'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'ref_num'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'invoices.invoice_id'</span><span class="python_operator">, </span><span class="python_literal">'invoices.ref_num'</span><span class="python_enclosure">])</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the <code>invoice_items</code> table will have <code>ForeignKey</code> objects automatically added to the <code>invoice_id</code> and <code>ref_num</code> <code>Column</code> objects as a result of the additional <code>ForeignKeyConstraint</code> object.
</p>
<p>The <code>MetaData</code> object supports some handy methods, such as getting a list of Tables in the order (or reverse) of their dependency:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">for </span><span class="python_name">t </span><span class="python_keyword">in </span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">table_iterator</span><span class="python_enclosure">(</span><span class="python_name">reverse</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">:
...    </span><span class="python_keyword">print </span><span class="python_name">t</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">users</span><span class="python_operator">
</span><span class="python_name">user_prefs</span><span class="python_operator">
</span></pre>
    </div>
<p>And <code>Table</code> provides an interface to the table's properties as well as that of its columns:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># access the column "EMPLOYEE_ID":
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># or just
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">
</span>
<span class="python_comment"># via string
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_enclosure">[</span><span class="python_literal">'employee_id'</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
<span class="python_comment"># iterate through all columns
</span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's primary key columns
</span><span class="python_keyword">for </span><span class="python_name">primary_key </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># get the table's foreign key objects:
</span><span class="python_keyword">for </span><span class="python_name">fkey </span><span class="python_keyword">in </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">foreign_keys</span><span class="python_operator">:
    </span><span class="python_comment"># ...
</span>
<span class="python_comment"># access the table's MetaData:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">
</span>
<span class="python_comment"># access the table's bound Engine or Connection, if its MetaData is bound:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">bind</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's name, type, nullable, primary key, foreign key
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">nullable</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">primary_key</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">
</span>
<span class="python_comment"># get the "key" of a column, which defaults to its name, but can 
# be any user-defined string:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">key</span><span class="python_operator">
</span>
<span class="python_comment"># access a column's table:
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_id</span><span class="python_operator">.</span><span class="python_name">table </span><span class="python_keyword">is </span><span class="python_name">employees</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">True</span><span class="python_operator">
</span>
<span class="python_comment"># get the table related by a foreign key
</span><span class="python_name">fcolumn </span><span class="python_operator">= </span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">employee_dept</span><span class="python_operator">.</span><span class="python_name">foreign_key</span><span class="python_operator">.</span><span class="python_name">column</span><span class="python_operator">.</span><span class="python_name">table</span><span class="python_operator">
</span></pre>
    </div>


    
    <A name="metadata_tables_binding"></a>
    
    <div class="sectionL3">

    <h3>Binding MetaData to an Engine or Connection</h3>
    
    

<p>A <code>MetaData</code> object can be associated with an <code>Engine</code> or an individual <code>Connection</code>; this process is called <strong>binding</strong>.  The term used to describe "an engine or a connection" is often referred to as a <strong>connectable</strong>.  Binding allows the <code>MetaData</code> and the elements which it contains to perform operations against the database directly, using the connection resources to which it's bound.   Common operations which are made more convenient through binding include being able to generate SQL constructs which know how to execute themselves, creating <code>Table</code> objects which query the database for their column and constraint information, and issuing CREATE or DROP statements.
</p>
<p>To bind <code>MetaData</code> to an <code>Engine</code>, use the <code>bind</code> attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_operator">, **</span><span class="python_name">kwargs</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create MetaData 
</span><span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># bind to an engine
</span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">
</span></pre>
    </div>
<p>Once this is done, the <code>MetaData</code> and its contained <code>Table</code> objects can access the database directly:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">()  </span><span class="python_comment"># issue CREATE statements for all tables</span><span class="python_operator">
</span>
<span class="python_comment"># describe a table called 'users', query the database for its columns
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># generate a SELECT statement and execute
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that the feature of binding engines is <strong>completely optional</strong>.  All of the operations which take advantage of "bound" <code>MetaData</code> also can be given an <code>Engine</code> or <code>Connection</code> explicitly with which to perform the operation.   The equivalent "non-bound" of the above would be:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)  </span><span class="python_comment"># issue CREATE statements for all tables</span><span class="python_operator">
</span>
<span class="python_comment"># describe a table called 'users',  query the database for its columns
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">autoload_with</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># generate a SELECT statement and execute
</span><span class="python_name">result </span><span class="python_operator">= </span><span class="python_name">engine</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">())</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_tables_reflecting"></a>
    
    <div class="sectionL3">

    <h3>Reflecting Tables</h3>
    
    

<p>A <code>Table</code> object can be created without specifying any of its contained attributes, using the argument <code>autoload=True</code> in conjunction with the table's name and possibly its schema (if not the databases "default" schema).  (You can also specify a list or set of column names to autoload as the kwarg include_columns, if you only want to load a subset of the columns in the actual database.)  This will issue the appropriate queries to the database in order to locate all properties of the table required for SQLAlchemy to use it effectively, including its column names and datatypes, foreign and primary key constraints, and in some cases its default-value generating attributes.   To use <code>autoload=True</code>, the table's <code>MetaData</code> object need be bound to an <code>Engine</code> or <code>Connection</code>, or alternatively the <code>autoload_with=&lt;some connectable&gt;</code> argument can be passed.  Below we illustrate autoloading a table and then iterating through the names of its columns:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">messages </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'messages'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_enclosure">[</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_keyword">for </span><span class="python_name">c </span><span class="python_keyword">in </span><span class="python_name">messages</span><span class="python_operator">.</span><span class="python_name">columns</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'message_id'</span><span class="python_operator">, </span><span class="python_literal">'message_name'</span><span class="python_operator">, </span><span class="python_literal">'date'</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that if a reflected table has a foreign key referencing another table, the related <code>Table</code> object  will be automatically created within the <code>MetaData</code> object if it does not exist already.  Below, suppose table <code>shopping_cart_items</code> references a table <code>shopping_carts</code>.  After reflecting, the <code>shopping carts</code> table is present:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">shopping_cart_items </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_cart_items'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; 'shopping_carts' </span><span class="python_keyword">in </span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">tables</span><span class="python_operator">:
</span><span class="python_name">True</span><span class="python_operator">
</span></pre>
    </div>
<p>To get direct access to 'shopping_carts', simply instantiate it via the <code>Table</code> constructor.  <code>Table</code> uses a special constructor that will return the already created <code>Table</code> instance if it's already present:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">shopping_carts </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'shopping_carts'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Of course, it's a good idea to use <code>autoload=True</code> with the above table regardless.  This is so that if it hadn't been loaded already, the operation will load the table.  The autoload operation only occurs for the table if it hasn't already been loaded; once loaded, new calls to <code>Table</code> will not re-issue any reflection queries.
</p>

    
    <A name="metadata_tables_reflecting_overriding"></a>
    
    <div class="sectionL4">

    <h3>Overriding Reflected Columns</h3>
    
    
<p>Individual columns can be overridden with explicit values when reflecting tables; this is handy for specifying custom datatypes, constraints such as primary keys that may not be configured within the database, etc.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,   </span><span class="python_comment"># override reflected 'id' to have primary key</span>
<span class="python_operator">... </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'mydata'</span><span class="python_operator">, </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">,    </span><span class="python_comment"># override reflected 'mydata' to be Unicode</span>
<span class="python_operator">... </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_tables_schema"></a>
    
    <div class="sectionL3">

    <h3>Specifying the Schema Name</h3>
    
    

<p>Some databases support the concept of multiple schemas.  A <code>Table</code> can reference this by specifying the <code>schema</code> keyword argument:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">financial_info </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'financial_info'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">schema</span><span class="python_operator">=</span><span class="python_literal">'remote_banks'</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Within the <code>MetaData</code> collection, this table will be identified by the combination of <code>financial_info</code> and <code>remote_banks</code>.  If another table called <code>financial_info</code> is referenced without the <code>remote_banks</code> schema, it will refer to a different <code>Table</code>.  <code>ForeignKey</code> objects can reference columns in this table using the form <code>remote_banks.financial_info.id</code>.
</p>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_tables_onupdate"></a>
    
    <div class="sectionL3">

    <h3>ON UPDATE and ON DELETE</h3>
    
    

<p><code>ON UPDATE</code> and <code>ON DELETE</code> clauses to a table create are specified within the <code>ForeignKeyConstraint</code> object, using the <code>onupdate</code> and <code>ondelete</code> keyword arguments:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">foobar </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foobar'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'lala'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'lala'</span><span class="python_enclosure">]</span><span class="python_operator">,</span><span class="python_enclosure">[</span><span class="python_literal">'hoho.lala'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_operator">, </span><span class="python_name">ondelete</span><span class="python_operator">=</span><span class="python_literal">"CASCADE"</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that these clauses are not supported on SQLite, and require <code>InnoDB</code> tables when used with MySQL.  They may also not be supported on other databases.
</p>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_tables_options"></a>
    
    <div class="sectionL3">

    <h3>Other Options</h3>
    
    

<p><code>Tables</code> may support database-specific options, such as MySQL's <code>engine</code> option that can specify "MyISAM", "InnoDB", and other backends for the table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'engine_email_addresses'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'address_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'remote_user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">mysql_engine</span><span class="python_operator">=</span><span class="python_literal">'InnoDB'</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_creating"></a>
    
    <div class="sectionL2">

    <h3>Creating and Dropping Database Tables</h3>
    
    

<p>Creating and dropping individual tables can be done via the <code>create()</code> and <code>drop()</code> methods of <code>Table</code>; these methods take an optional <code>bind</code> parameter which references an <code>Engine</code> or a <code>Connection</code>.  If not supplied, the <code>Engine</code> bound to the <code>MetaData</code> will be used, else an error is raised:
</p>

    

    <div class="code">
        <pre>
<span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">meta</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_operator">
</span>
<span class="python_name">employees </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'employees'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'name'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'employee_dept'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"departments.department_id"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal"><a href="javascript:togglePopbox('popbox_85', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator"></span></pre><div id="popbox_85_div" class="codepop" style="display:none;">CREATE TABLE employees(<br/>
employee_id SERIAL NOT NULL PRIMARY KEY,<br/>
employee_name VARCHAR(60) NOT NULL,<br/>
employee_dept INTEGER REFERENCES departments(department_id)<br/>
)<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p><code>drop()</code> method:
</p>

    

    <div class="code">
        <pre>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_86', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_86_div" class="codepop" style="display:none;">DROP TABLE employees<br/>
{}</div><pre><span class="python_operator"></span></pre>
    </div>
<p>The <code>create()</code> and <code>drop()</code> methods also support an optional keyword argument <code>checkfirst</code> which will issue the database's appropriate pragma statements to check if the table exists before creating or dropping:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">e</span><span class="python_operator">, </span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">employees</span><span class="python_operator">.</span><span class="python_name">drop</span><span class="python_enclosure">(</span><span class="python_name">checkfirst</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Entire groups of Tables can be created and dropped directly from the <code>MetaData</code> object with <code>create_all()</code> and <code>drop_all()</code>.  These methods always check for the existence of each table before creating or dropping.  Each method takes an optional <code>bind</code> keyword argument which can reference an <code>Engine</code> or a <code>Connection</code>.  If no engine is specified, the underlying bound <code>Engine</code>,  if any, is used:
</p>

    

    <div class="code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///:memory:'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_name">users </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key </span><span class="python_operator">= </span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email_address'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">60</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">key</span><span class="python_operator">=</span><span class="python_literal">'email'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'password'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable </span><span class="python_operator">= </span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">user_prefs </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'user_prefs'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.user_id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'pref_value'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal"><a href="javascript:togglePopbox('popbox_87', 'show', 'hide')" class="codepoplink">sql</a></span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator"></span></pre><div id="popbox_87_div" class="codepop" style="display:none;">PRAGMA table_info(users){}<br/>
CREATE TABLE users(<br/>
        user_id INTEGER NOT NULL PRIMARY KEY, <br/>
        user_name VARCHAR(16) NOT NULL, <br/>
        email_address VARCHAR(60), <br/>
        password VARCHAR(20) NOT NULL<br/>
)<br/>
PRAGMA table_info(user_prefs){}<br/>
CREATE TABLE user_prefs(<br/>
        pref_id INTEGER NOT NULL PRIMARY KEY, <br/>
        user_id INTEGER NOT NULL REFERENCES users(user_id), <br/>
        pref_name VARCHAR(40) NOT NULL, <br/>
        pref_value VARCHAR(100)<br/>
)</div><pre><span class="python_operator"></span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_defaults"></a>
    
    <div class="sectionL2">

    <h3>Column Insert/Update Defaults</h3>
    
    

<p>SQLAlchemy includes several constructs which provide default values provided during INSERT and UPDATE statements.  The defaults may be provided as Python constants, Python functions, or SQL expressions, and the SQL expressions themselves may be "pre-executed", executed inline within the insert/update statement itself, or can be created as a SQL level "default" placed on the table definition itself.  A "default" value by definition is only invoked if no explicit value is passed into the INSERT or UPDATE statement.
</p>


    
    <A name="metadata_defaults_preexecute_functions"></a>
    
    <div class="sectionL3">

    <h3>Pre-Executed Python Functions</h3>
    
    

<p>The "default" keyword argument on Column can reference a Python value or callable which is invoked at the time of an insert:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># a function which counts upwards
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_number">0</span><span class="python_operator">
</span><span class="python_keyword">def </span><span class="python_name">mydefault</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">global </span><span class="python_name">i</span><span class="python_operator">
    </span><span class="python_name">i </span><span class="python_operator">+= </span><span class="python_number">1</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">i</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_comment"># function-based default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">mydefault</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a scalar default</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_literal">"default"</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Similarly, the "onupdate" keyword does the same thing for update statements:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">import </span><span class="python_name">datetime</span><span class="python_operator">
</span>
<span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'last_updated' to be populated with datetime.now()</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_updated'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">datetime</span><span class="python_operator">.</span><span class="python_name">datetime</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_defaults_sqlexpression"></a>
    
    <div class="sectionL3">

    <h3>Pre-executed and Inline SQL Expressions</h3>
    
    

<p>The "default" and "onupdate" keywords may also be passed SQL expressions, including select statements or direct function calls:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"mytable"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'create_date' to default to now()</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'create_date'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">())</span><span class="python_operator">,</span>

    <span class="python_comment"># define 'key' to pull its default from the 'keyvalues' table</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'key'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">keyvalues</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">type</span><span class="python_operator">=</span><span class="python_literal">'type1'</span><span class="python_operator">, </span><span class="python_name">limit</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">))</span>

    <span class="python_comment"># define 'last_modified' to use the current_timestamp SQL function on update</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_modified'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">func</span><span class="python_operator">.</span><span class="python_name">current_timestamp</span><span class="python_enclosure">())</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The above SQL functions are usually executed "inline" with the INSERT or UPDATE statement being executed.  In some cases, the function is "pre-executed" and its result pre-fetched explicitly.  This happens under the following circumstances:
</p>
<ul>
 <li><p>the column is a primary key column
</p>

 </li>

 <li><p>the database dialect does not support a usable <code>cursor.lastrowid</code> accessor (or equivalent); this currently includes Postgres, Oracle, and Firebird.
</p>

 </li>

 <li><p>the statement is a single execution, i.e. only supplies one set of parameters and doesn't use "executemany" behavior
</p>

 </li>

 <li><p>the <code>inline=True</code> flag is not set on the <code>Insert()</code> or <code>Update()</code> construct.
</p>

 </li>
</ul>
<p>For a statement execution which is not an executemany, the returned <code>ResultProxy</code> will contain a collection accessible via <code>result.postfetch_cols()</code> which contains a list of all <code>Column</code> objects which had an inline-executed default.  Similarly, all parameters which were bound to the statement, including all Python and SQL expressions which were pre-executed, are present in the <code>last_inserted_params()</code> or <code>last_updated_params()</code> collections on <code>ResultProxy</code>.  The <code>last_inserted_ids()</code> collection contains a list of primary key values for the row inserted.  <br></br>
</p>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_defaults_passive"></a>
    
    <div class="sectionL3">

    <h3>DDL-Level Defaults</h3>
    
    

<p>A variant on a SQL expression default is the <code>server_default</code>, which gets placed in the CREATE TABLE statement during a <code>create()</code> operation:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'abc'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">server_default</span><span class="python_operator">=</span><span class="python_literal">'abc'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'created_at'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">server_default</span><span class="python_operator">=</span><span class="python_name">text</span><span class="python_enclosure">(</span><span class="python_literal">"sysdate"</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>A create call for the above table will produce:
</p>

    

    <div class="sliding_code">
        <pre>
CREATE TABLE test (
    abc varchar(20) default 'abc',
    created_at datetime default sysdate
)
</pre>
    </div>
<p>The behavior of <code>server_default</code> is similar to that of a regular SQL default; if it's placed on a primary key column for a database which doesn't have a way to "postfetch" the ID, and the statement is not "inlined", the SQL expression is pre-executed; otherwise, SQLAlchemy lets the default fire off on the database side normally.
</p>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_defaults_triggered"></a>
    
    <div class="sectionL3">

    <h3>Triggered Columns</h3>
    
    

<p>Columns with values set by a database trigger or other external process may be called out with a marker:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">t </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'abc'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">server_default</span><span class="python_operator">=</span><span class="python_name">FetchedValue</span><span class="python_enclosure">())</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'def'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">20</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">server_onupdate</span><span class="python_operator">=</span><span class="python_name">FetchedValue</span><span class="python_enclosure">())</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>These markers do not emit a <code>default</code> clause when the table is created, however they do set the same internal flags as a static <code>server_default</code> clause, providing hints to higher-level tools that a "post-fetch" of these rows should be performed after an insert or update.
</p>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_defaults_sequences"></a>
    
    <div class="sectionL3">

    <h3>Defining Sequences</h3>
    
    

<p>A table with a sequence looks like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"cartitems"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">, </span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"cart_id"</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">Sequence</span><span class="python_enclosure">(</span><span class="python_literal">'cart_id_seq'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"description"</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">40</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">"createdate"</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_enclosure">())</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Sequence</code> object works a lot like the <code>default</code> keyword on <code>Column</code>, except that it only takes effect on a database which supports sequences.  When used with a database that does not support sequences, the <code>Sequence</code> object has no effect; therefore it's safe to place on a table which is used against multiple database backends.  The same rules for pre- and inline execution apply.
</p>
<p>When the <code>Sequence</code> is associated with a table, CREATE and DROP statements issued for that table will also issue CREATE/DROP for the sequence object as well, thus "bundling" the sequence object with its parent table.
</p>
<p>The flag <code>optional=True</code> on <code>Sequence</code> will produce a sequence that is only used on databases which have no "autoincrementing" capability.  For example, Postgres supports primary key generation using the SERIAL keyword, whereas Oracle has no such capability.  Therefore, a <code>Sequence</code> placed on a primary key column with <code>optional=True</code> will only be used with an Oracle backend but not Postgres.
</p>
<p>A sequence can also be executed standalone, using an <code>Engine</code> or <code>Connection</code>, returning its next value in a database-independent fashion:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">seq </span><span class="python_operator">= </span><span class="python_name">Sequence</span><span class="python_enclosure">(</span><span class="python_literal">'some_sequence'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">nextid </span><span class="python_operator">= </span><span class="python_name">connection</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_name">seq</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_constraints"></a>
    
    <div class="sectionL2">

    <h3>Defining Constraints and Indexes</h3>
    
    



    
    <A name="metadata_constraints_unique"></a>
    
    <div class="sectionL3">

    <h3>UNIQUE Constraint</h3>
    
    

<p>Unique constraints can be created anonymously on a single column using the <code>unique</code> keyword on <code>Column</code>.  Explicitly named unique constraints and/or those with multiple columns are created via the <code>UniqueConstraint</code> table-level construct.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column anonymous unique constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># explicit/composite unique constraint.  'name' is optional.</span>
    <span class="python_name">UniqueConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'uix_1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_constraints_check"></a>
    
    <div class="sectionL3">

    <h3>CHECK Constraint</h3>
    
    

<p>Check constraints can be named or unnamed and can be created at the Column or Table level, using the <code>CheckConstraint</code> construct.  The text of the check constraint is passed directly through to the database, so there is limited "database independent" behavior.  Column level check constraints generally should only refer to the column to which they are placed, while table level constraints can refer to any columns in the table.
</p>
<p>Note that some databases do not actively support check constraints such as MySQL and SQLite.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>

    <span class="python_comment"># per-column CHECK constraint</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col1&gt;5'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># table level CHECK constraint.  'name' is optional.</span>
    <span class="python_name">CheckConstraint</span><span class="python_enclosure">(</span><span class="python_literal">'col2 &gt; col3 + 5'</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'check1'</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>



    
    <A name="metadata_constraints_indexes"></a>
    
    <div class="sectionL3">

    <h3>Indexes</h3>
    
    

<p>Indexes can be created anonymously (using an auto-generated name "ix_<column label>") for a single column using the inline <code>index</code> keyword on <code>Column</code>, which also modifies the usage of <code>unique</code> to apply the uniqueness to the index itself, instead of adding a separate UNIQUE constraint.  For indexes with specific names or which encompass more than one column, use the <code>Index</code> construct, which requires a name.  <br></br>
</p>
<p>Note that the <code>Index</code> construct is created <strong>externally</strong> to the table which it corresponds, using <code>Column</code> objects and not strings.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">meta </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_comment"># an indexed column, with index "ix_mytable_col1"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col1'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_comment"># a uniquely indexed column with index "ix_mytable_col2"</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col2'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">index</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col3'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col4'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>

    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col5'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'col6'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place an index on col3, col4
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'idx_col34'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col3</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col4</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># place a unique index on col5, col6
</span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'myindex'</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_operator">, </span><span class="python_name">mytable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col6</span><span class="python_operator">, </span><span class="python_name">unique</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Index</code> objects will be created along with the CREATE statements for the table itself.  An index can also be created on its own independently of the table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># create a table
</span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># define an index
</span><span class="python_name">i </span><span class="python_operator">= </span><span class="python_name">Index</span><span class="python_enclosure">(</span><span class="python_literal">'someindex'</span><span class="python_operator">, </span><span class="python_name">sometable</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">col5</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the index, will use the table's bound connectable if the `bind` keyword argument not specified
</span><span class="python_name">i</span><span class="python_operator">.</span><span class="python_name">create</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#metadata" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="metadata_adapting"></a>
    
    <div class="sectionL2">

    <h3>Adapting Tables to Alternate Metadata</h3>
    
    

<p>A <code>Table</code> object created against a specific <code>MetaData</code> object can be re-created against a new MetaData using the <code>tometadata</code> method:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_comment"># create two metadata
</span><span class="python_name">meta1 </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///querytest.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">meta2 </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_comment"># load 'users' from the sqlite engine
</span><span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">meta1</span><span class="python_operator">, </span><span class="python_name">autoload</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># create the same Table object for the plain metadata
</span><span class="python_name">users_table_2 </span><span class="python_operator">= </span><span class="python_name">users_table</span><span class="python_operator">.</span><span class="python_name">tometadata</span><span class="python_enclosure">(</span><span class="python_name">meta2</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>




            <a href="#metadata" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="types"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#metadata">Database Meta Data</a>

               |   
            Next: <a href="#pooling">Connection Pooling</a>
    </div>

        <h2>The Types System</h2>
    </div>


        








    
    <A name="types"></a>
    
    <div class="sectionL1">

    
    

<p>The package <code>sqlalchemy.types</code> defines the datatype identifiers which may be used when defining <b>metadata</b>.  This package includes a set of generic types, a set of SQL-specific subclasses of those types, and a small extension system used by specific database connectors to adapt these generic types into database-specific type objects.
</p>


    
    <A name="types_standard"></a>
    
    <div class="sectionL2">

    <h3>Built-in Types</h3>
    
    

<p>SQLAlchemy comes with a set of standard generic datatypes, which are defined as classes.  Types are usually used when defining tables, and can be left as a class or instantiated, for example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mytable </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'mytable'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'myid'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">30</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'info'</span><span class="python_operator">, </span><span class="python_name">Unicode</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'value'</span><span class="python_operator">, </span><span class="python_name">Number</span><span class="python_enclosure">(</span><span class="python_number">7</span><span class="python_operator">,</span><span class="python_number">4</span><span class="python_enclosure">)) </span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Following is a rundown of the standard types.
</p>


    
    <A name="types_standard_string"></a>
    
    <div class="sectionL3">

    <h3>String</h3>
    
    

<p>This type is the base type for all string and character types, such as <code>Unicode</code>, <code>TEXT</code>, <code>CLOB</code>, etc.  By default it generates a VARCHAR in DDL.  It includes an argument <code>length</code>, which indicates the length in characters of the type, as well as <code>convert_unicode</code> and <code>assert_unicode</code>, which are booleans.  <code>length</code> will be used as the length argument when generating DDL.  If <code>length</code> is omitted, the <code>String</code> type resolves into the <code>TEXT</code> type.
</p>
<p><code>convert_unicode=True</code> indicates that incoming strings, if they are Python <code>unicode</code> strings, will be encoded into a raw bytestring using the <code>encoding</code> attribute of the dialect (defaults to <code>utf-8</code>).  Similarly, raw bytestrings coming back from the database will be decoded into <code>unicode</code> objects on the way back.
</p>
<p><code>assert_unicode</code> is set to <code>None</code> by default. When <code>True</code>, it indicates that incoming bind parameters will be checked that they are in fact  <code>unicode</code> objects, else an error is raised.  A value of <code>'warn'</code> instead raises a warning.  Setting it to <code>None</code> indicates that the dialect-level <code>convert_unicode</code> setting should take place, whereas setting it to <code>False</code> disables it unconditionally  (this flag is new as of version 0.4.2).
</p>
<p>Both <code>convert_unicode</code> and <code>assert_unicode</code> may be set at the engine level as flags to <code>create_engine()</code>.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_unicode"></a>
    
    <div class="sectionL3">

    <h3>Unicode</h3>
    
    

<p>The <code>Unicode</code> type is shorthand for <code>String</code> with <code>convert_unicode=True</code> and <code>assert_unicode='warn'</code>.  When writing a Unicode-aware application, it is strongly recommended that this type is used, and that only Unicode strings are used in the application.  By "Unicode string" we mean a string with a u, i.e. <code>u'hello'</code>.  Otherwise, particularly when using the ORM, data will be converted to Unicode when it returns from the database, but local data which was generated locally will not be in Unicode format, which can create confusion.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_text"></a>
    
    <div class="sectionL3">

    <h3>Text / UnicodeText</h3>
    
    

<p>These are the "unbounded" versions of <code>String</code> and <code>Unicode</code>.  They have no "length" parameter, and generate a column type of TEXT or CLOB.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_numeric"></a>
    
    <div class="sectionL3">

    <h3>Numeric</h3>
    
    

<p>Numeric types return <code>decimal.Decimal</code> objects by default.  The flag <code>asdecimal=False</code> may be specified which enables the type to pass data straight through.   Numeric also takes "precision" and "scale" arguments which are used when CREATE TABLE is issued.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_float"></a>
    
    <div class="sectionL3">

    <h3>Float</h3>
    
    

<p>Float types return Python floats.  Float also takes a "precision" argument which is used when CREATE TABLE is issued.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_datetime/date/time"></a>
    
    <div class="sectionL3">

    <h3>DateTime/Date/Time</h3>
    
    

<p>Date and time types return objects from the Python <code>datetime</code> module.  Most DBAPIs have built in support for the datetime module, with the noted exception of SQLite.  In the case of SQLite, date and time types are stored as strings which are then converted back to datetime objects when rows are returned.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_interval"></a>
    
    <div class="sectionL3">

    <h3>Interval</h3>
    
    

<p>The Interval type deals with <code>datetime.timedelta</code> objects.  In PostgreSQL, the native INTERVAL type is used; for others, the value is stored as a date which is relative to the "epoch" (Jan. 1, 1970).
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_binary"></a>
    
    <div class="sectionL3">

    <h3>Binary</h3>
    
    

<p>The Binary type generates BLOB or BYTEA when tables are created, and also converts incoming values using the <code>Binary</code> callable provided by each DBAPI.  <br></br>
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_boolean"></a>
    
    <div class="sectionL3">

    <h3>Boolean</h3>
    
    

<p>Boolean typically uses BOOLEAN or SMALLINT on the CREATE TABLE side, and returns Python <code>True</code> or <code>False</code>.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_pickletype"></a>
    
    <div class="sectionL3">

    <h3>PickleType</h3>
    
    

<p>PickleType builds upon the Binary type to apply Python's <code>pickle.dumps()</code> to incoming objects, and <code>pickle.loads()</code> on the way out, allowing any pickleable Python object to be stored as a serialized binary field.
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_standard_sqlspecific"></a>
    
    <div class="sectionL3">

    <h3>SQL-Specific Types</h3>
    
    

<p>These are subclasses of the generic types and include:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">FLOAT</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TEXT</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DECIMAL</span><span class="python_enclosure">(</span><span class="python_name">Numeric</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">INT</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">INTEGER </span><span class="python_operator">= </span><span class="python_name">INT</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">TIMESTAMP</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">DATETIME</span><span class="python_enclosure">(</span><span class="python_name">DateTime</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CLOB</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">VARCHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">CHAR</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BLOB</span><span class="python_enclosure">(</span><span class="python_name">Binary</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">class </span><span class="python_name">BOOLEAN</span><span class="python_enclosure">(</span><span class="python_name">Boolean</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The idea behind the SQL-specific types is that a CREATE TABLE statement would generate the exact type specified.  <br></br>
</p>



            <a href="#types" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="types_dialect"></a>
    
    <div class="sectionL2">

    <h3>Dialect Specific Types</h3>
    
    

<p>Each dialect has its own set of types, many of which are available only within that dialect.  For example, MySQL has a <code>BigInteger</code> type and PostgreSQL has an <code>Inet</code> type.  To use these, import them from the module explicitly:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">databases</span><span class="python_operator">.</span><span class="python_name">mysql </span><span class="python_keyword">import </span><span class="python_name">MSEnum</span><span class="python_operator">, </span><span class="python_name">MSBigInteger</span><span class="python_operator">
</span>
<span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'enumerates'</span><span class="python_operator">, </span><span class="python_name">MSEnum</span><span class="python_enclosure">(</span><span class="python_literal">'a'</span><span class="python_operator">, </span><span class="python_literal">'b'</span><span class="python_operator">, </span><span class="python_literal">'c'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">MSBigInteger</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Or some PostgreSQL types:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">databases</span><span class="python_operator">.</span><span class="python_name">postgres </span><span class="python_keyword">import </span><span class="python_name">PGInet</span><span class="python_operator">, </span><span class="python_name">PGArray</span><span class="python_operator">
</span>
<span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'ipaddress'</span><span class="python_operator">, </span><span class="python_name">PGInet</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'elements'</span><span class="python_operator">, </span><span class="python_name">PGArray</span><span class="python_enclosure">(</span><span class="python_name">str</span><span class="python_enclosure">))   </span><span class="python_comment"># PGArray is available in 0.4, and takes a type argument</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#types" class="totoc">back to section top</a>
    </div>



    
    <A name="types_custom"></a>
    
    <div class="sectionL2">

    <h3>Creating your Own Types</h3>
    
    

<p>User-defined types can be created which can augment the bind parameter and result processing capabilities of the built in types.  This is usually achieved using the <code>TypeDecorator</code> class, which "decorates" the behavior of any existing type.  As of version 0.4.2, the new <code>process_bind_param()</code> and <code>process_result_value()</code> methods should be used:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types </span><span class="python_keyword">as </span><span class="python_name">types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeDecorator</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""a type that decorates Unicode, prefixes values with "PREFIX:" on 
    the way in and strips it off on the way out."""</span><span class="python_operator">
</span>
    <span class="python_name">impl </span><span class="python_operator">= </span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">Unicode</span><span class="python_operator">
</span>
    <span class="python_keyword">def </span><span class="python_name">process_bind_param</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">dialect</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"PREFIX:" </span><span class="python_operator">+ </span><span class="python_name">value</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">process_result_value</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">value</span><span class="python_operator">, </span><span class="python_name">dialect</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_enclosure">[</span><span class="python_number">7</span><span class="python_operator">:</span><span class="python_enclosure">]</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">copy</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">impl</span><span class="python_operator">.</span><span class="python_name">length</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p><code>TypeDecorator</code> should generally be used for any user-defined type which redefines the behavior of another type, including other <code>TypeDecorator</code> subclasses such as <code>PickleType</code>, and the new <code>process_...()</code> methods described above should be used.
</p>
<p>To build a type object from scratch, which will not have a corresponding database-specific implementation, subclass <code>TypeEngine</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">types </span><span class="python_keyword">as </span><span class="python_name">types</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_name">types</span><span class="python_operator">.</span><span class="python_name">TypeEngine</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_number">8</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision </span><span class="python_operator">= </span><span class="python_name">precision</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">get_col_spec</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">"MYTYPE(%s)" </span><span class="python_operator">% </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">precision</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">bind_processor</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">dialect</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">def </span><span class="python_name">process</span><span class="python_enclosure">(</span><span class="python_name">value</span><span class="python_enclosure">)</span><span class="python_operator">:
            </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">process</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_keyword">def </span><span class="python_name">result_processor</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">dialect</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">def </span><span class="python_name">process</span><span class="python_enclosure">(</span><span class="python_name">value</span><span class="python_enclosure">)</span><span class="python_operator">:
            </span><span class="python_keyword">return </span><span class="python_name">value</span><span class="python_operator">
        </span><span class="python_keyword">return </span><span class="python_name">process</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>bind_processor</code> and <code>result_processor</code> methods return a callable which will be used to process data at the bind parameter and result row level.  If either processing is not necessary, the method can return <code>None</code> (this reduces the workload as well).
</p>
<p>Once you make your type, it's immediately useable:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'foo'</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data'</span><span class="python_operator">, </span><span class="python_name">MyType</span><span class="python_enclosure">(</span><span class="python_number">16</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>




            <a href="#types" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="pooling"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#types">The Types System</a>

               |   
            Next: <a href="#plugins">Plugins</a>
    </div>

        <h2>Connection Pooling</h2>
    </div>


        








    
    <A name="pooling"></a>
    
    <div class="sectionL1">

    
    

<p>This section describes the connection pool module of SQLAlchemy.  The <code>Pool</code> object it provides is normally embedded within an <code>Engine</code> instance.  For most cases, explicit access to the pool module is not required.  However, the <code>Pool</code> object can be used on its own, without the rest of SA, to manage DBAPI connections; this section describes that usage.  Also, this section will describe in more detail how to customize the pooling strategy used by an <code>Engine</code>.
</p>
<p>At the base of any database helper library is a system of efficiently acquiring connections to the database.  Since the establishment of a database connection is typically a somewhat expensive operation, an application needs a way to get at database connections repeatedly without incurring the full overhead each time.  Particularly for server-side web applications, a connection pool is the standard way to maintain a "pool" of database connections which are used over and over again among many requests.  Connection pools typically are configured to maintain a certain "size", which represents how many connections can be used simultaneously without resorting to creating more newly-established connections.
</p>


    
    <A name="pooling_establishing"></a>
    
    <div class="sectionL2">

    <h3>Establishing a Transparent Connection Pool</h3>
    
    

<p>Any DBAPI module can be "proxied" through the connection pool using the following technique (note that the usage of 'psycopg2' is <strong>just an example</strong>; substitute whatever DBAPI module you'd like):
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool </span><span class="python_keyword">as </span><span class="python_name">pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2 </span><span class="python_keyword">as </span><span class="python_name">psycopg</span><span class="python_operator">
</span><span class="python_name">psycopg </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">manage</span><span class="python_enclosure">(</span><span class="python_name">psycopg</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># then connect normally
</span><span class="python_name">connection </span><span class="python_operator">= </span><span class="python_name">psycopg</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">database</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_operator">, </span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'scott'</span><span class="python_operator">, </span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'tiger'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>This produces a <code>sqlalchemy.pool.DBProxy</code> object which supports the same <code>connect()</code> function as the original DBAPI module.  Upon connection, a connection proxy object is returned, which delegates its calls to a real DBAPI connection object.  This connection object is stored persistently within a connection pool (an instance of <code>sqlalchemy.pool.Pool</code>) that corresponds to the exact connection arguments sent to the <code>connect()</code> function.  <br></br>
</p>
<p>The connection proxy supports all of the methods on the original connection object, most of which are proxied via <code>__getattr__()</code>.  The <code>close()</code> method will return the connection to the pool, and the <code>cursor()</code> method will return a proxied cursor object.  Both the connection proxy and the cursor proxy will also return the underlying connection to the pool after they have both been garbage collected, which is detected via the <code>__del__()</code> method.
</p>
<p>Additionally, when connections are returned to the pool, a <code>rollback()</code> is issued on the connection unconditionally.  This is to release any locks still held by the connection that may have resulted from normal activity.
</p>
<p>By default, the <code>connect()</code> method will return the same connection that is already checked out in the current thread.  This allows a particular connection to be used in a given thread without needing to pass it around between functions.  To disable this behavior, specify <code>use_threadlocal=False</code> to the <code>manage()</code> function.
</p>



            <a href="#pooling" class="totoc">back to section top</a>
    </div>



    
    <A name="pooling_configuration"></a>
    
    <div class="sectionL2">

    <h3>Connection Pool Configuration</h3>
    
    

<p>For all types of Pool construction, which includes the "transparent proxy" described in the previous section, using an <code>Engine</code> via <code>create_engine()</code>, or constructing a pool through direct class instantiation, the options are generally the same.  Additional options may be available based on the specific subclass of <code>Pool</code> being used.
</p>
<p>For a description of all pool classes, see the <a href="sqlalchemy_pool.html#docstrings_sqlalchemy.pool">generated documentation</a>.
</p>
<p>Common options include:
</p>
<ul>
 <li>
     echo=False : if set to True, connections being pulled and retrieved from/to the pool will
        be logged to the standard output, as well as pool sizing information.  Echoing can also
        be achieved by enabling logging for the "sqlalchemy.pool" namespace.  When using create_engine(), 
        this option is specified as <code>echo_pool</code>.
 </li>

 <li>
     use_threadlocal=False : if set to True, repeated calls to connect() within the same
        application thread will be guaranteed to return the same connection object, if one has
        already been retrieved from the pool and has not been returned yet. This allows code to
        retrieve a connection from the pool, and then while still holding on to that connection,
        to call other functions which also ask the pool for a connection of the same arguments;
        those functions will act upon the same connection that the calling method is using.
        This option is overridden during <code>create_engine()</code>, corresponding to the "plain" or 
   "threadlocal" connection strategy.
 </li>

 <li>
     recycle=-1 : if set to non -1, a number of seconds between connection recycling, which
        means upon checkout, if this timeout is surpassed the connection will be closed and replaced
        with a newly opened connection.
 </li>
</ul>
<p>QueuePool options include:
</p>
<ul>
 <li>
     pool_size=5 : the size of the pool to be maintained. This is the
      largest number of connections that will be kept persistently in the pool. Note that the
      pool begins with no connections; once this number of connections is requested, that
      number of connections will remain.
 </li>

 <li>
     max_overflow=10 : the maximum overflow size of the pool. When the number of checked-out
      connections reaches the size set in pool_size, additional connections will be returned up
      to this limit. When those additional connections are returned to the pool, they are
      disconnected and discarded. It follows then that the total number of simultaneous
      connections the pool will allow is pool_size + max_overflow, and the total number of
      "sleeping" connections the pool will allow is pool_size. max_overflow can be set to -1 to
      indicate no overflow limit; no limit will be placed on the total number of concurrent
      connections.
 </li>

 <li>
     timeout=30 : the number of seconds to wait before giving up on returning a connection
 </li>
</ul>



            <a href="#pooling" class="totoc">back to section top</a>
    </div>



    
    <A name="pooling_custom"></a>
    
    <div class="sectionL2">

    <h3>Custom Pool Construction</h3>
    
    

<p>Besides using the transparent proxy, instances of <code>sqlalchemy.pool.Pool</code> can be created directly.  Constructing your own pool involves passing a callable used to create a connection.  Through this method, custom connection schemes can be made, such as a connection that automatically executes some initialization commands to start.  <br></br>
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Constructing a QueuePool</div>
        <pre>
<span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool </span><span class="python_keyword">as </span><span class="python_name">pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">psycopg2</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_name">c </span><span class="python_operator">= </span><span class="python_name">psycopg2</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">username</span><span class="python_operator">=</span><span class="python_literal">'ed'</span><span class="python_operator">, </span><span class="python_name">host</span><span class="python_operator">=</span><span class="python_literal">'127.0.0.1'</span><span class="python_operator">, </span><span class="python_name">dbname</span><span class="python_operator">=</span><span class="python_literal">'test'</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_comment"># execute an initialization function on the connection before returning
    </span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">cursor</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">(</span><span class="python_literal">"setup_encodings()"</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">c</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">QueuePool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_operator">, </span><span class="python_name">max_overflow</span><span class="python_operator">=</span><span class="python_number">10</span><span class="python_operator">, </span><span class="python_name">pool_size</span><span class="python_operator">=</span><span class="python_number">5</span><span class="python_operator">, </span><span class="python_name">use_threadlocal</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Or with SingletonThreadPool:
</p>

    

    <div class="sliding_code">
            <div class="codetitle">Constructing a SingletonThreadPool</div>
        <pre>
<span class="python_keyword">import </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">pool </span><span class="python_keyword">as </span><span class="python_name">pool</span><span class="python_operator">
</span><span class="python_keyword">import </span><span class="python_name">sqlite</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">getconn</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">return </span><span class="python_name">sqlite</span><span class="python_operator">.</span><span class="python_name">connect</span><span class="python_enclosure">(</span><span class="python_name">filename</span><span class="python_operator">=</span><span class="python_literal">'myfile.db'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># SQLite connections require the SingletonThreadPool    
</span><span class="python_operator"></span><span class="python_name">p </span><span class="python_operator">= </span><span class="python_name">pool</span><span class="python_operator">.</span><span class="python_name">SingletonThreadPool</span><span class="python_enclosure">(</span><span class="python_name">getconn</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>




            <a href="#pooling" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="plugins"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="#pooling">Connection Pooling</a>

               |   
            Next: <a href="docstrings.html#docstrings">API Documentation</a>
    </div>

        <h2>Plugins</h2>
    </div>


        








    
    <A name="plugins"></a>
    
    <div class="sectionL1">

    
    

<p>SQLAlchemy has a variety of extensions available which provide extra functionality to SA, either via explicit usage or by augmenting the core behavior.  Several of these extensions are designed to work together.
</p>


    
    <A name="plugins_declarative"></a>
    
    <div class="sectionL2">

    <h3>declarative</h3>
    
    

<p><strong>Author:</strong> Mike Bayer<br></br>
   <strong>Version:</strong> 0.4.4 or greater
</p>
<p><code>declarative</code> intends to be a fully featured replacement for the very old <code>activemapper</code> extension.  Its goal is to redefine the organization of class, <code>Table</code>, and <code>mapper()</code> constructs such that they can all be defined "at once" underneath a class declaration.   Unlike <code>activemapper</code>, it does not redefine normal SQLAlchemy configurational semantics - regular <code>Column</code>, <code>relation()</code> and other schema or ORM constructs are used in almost all cases.
</p>
<p><code>declarative</code> is a so-called "micro declarative layer"; it does not generate table or column names and requires almost as fully verbose a configuration as that of straight tables and mappers.  As an alternative, the <a href='http://elixir.ematia.de/'>Elixir</a> project is a full community-supported declarative layer for SQLAlchemy, and is recommended for its active-record-like semantics, its convention-based configuration, and plugin capabilities.
</p>
<p>SQLAlchemy object-relational configuration involves the usage of Table, mapper(), and class objects to define the three areas of configuration.
   declarative moves these three types of configuration underneath the individual mapped class. Regular SQLAlchemy schema and ORM constructs are used
   in most cases:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">declarative </span><span class="python_keyword">import </span><span class="python_name">declarative_base</span><span class="python_operator">
</span>
<span class="python_name">Base </span><span class="python_operator">= </span><span class="python_name">declarative_base</span><span class="python_enclosure">()</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">SomeClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'some_table'</span><span class="python_operator">
    </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">name </span><span class="python_operator">=  </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, the <code>declarative_base</code> callable produces a new base class from which all mapped classes inherit from. When the class definition is
   completed, a new <code>Table</code> and <code>mapper()</code> have been generated, accessible via the <code>__table__</code> and <code>__mapper__</code> attributes on the
   <code>SomeClass</code> class.
</p>
<p>You may omit the names from the Column definitions.  Declarative will fill
   them in for you:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">SomeClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'some_table'</span><span class="python_operator">
    </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Attributes may be added to the class after its construction, and they will be added to the underlying <code>Table</code> and <code>mapper()</code> definitions as
   appropriate:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">SomeClass</span><span class="python_operator">.</span><span class="python_name">data </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'data'</span><span class="python_operator">, </span><span class="python_name">Unicode</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">SomeClass</span><span class="python_operator">.</span><span class="python_name">related </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">RelatedInfo</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Classes which are mapped explicitly using <code>mapper()</code> can interact freely with declarative classes. 
</p>
<p>The <code>declarative_base</code> base class contains a <code>MetaData</code> object where newly defined <code>Table</code> objects are collected.  This is accessed via the <code>metadata</code> class level accessor, so to create tables we can say:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Base</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">create_all</span><span class="python_enclosure">(</span><span class="python_name">engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>Engine</code> created above may also be directly associated with the declarative base class using the <code>bind</code> keyword argument, where it will be associated with the underlying <code>MetaData</code> object and allow SQL operations involving that metadata and its tables to make use of that engine automatically:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Base </span><span class="python_operator">= </span><span class="python_name">declarative_base</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Or, as <code>MetaData</code> allows, at any time using the <code>bind</code> attribute:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">Base</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">.</span><span class="python_name">bind </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite://'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>declarative_base</code> can also receive a pre-created <code>MetaData</code> object, which allows a declarative setup to be associated with an already existing traditional collection of <code>Table</code> objects:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">mymetadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">Base </span><span class="python_operator">= </span><span class="python_name">declarative_base</span><span class="python_enclosure">(</span><span class="python_name">metadata</span><span class="python_operator">=</span><span class="python_name">mymetadata</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Relations to other classes are done in the usual way, with the added feature that the class specified to <code>relation()</code> may be a string name. The
   "class registry" associated with <code>Base</code> is used at mapper compilation time to resolve the name into the actual class object, which is expected to
   have been defined once the mapper configuration is used:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'users'</span><span class="python_operator">
</span>
    <span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
    </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_literal">"Address"</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">"user"</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'addresses'</span><span class="python_operator">
</span>
    <span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
    </span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.id'</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>Column constructs, since they are just that, are immediately usable, as below where we define a primary join condition on the <code>Address</code> class
   using them:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">Address</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'addresses'</span><span class="python_operator">
</span>
    <span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">email </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'email'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
    </span><span class="python_name">user_id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'users.id'</span><span class="python_enclosure">))</span><span class="python_operator">
    </span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>In addition to the main argument for <code>relation</code>, other arguments
   which depend upon the columns present on an as-yet undefined class
   may also be specified as strings.  These strings are evaluated as
   Python expressions.  The full namespace available within this 
   evaluation includes all classes mapped for this declarative base,
   as well as the contents of the <code>sqlalchemy</code> package, including 
   expression functions like <code>desc</code> and <code>func</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_comment"># ....
</span><span class="python_operator">    </span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_literal">"Address"</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_literal">"desc(Address.email)"</span><span class="python_operator">, </span>
        <span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_literal">"Address.user_id==User.id"</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>As an alternative to string-based attributes, attributes may also be 
   defined after all classes have been created.  Just add them to the target
   class after the fact:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">addresses </span><span class="python_operator">= </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Address</span><span class="python_operator">, </span><span class="python_name">primaryjoin</span><span class="python_operator">=</span><span class="python_name">Address</span><span class="python_operator">.</span><span class="python_name">user_id</span><span class="python_operator">==</span><span class="python_name">User</span><span class="python_operator">.</span><span class="python_name">id</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Synonyms are one area where <code>declarative</code> needs to slightly change the usual SQLAlchemy configurational syntax. To define a
   getter/setter which proxies to an underlying attribute, use <code>synonym</code> with the <code>descriptor</code> argument:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'sometable'</span><span class="python_operator">
</span>
    <span class="python_name">_attr </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'attr'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_keyword">def </span><span class="python_name">_get_attr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_some_attr</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">_set_attr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">attr</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_some_attr </span><span class="python_operator">= </span><span class="python_name">attr</span><span class="python_operator">
    </span><span class="python_name">attr </span><span class="python_operator">= </span><span class="python_name">synonym</span><span class="python_enclosure">(</span><span class="python_literal">'_attr'</span><span class="python_operator">, </span><span class="python_name">descriptor</span><span class="python_operator">=</span><span class="python_name">property</span><span class="python_enclosure">(</span><span class="python_name">_get_attr</span><span class="python_operator">, </span><span class="python_name">_set_attr</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>The above synonym is then usable as an instance attribute as well as a class-level expression construct:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">x </span><span class="python_operator">= </span><span class="python_name">MyClass</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">x</span><span class="python_operator">.</span><span class="python_name">attr </span><span class="python_operator">= </span><span class="python_literal">"some value"</span><span class="python_operator">
</span><span class="python_name">session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">attr </span><span class="python_operator">== </span><span class="python_literal">'some other value'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>The <code>synonym_for</code> decorator can accomplish the same task:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'sometable'</span><span class="python_operator">
</span>
    <span class="python_name">_attr </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'attr'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator">@</span><span class="python_name">synonym_for</span><span class="python_enclosure">(</span><span class="python_literal">'_attr'</span><span class="python_enclosure">)</span><span class="python_operator">
    @</span><span class="python_name">property</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">attr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">_some_attr</span><span class="python_operator">
</span></pre>
    </div>
<p>Similarly, <code>comparable_using</code> is a front end for the <code>comparable_property</code> ORM function:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'sometable'</span><span class="python_operator">
</span>
    <span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
    <span class="python_operator">@</span><span class="python_name">comparable_using</span><span class="python_enclosure">(</span><span class="python_name">MyUpperCaseComparator</span><span class="python_enclosure">)</span><span class="python_operator">
    @</span><span class="python_name">property</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">uc_name</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_operator">.</span><span class="python_name">upper</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>As an alternative to <code>__tablename__</code>, a direct <code>Table</code> construct may be used.  The <code>Column</code> objects, which in this case require their names, will be added to the mapping just like a regular mapping to a table:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__table__ </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'my_table'</span><span class="python_operator">, </span><span class="python_name">Base</span><span class="python_operator">.</span><span class="python_name">metadata</span><span class="python_operator">,</span>
        <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
        <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span>
    <span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Other table-based attributes include <code>__table_args__</code>, which is
   either a dictionary as in:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'sometable'</span><span class="python_operator">
    </span><span class="python_name">__table_args__ </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'mysql_engine'</span><span class="python_operator">:</span><span class="python_literal">'InnoDB'</span><span class="python_enclosure">}</span><span class="python_operator">
</span></pre>
    </div>
<p>or a dictionary-containing tuple in the form 
   <code>(arg1, arg2, ..., {kwarg1:value, ...})</code>, as in:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">MyClass</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'sometable'</span><span class="python_operator">
    </span><span class="python_name">__table_args__ </span><span class="python_operator">= </span><span class="python_enclosure">(</span><span class="python_name">ForeignKeyConstraint</span><span class="python_enclosure">([</span><span class="python_literal">'id'</span><span class="python_enclosure">]</span><span class="python_operator">, </span><span class="python_enclosure">[</span><span class="python_literal">'remote_table.id'</span><span class="python_enclosure">])</span><span class="python_operator">, </span><span class="python_enclosure">{</span><span class="python_literal">'autoload'</span><span class="python_operator">:</span><span class="python_name">True</span><span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Mapper arguments are specified using the <code>__mapper_args__</code> class variable. Note that the column objects declared on the class are immediately
   usable, as in this joined-table inheritance example:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">class </span><span class="python_name">Person</span><span class="python_enclosure">(</span><span class="python_name">Base</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'people'</span><span class="python_operator">
    </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">discriminator </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'type'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
    </span><span class="python_name">__mapper_args__ </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'polymorphic_on'</span><span class="python_operator">:</span><span class="python_name">discriminator</span><span class="python_enclosure">}</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Engineer</span><span class="python_enclosure">(</span><span class="python_name">Person</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_name">__tablename__ </span><span class="python_operator">= </span><span class="python_literal">'engineers'</span><span class="python_operator">
    </span><span class="python_name">__mapper_args__ </span><span class="python_operator">= </span><span class="python_enclosure">{</span><span class="python_literal">'polymorphic_identity'</span><span class="python_operator">:</span><span class="python_literal">'engineer'</span><span class="python_enclosure">}</span><span class="python_operator">
    </span><span class="python_name">id </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'people.id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">
    </span><span class="python_name">primary_language </span><span class="python_operator">= </span><span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'primary_language'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">50</span><span class="python_enclosure">))</span><span class="python_operator">
</span></pre>
    </div>
<p>For single-table inheritance, the <code>__tablename__</code> and <code>__table__</code> class variables are optional on a class when the class inherits from another
   mapped class.
</p>
<p>As a convenience feature, the <code>declarative_base()</code> sets a default constructor on classes which takes keyword arguments, and assigns them to the
   named attributes:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">e </span><span class="python_operator">= </span><span class="python_name">Engineer</span><span class="python_enclosure">(</span><span class="python_name">primary_language</span><span class="python_operator">=</span><span class="python_literal">'python'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Note that <code>declarative</code> has no integration built in with sessions, and is only intended as an optional syntax for the regular usage of mappers
   and Table objects. A typical application setup using <code>scoped_session</code> might look like:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">engine </span><span class="python_operator">= </span><span class="python_name">create_engine</span><span class="python_enclosure">(</span><span class="python_literal">'postgres://scott:tiger@localhost/test'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">scoped_session</span><span class="python_enclosure">(</span><span class="python_name">sessionmaker</span><span class="python_enclosure">(</span><span class="python_name">autocommit</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">autoflush</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_operator">, </span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">engine</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_name">Base </span><span class="python_operator">= </span><span class="python_name">declarative_base</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Mapped instances then make usage of <code>Session</code> in the usual way.
</p>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>



    
    <A name="plugins_associationproxy"></a>
    
    <div class="sectionL2">

    <h3>associationproxy</h3>
    
    

<p><strong>Author:</strong> Mike Bayer and Jason Kirtland<br></br>
   <strong>Version:</strong> 0.3.1 or greater
</p>
<p><code>associationproxy</code> is used to create a simplified, read/write view of a relationship.  It can be used to cherry-pick fields from a collection of related objects or to greatly simplify access to associated objects in an association relationship.
</p>


    
    <A name="plugins_associationproxy_simplifying"></a>
    
    <div class="sectionL3">

    <h3>Simplifying Association Object Relations</h3>
    
    

<p>Consider this "association object" mapping:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">users_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'users'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">64</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">keywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'keywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">64</span><span class="python_enclosure">))</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">userkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.id"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
           <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.id"</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
           <span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'kw'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">secondary</span><span class="python_operator">=</span><span class="python_name">userkeywords_table</span><span class="python_enclosure">)</span>
    <span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above are three simple tables, modeling users, keywords and a many-to-many relationship between the two.  These <code>Keyword</code> objects are little more than a container for a name, and accessing them via the relation is awkward:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'jek'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'cheese inspector'</span><span class="python_enclosure">))</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_operator">
</span><span class="python_comment"># [&lt;__main__.Keyword object at 0xb791ea0c&gt;]
</span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_operator">
</span><span class="python_comment"># 'cheese inspector'
</span><span class="python_keyword">print </span><span class="python_enclosure">[</span><span class="python_name">keyword</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_keyword">for </span><span class="python_name">keyword </span><span class="python_keyword">in </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_comment"># ['cheese inspector']
</span><span class="python_operator"></span></pre>
    </div>
<p>With <code>association_proxy</code> you have a "view" of the relation that contains just the <code>.keyword</code> of the related objects.  The proxy is a Python property, and unlike the mapper relation, is defined in your class:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">association_proxy</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
    <span class="python_comment"># proxy the 'keyword' attribute from the 'kw' relation
    </span><span class="python_operator"></span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">association_proxy</span><span class="python_enclosure">(</span><span class="python_literal">'kw'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># ...
</span><span class="python_operator"></span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">Keyword object at </span><span class="python_number">0xb791ea0c</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'cheese inspector'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_literal">'snack ninja'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_literal">'cheese inspector'</span><span class="python_operator">, </span><span class="python_literal">'snack ninja'</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">kw</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_operator">&lt;</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">Keyword object at </span><span class="python_number">0x9272a4c</span><span class="python_operator">&gt;, &lt;</span><span class="python_name">__main__</span><span class="python_operator">.</span><span class="python_name">Keyword object at </span><span class="python_number">0xb7b396ec</span><span class="python_operator">&gt;</span><span class="python_enclosure">]</span><span class="python_operator">
</span></pre>
    </div>
<p>The proxy is read/write.  New associated objects are created on demand when values are added to the proxy, and modifying or removing an entry through the proxy also affects the underlying collection.
</p>
<ul>
 <li>
     The association proxy property is backed by a mapper-defined relation, either a collection or scalar.
 </li>

 <li>
     You can access and modify both the proxy and the backing relation. Changes in one are immediate in the other.
 </li>

 <li>
     The proxy acts like the type of the underlying collection.  A list gets a list-like proxy, a dict a dict-like proxy, and so on.
 </li>

 <li>
     Multiple proxies for the same relation are fine.
 </li>

 <li>
     Proxies are lazy, and won't trigger a load of the backing relation until they are accessed.
 </li>

 <li>
     The relation is inspected to determine the type of the related objects.
 </li>

 <li>
     To construct new instances, the type is called with the value being assigned, or key and value for dicts.
 </li>

 <li>
     A <code>creator</code> function can be used to create instances instead.
 </li>
</ul>
<p>Above, the <code>Keyword.__init__</code> takes a single argument <code>keyword</code>, which maps conveniently to the value being set through the proxy.  A <code>creator</code> function could have been used instead if more flexibility was required.
</p>
<p>Because the proxies are backed a regular relation collection, all of the usual hooks and patterns for using collections are still in effect.  The most convenient behavior is the automatic setting of "parent"-type relationships on assignment.  In the example above, nothing special had to be done to associate the Keyword to the User.  Simply adding it to the collection is sufficient.
</p>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>



    
    <A name="plugins_associationproxy_simplifying"></a>
    
    <div class="sectionL3">

    <h3>Simplifying Association Object Relations</h3>
    
    

<p>Association proxies are also useful for keeping <b>association objects</b> out the way during regular use.  For example, the  <code>userkeywords</code> table might have a bunch of auditing columns that need to get updated when changes are made- columns that are updated but seldom, if ever, accessed in your application.  A proxy can provide a very natural access pattern for the relation.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">association_proxy</span><span class="python_operator">
</span>
<span class="python_comment"># users_table and keywords_table tables as above, then:
</span>
<span class="python_keyword">def </span><span class="python_name">get_current_uid</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_literal">"""Return the uid of the current user."""</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_number">1  </span><span class="python_comment"># hardcoded for this example</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">userkeywords_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'userkeywords'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'user_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"users.id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">"keywords.id"</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_comment"># add some auditing columns</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'updated_at'</span><span class="python_operator">, </span><span class="python_name">DateTime</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">datetime</span><span class="python_operator">.</span><span class="python_name">now</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'updated_by'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">default</span><span class="python_operator">=</span><span class="python_name">get_current_uid</span><span class="python_operator">, </span><span class="python_name">onupdate</span><span class="python_operator">=</span><span class="python_name">get_current_uid</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">_create_uk_by_keyword</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""A creator function."""</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">UserKeyword</span><span class="python_enclosure">(</span><span class="python_name">keyword</span><span class="python_operator">=</span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
    </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">association_proxy</span><span class="python_enclosure">(</span><span class="python_literal">'user_keywords'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">_create_uk_by_keyword</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
    </span><span class="python_keyword">def </span><span class="python_name">__repr__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_keyword">return </span><span class="python_literal">'Keyword(%s)' </span><span class="python_operator">% </span><span class="python_name">repr</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">UserKeyword</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">user</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">keyword</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">user</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">keyword </span><span class="python_operator">= </span><span class="python_name">keyword</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">users_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_operator">, </span><span class="python_name">keywords_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">UserKeyword</span><span class="python_operator">, </span><span class="python_name">userkeywords_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'user'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">User</span><span class="python_operator">, </span><span class="python_name">backref</span><span class="python_operator">=</span><span class="python_literal">'user_keywords'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'keyword'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span>
<span class="python_name">user </span><span class="python_operator">= </span><span class="python_name">User</span><span class="python_enclosure">(</span><span class="python_literal">'log'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">kw1  </span><span class="python_operator">= </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'new_from_blammo'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># Adding a Keyword requires creating a UserKeyword association object
</span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">UserKeyword</span><span class="python_enclosure">(</span><span class="python_name">user</span><span class="python_operator">, </span><span class="python_name">kw1</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_comment"># And accessing Keywords requires traversing UserKeywords
</span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_keywords</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">
</span><span class="python_comment"># &lt;__main__.UserKeyword object at 0xb79bbbec&gt;
</span>
<span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">user_keywords</span><span class="python_enclosure">[</span><span class="python_number">0</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">keyword</span><span class="python_operator">
</span><span class="python_comment"># Keyword('new_from_blammo')
</span>
<span class="python_comment"># Lots of work.
</span>
<span class="python_comment"># It's much easier to go through the association proxy!
</span><span class="python_keyword">for </span><span class="python_name">kw </span><span class="python_keyword">in </span><span class="python_enclosure">(</span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'its_big'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'its_heavy'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Keyword</span><span class="python_enclosure">(</span><span class="python_literal">'its_wood'</span><span class="python_enclosure">))</span><span class="python_operator">:
    </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">kw</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">print </span><span class="python_name">user</span><span class="python_operator">.</span><span class="python_name">keywords</span><span class="python_operator">
</span><span class="python_comment"># [Keyword('new_from_blammo'), Keyword('its_big'), Keyword('its_heavy'), Keyword('its_wood')]
</span><span class="python_operator"></span></pre>
    </div>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>



    
    <A name="plugins_associationproxy_building"></a>
    
    <div class="sectionL3">

    <h3>Building Complex Views</h3>
    
    


    

    <div class="sliding_code">
        <pre>
<span class="python_name">stocks </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"stocks"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'symbol'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'description'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'last_price'</span><span class="python_operator">, </span><span class="python_name">Numeric</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">brokers </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"brokers"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">,</span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
   <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">100</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">nullable</span><span class="python_operator">=</span><span class="python_name">False</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">holdings </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">"holdings"</span><span class="python_operator">, </span><span class="python_name">meta</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'broker_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'brokers.id'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'symbol'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">(</span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'stocks.symbol'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
  <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'shares'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span>
<span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>Above are three tables, modeling stocks, their brokers and the number of shares of a stock held by each broker.  This situation is quite different from the association example above.  <code>shares</code> is a <em>property of the relation</em>, an important one that we need to use all the time.
</p>
<p>For this example, it would be very convenient if <code>Broker</code> objects had a dictionary collection that mapped <code>Stock</code> instances to the shares held for each.  That's easy.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">association_proxy</span><span class="python_operator">
</span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">orm</span><span class="python_operator">.</span><span class="python_name">collections </span><span class="python_keyword">import </span><span class="python_name">attribute_mapped_collection</span><span class="python_operator">
</span>
<span class="python_keyword">def </span><span class="python_name">_create_holding</span><span class="python_enclosure">(</span><span class="python_name">stock</span><span class="python_operator">, </span><span class="python_name">shares</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_literal">"""A creator function, constructs Holdings from Stock and share quantity."""</span><span class="python_operator">
    </span><span class="python_keyword">return </span><span class="python_name">Holding</span><span class="python_enclosure">(</span><span class="python_name">stock</span><span class="python_operator">=</span><span class="python_name">stock</span><span class="python_operator">, </span><span class="python_name">shares</span><span class="python_operator">=</span><span class="python_name">shares</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Broker</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">name</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">name </span><span class="python_operator">= </span><span class="python_name">name</span><span class="python_operator">
</span>
    <span class="python_operator"></span><span class="python_name">holdings </span><span class="python_operator">= </span><span class="python_name">association_proxy</span><span class="python_enclosure">(</span><span class="python_literal">'by_stock'</span><span class="python_operator">, </span><span class="python_literal">'shares'</span><span class="python_operator">, </span><span class="python_name">creator</span><span class="python_operator">=</span><span class="python_name">_create_holding</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Stock</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">symbol</span><span class="python_operator">, </span><span class="python_name">description</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">symbol </span><span class="python_operator">= </span><span class="python_name">symbol</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">description </span><span class="python_operator">= </span><span class="python_name">description</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">last_price </span><span class="python_operator">= </span><span class="python_number">0</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">class </span><span class="python_name">Holding</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
    </span><span class="python_keyword">def </span><span class="python_name">__init__</span><span class="python_enclosure">(</span><span class="python_name">self</span><span class="python_operator">, </span><span class="python_name">broker</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">stock</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">, </span><span class="python_name">shares</span><span class="python_operator">=</span><span class="python_number">0</span><span class="python_enclosure">)</span><span class="python_operator">:
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">broker </span><span class="python_operator">= </span><span class="python_name">broker</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">stock </span><span class="python_operator">= </span><span class="python_name">stock</span><span class="python_operator">
        </span><span class="python_name">self</span><span class="python_operator">.</span><span class="python_name">shares </span><span class="python_operator">= </span><span class="python_name">shares</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Stock</span><span class="python_operator">, </span><span class="python_name">stocks_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Broker</span><span class="python_operator">, </span><span class="python_name">brokers_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'by_stock'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Holding</span><span class="python_operator">,</span>
        <span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">attribute_mapped_collection</span><span class="python_enclosure">(</span><span class="python_literal">'stock'</span><span class="python_enclosure">))</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Holding</span><span class="python_operator">, </span><span class="python_name">holdings_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
    <span class="python_literal">'stock'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Stock</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
    <span class="python_literal">'broker'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Broker</span><span class="python_enclosure">)</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span></pre>
    </div>
<p>Above, we've set up the 'by_stock' relation collection to act as a dictionary, using the <code>.stock</code> property of each Holding as a key.
</p>
<p>Populating and accessing that dictionary manually is slightly inconvenient because of the complexity of the Holdings association object:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">stock </span><span class="python_operator">= </span><span class="python_name">Stock</span><span class="python_enclosure">(</span><span class="python_literal">'ZZK'</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">broker </span><span class="python_operator">= </span><span class="python_name">Broker</span><span class="python_enclosure">(</span><span class="python_literal">'paj'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">broker</span><span class="python_operator">.</span><span class="python_name">holdings</span><span class="python_enclosure">[</span><span class="python_name">stock</span><span class="python_enclosure">] </span><span class="python_operator">= </span><span class="python_name">Holding</span><span class="python_enclosure">(</span><span class="python_name">broker</span><span class="python_operator">, </span><span class="python_name">stock</span><span class="python_operator">, </span><span class="python_number">10</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_keyword">print </span><span class="python_name">broker</span><span class="python_operator">.</span><span class="python_name">holdings</span><span class="python_enclosure">[</span><span class="python_name">stock</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">shares</span><span class="python_operator">
</span><span class="python_comment"># 10
</span><span class="python_operator"></span></pre>
    </div>
<p>The <code>by_stock</code> proxy we've added to the <code>Broker</code> class hides the details of the <code>Holding</code> while also giving access to <code>.shares</code>:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">for </span><span class="python_name">stock </span><span class="python_keyword">in </span><span class="python_enclosure">(</span><span class="python_name">Stock</span><span class="python_enclosure">(</span><span class="python_literal">'JEK'</span><span class="python_enclosure">)</span><span class="python_operator">, </span><span class="python_name">Stock</span><span class="python_enclosure">(</span><span class="python_literal">'STPZ'</span><span class="python_enclosure">))</span><span class="python_operator">:
    </span><span class="python_name">broker</span><span class="python_operator">.</span><span class="python_name">holdings</span><span class="python_enclosure">[</span><span class="python_name">stock</span><span class="python_enclosure">] </span><span class="python_operator">= </span><span class="python_number">123</span><span class="python_operator">
</span>
<span class="python_operator"></span><span class="python_keyword">for </span><span class="python_name">stock</span><span class="python_operator">, </span><span class="python_name">shares </span><span class="python_keyword">in </span><span class="python_name">broker</span><span class="python_operator">.</span><span class="python_name">holdings</span><span class="python_operator">.</span><span class="python_name">items</span><span class="python_enclosure">()</span><span class="python_operator">:
    </span><span class="python_keyword">print </span><span class="python_name">stock</span><span class="python_operator">, </span><span class="python_name">shares</span><span class="python_operator">
</span>
<span class="python_comment"># lets take a peek at that holdings_table after committing changes to the db
</span><span class="python_operator"></span><span class="python_keyword">print </span><span class="python_name">list</span><span class="python_enclosure">(</span><span class="python_name">holdings_table</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">()</span><span class="python_operator">.</span><span class="python_name">execute</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_comment"># [(1, 'ZZK', 10), (1, 'JEK', 123), (1, 'STEPZ', 123)]
</span><span class="python_operator"></span></pre>
    </div>
<p>Further examples can be found in the <code>examples/</code> directory in the SQLAlchemy distribution.
</p>
<p>The <code>association_proxy</code> convenience function is not present in SQLAlchemy versions 0.3.1 through 0.3.7, instead instantiate the class directly:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">associationproxy </span><span class="python_keyword">import </span><span class="python_name">AssociationProxy</span><span class="python_operator">
</span>
<span class="python_keyword">class </span><span class="python_name">Article</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
   </span><span class="python_name">keywords </span><span class="python_operator">= </span><span class="python_name">AssociationProxy</span><span class="python_enclosure">(</span><span class="python_literal">'keyword_associations'</span><span class="python_operator">, </span><span class="python_literal">'keyword'</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>




    </div>



    
    <A name="plugins_orderinglist"></a>
    
    <div class="sectionL2">

    <h3>orderinglist</h3>
    
    

<p><strong>Author:</strong> Jason Kirtland
</p>
<p><code>orderinglist</code> is a helper for mutable ordered relations.  It will intercept
   list operations performed on a relation collection and automatically
   synchronize changes in list position with an attribute on the related objects.
   (See <b>advdatamapping_properties_entitycollections</b> for more information on the general pattern.)
</p>
<p>Example: Two tables that store slides in a presentation.  Each slide
   has a number of bullet points, displayed in order by the 'position'
   column on the bullets table.  These bullets can be inserted and re-ordered
   by your end users, and you need to update the 'position' column of all
   affected rows when changes are made.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_name">slides_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'Slides'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
                     <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                     <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'name'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_name">bullets_table </span><span class="python_operator">= </span><span class="python_name">Table</span><span class="python_enclosure">(</span><span class="python_literal">'Bullets'</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">,</span>
                      <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">primary_key</span><span class="python_operator">=</span><span class="python_name">True</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                      <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'slide_id'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_operator">, </span><span class="python_name">ForeignKey</span><span class="python_enclosure">(</span><span class="python_literal">'Slides.id'</span><span class="python_enclosure">))</span><span class="python_operator">,</span>
                      <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'position'</span><span class="python_operator">, </span><span class="python_name">Integer</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                      <span class="python_name">Column</span><span class="python_enclosure">(</span><span class="python_literal">'text'</span><span class="python_operator">, </span><span class="python_name">String</span><span class="python_enclosure">))</span><span class="python_operator">
</span>
<span class="python_operator"> </span><span class="python_keyword">class </span><span class="python_name">Slide</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
     </span><span class="python_keyword">pass</span><span class="python_operator">
 </span><span class="python_keyword">class </span><span class="python_name">Bullet</span><span class="python_enclosure">(</span><span class="python_name">object</span><span class="python_enclosure">)</span><span class="python_operator">:
     </span><span class="python_keyword">pass</span><span class="python_operator">
</span>
 <span class="python_operator"></span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Slide</span><span class="python_operator">, </span><span class="python_name">slides_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
       <span class="python_literal">'bullets'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_operator">, </span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bullets_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">position</span><span class="python_enclosure">])</span>
 <span class="python_enclosure">})</span><span class="python_operator">
 </span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_operator">, </span><span class="python_name">bullets_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span></pre>
    </div>
<p>The standard relation mapping will produce a list-like attribute on each Slide
   containing all related Bullets, but coping with changes in ordering is totally
   your responsibility.  If you insert a Bullet into that list, there is no
   magic- it won't have a position attribute unless you assign it it one, and
   you'll need to manually renumber all the subsequent Bullets in the list to
   accommodate the insert.
</p>
<p>An <code>orderinglist</code> can automate this and manage the 'position' attribute on all
   related bullets for you.
</p>

    

    <div class="sliding_code">
        <pre> 
<span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Slide</span><span class="python_operator">, </span><span class="python_name">slides_table</span><span class="python_operator">, </span><span class="python_name">properties</span><span class="python_operator">=</span><span class="python_enclosure">{</span>
<span class="python_literal">'bullets'</span><span class="python_operator">: </span><span class="python_name">relation</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_operator">,</span>
                    <span class="python_name">collection_class</span><span class="python_operator">=</span><span class="python_name">ordering_list</span><span class="python_enclosure">(</span><span class="python_literal">'position'</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
                    <span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">bullets_table</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">position</span><span class="python_enclosure">])</span>
<span class="python_enclosure">})</span><span class="python_operator">
</span><span class="python_name">mapper</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_operator">, </span><span class="python_name">bullets_table</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_name">s </span><span class="python_operator">= </span><span class="python_name">Slide</span><span class="python_enclosure">()</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">bullets</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">bullets</span><span class="python_operator">.</span><span class="python_name">append</span><span class="python_enclosure">(</span><span class="python_name">Bullet</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">bullets</span><span class="python_enclosure">[</span><span class="python_number">1</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">position</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_number">1</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">bullets</span><span class="python_operator">.</span><span class="python_name">insert</span><span class="python_enclosure">(</span><span class="python_number">1</span><span class="python_operator">, </span><span class="python_name">Bullet</span><span class="python_enclosure">())</span><span class="python_operator">
</span><span class="python_name">s</span><span class="python_operator">.</span><span class="python_name">bullets</span><span class="python_enclosure">[</span><span class="python_number">2</span><span class="python_enclosure">]</span><span class="python_operator">.</span><span class="python_name">position</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_number">2</span><span class="python_operator">
</span></pre>
    </div>
<p>Use the <code>ordering_list</code> function to set up the <code>collection_class</code> on relations
   (as in the mapper example above).  This implementation depends on the list
   starting in the proper order, so be SURE to put an order_by on your relation.
</p>
<p><code>ordering_list</code> takes the name of the related object's ordering attribute as
   an argument.  By default, the zero-based integer index of the object's
   position in the <code>ordering_list</code> is synchronized with the ordering attribute:
   index 0 will get position 0, index 1 position 1, etc.  To start numbering at 1
   or some other integer, provide <code>count_from=1</code>.
</p>
<p>Ordering values are not limited to incrementing integers.  Almost any scheme
   can implemented by supplying a custom <code>ordering_func</code> that maps a Python list
   index to any value you require.  See the <a href="sqlalchemy_ext_orderinglist.html#docstrings_sqlalchemy.ext.orderinglist">module
documentation</a> for more
   information, and also check out the unit tests for examples of stepped
   numbering, alphabetical and Fibonacci numbering.
</p>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>



    
    <A name="plugins_serializer"></a>
    
    <div class="sectionL2">

    <h3>serializer</h3>
    
    

<p><strong>Author:</strong> Mike Bayer
</p>
<p>Serializer/Deserializer objects for usage with SQLAlchemy structures.
</p>
<p>Any SQLAlchemy structure, including Tables, Columns, expressions, mappers,
   Query objects etc. can be serialized in a minimally-sized format,
   and deserialized when given a Metadata and optional ScopedSession object
   to use as context on the way out.
</p>
<p>Usage is nearly the same as that of the standard Python pickle module:
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">serializer </span><span class="python_keyword">import </span><span class="python_name">loads</span><span class="python_operator">, </span><span class="python_name">dumps</span><span class="python_operator">
</span><span class="python_name">metadata </span><span class="python_operator">= </span><span class="python_name">MetaData</span><span class="python_enclosure">(</span><span class="python_name">bind</span><span class="python_operator">=</span><span class="python_name">some_engine</span><span class="python_enclosure">)</span><span class="python_operator">
</span><span class="python_name">Session </span><span class="python_operator">= </span><span class="python_name">scoped_session</span><span class="python_enclosure">(</span><span class="python_name">sessionmaker</span><span class="python_enclosure">())</span><span class="python_operator">
</span>
<span class="python_comment"># ... define mappers
</span>
<span class="python_name">query </span><span class="python_operator">= </span><span class="python_name">Session</span><span class="python_operator">.</span><span class="python_name">query</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">filter</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">somedata</span><span class="python_operator">==</span><span class="python_literal">'foo'</span><span class="python_enclosure">)</span><span class="python_operator">.</span><span class="python_name">order_by</span><span class="python_enclosure">(</span><span class="python_name">MyClass</span><span class="python_operator">.</span><span class="python_name">sortkey</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># pickle the query
</span><span class="python_name">serialized </span><span class="python_operator">= </span><span class="python_name">dumps</span><span class="python_enclosure">(</span><span class="python_name">query</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_comment"># unpickle.  Pass in metadata + scoped_session
</span><span class="python_name">query2 </span><span class="python_operator">= </span><span class="python_name">loads</span><span class="python_enclosure">(</span><span class="python_name">serialized</span><span class="python_operator">, </span><span class="python_name">metadata</span><span class="python_operator">, </span><span class="python_name">Session</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_keyword">print </span><span class="python_name">query2</span><span class="python_operator">.</span><span class="python_name">all</span><span class="python_enclosure">()</span><span class="python_operator">
</span></pre>
    </div>
<p>Similar restrictions as when using raw pickle apply; mapped classes must be 
   themselves be pickleable, meaning they are importable from a module-level
   namespace.
</p>
<p>Note that instances of user-defined classes do not require this extension
   in order to be pickled; these contain no references to engines, sessions
   or expression constructs in the typical case and can be serialized directly.
   This module is specifically for ORM and expression constructs.
</p>



            <a href="#plugins" class="totoc">back to section top</a>
    </div>



    
    <A name="plugins_sqlsoup"></a>
    
    <div class="sectionL2">

    <h3>SqlSoup</h3>
    
    

<p><strong>Author:</strong> Jonathan Ellis
</p>
<p>SqlSoup creates mapped classes on the fly from tables, which are automatically reflected from the database based on name.  It is essentially a nicer version of the "row data gateway" pattern.
</p>

    

    <div class="sliding_code">
        <pre>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_keyword">from </span><span class="python_name">sqlalchemy</span><span class="python_operator">.</span><span class="python_name">ext</span><span class="python_operator">.</span><span class="python_name">sqlsoup </span><span class="python_keyword">import </span><span class="python_name">SqlSoup</span><span class="python_operator">
</span><span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">soup </span><span class="python_operator">= </span><span class="python_name">SqlSoup</span><span class="python_enclosure">(</span><span class="python_literal">'sqlite:///'</span><span class="python_enclosure">)</span><span class="python_operator">
</span>
<span class="python_literal">&gt;&gt;&gt; </span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">select</span><span class="python_enclosure">(</span><span class="python_name">order_by</span><span class="python_operator">=</span><span class="python_enclosure">[</span><span class="python_name">db</span><span class="python_operator">.</span><span class="python_name">users</span><span class="python_operator">.</span><span class="python_name">c</span><span class="python_operator">.</span><span class="python_name">name</span><span class="python_enclosure">])</span><span class="python_operator">
</span><span class="python_enclosure">[</span><span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Bhargan Basepair'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'basepair@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'basepair'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">1</span><span class="python_enclosure">)</span><span class="python_operator">,</span>
 <span class="python_name">MappedUsers</span><span class="python_enclosure">(</span><span class="python_name">name</span><span class="python_operator">=</span><span class="python_literal">'Joe Student'</span><span class="python_operator">,</span><span class="python_name">email</span><span class="python_operator">=</span><span class="python_literal">'student@example.edu'</span><span class="python_operator">,</span><span class="python_name">password</span><span class="python_operator">=</span><span class="python_literal">'student'</span><span class="python_operator">,</span><span class="python_name">classname</span><span class="python_operator">=</span><span class="python_name">None</span><span class="python_operator">,</span><span class="python_name">admin</span><span class="python_operator">=</span><span class="python_number">0</span><span class="python_enclosure">)]</span><span class="python_operator">
</span></pre>
    </div>
<p>Full SqlSoup documentation is on the <a href='http://www.sqlalchemy.org/trac/wiki/SqlSoup'>SQLAlchemy Wiki</a>.
</p>




            <a href="#plugins" class="totoc">back to section top</a>
    </div>




    </div>



    
    
    <A name="docstrings"></a>

    
    
    <A name="docstrings_sqlalchemy.engine"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.default"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.strategies"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.threadlocal"></a>

    
    
    <A name="docstrings_sqlalchemy.engine.url"></a>

    
    
    <A name="docstrings_sqlalchemy.exc"></a>

    
    
    <A name="docstrings_sqlalchemy.interfaces"></a>

    
    
    <A name="docstrings_sqlalchemy.pool"></a>

    
    
    <A name="docstrings_sqlalchemy.schema"></a>

    
    
    <A name="docstrings_sqlalchemy.sql.compiler"></a>

    
    
    <A name="docstrings_sqlalchemy.sql.expression"></a>

    
    
    <A name="docstrings_sqlalchemy.sql.visitors"></a>

    
    
    <A name="docstrings_sqlalchemy.types"></a>

    
    
    <A name="docstrings_sqlalchemy.util"></a>

    
    
    <A name="docstrings_sqlalchemy.orm"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.attributes"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.collections"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.interfaces"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.mapper"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.properties"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.query"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.session"></a>

    
    
    <A name="docstrings_sqlalchemy.orm.shard"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.declarative"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.associationproxy"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.orderinglist"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.serializer"></a>

    
    
    <A name="docstrings_sqlalchemy.ext.sqlsoup"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.access"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.firebird"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.informix"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.maxdb"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.mssql"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.mysql"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.oracle"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.postgres"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.sqlite"></a>

    
    
    <A name="docstrings_sqlalchemy.databases.sybase"></a>

    
    
    <A name="copyright"></a>

        
    <div class="navbanner">
        <a href="documentation.html" class="totoc">Table of Contents</a>
        
    <div class="prevnext">

            
            Previous: <a href="docstrings.html#docstrings">API Documentation</a>

    </div>

        <h2>Appendix:  Copyright</h2>
    </div>


        








    
    <A name="copyright"></a>
    
    <div class="sectionL1">

    
    

<p>This is the MIT license: http://www.opensource.org/licenses/mit-license.php
</p>
<p>Copyright (c) 2005, 2006, 2007, 2008 Michael Bayer and contributors. SQLAlchemy is a trademark of Michael
   Bayer.
</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this
   software and associated documentation files (the "Software"), to deal in the Software
   without restriction, including without limitation the rights to use, copy, modify, merge,
   publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons
   to whom the Software is furnished to do so, subject to the following conditions:
</p>
<p>The above copyright notice and this permission notice shall be included in all copies or
   substantial portions of the Software.
</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
   PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
   FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
   OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
</p>




            <a href="#copyright" class="totoc">back to section top</a>
    </div>










</body>
</html>






